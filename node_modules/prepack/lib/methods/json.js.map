{"version":3,"sources":["../../src/methods/json.js"],"names":["InternalizeJSONProperty","realm","reviver","holder","name","val","ObjectValue","isArray","I","len","To","ToLength","newElement","ToString","NumberValue","UndefinedValue","$Delete","Create","CreateDataProperty","throwIfNotConcrete","keys","P","StringValue"],"mappings":";;;;;;;AAYA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;;;AAnBA;;;;;;;;;AASA;AAYA;AACO,SAASA,uBAAT,CACLC,KADK,EAELC,OAFK,EAGLC,MAHK,EAILC,IAJK,EAKE;AACP;AACA,MAAIC,GAAG,GAAG,cAAIJ,KAAJ,EAAWE,MAAX,EAAmBC,IAAnB,CAAV,CAFO,CAGP;;AACA,MAAIC,GAAG,YAAYC,kBAAnB,EAAgC;AAC9B;AACA,QAAIC,OAAO,GAAG,iBAAQN,KAAR,EAAeI,GAAf,CAAd,CAF8B,CAI9B;;AACA,QAAIE,OAAO,KAAK,IAAhB,EAAsB;AACpB;AACA,UAAIC,CAAC,GAAG,CAAR,CAFoB,CAIpB;;AACA,UAAIC,GAAG,GAAGC,eAAGC,QAAH,CAAYV,KAAZ,EAAmB,cAAIA,KAAJ,EAAWI,GAAX,EAAgB,QAAhB,CAAnB,CAAV,CALoB,CAOpB;;;AACA,aAAOG,CAAC,GAAGC,GAAX,EAAgB;AACd;AACA,YAAIG,UAAU,GAAGZ,uBAAuB,CAACC,KAAD,EAAQC,OAAR,EAAiBG,GAAjB,EAAsBK,eAAGG,QAAH,CAAYZ,KAAZ,EAAmB,IAAIa,kBAAJ,CAAgBb,KAAhB,EAAuBO,CAAvB,CAAnB,CAAtB,CAAxC,CAFc,CAId;;AACA,YAAII,UAAU,YAAYG,qBAA1B,EAA0C;AACxC;AACAV,UAAAA,GAAG,CAACW,OAAJ,CAAYN,eAAGG,QAAH,CAAYZ,KAAZ,EAAmB,IAAIa,kBAAJ,CAAgBb,KAAhB,EAAuBO,CAAvB,CAAnB,CAAZ;AACD,SAHD,MAGO;AACL;AACA;AACAS,6BAAOC,kBAAP,CACEjB,KADF,EAEEI,GAFF,EAGEK,eAAGG,QAAH,CAAYZ,KAAZ,EAAmB,IAAIa,kBAAJ,CAAgBb,KAAhB,EAAuBO,CAAvB,CAAnB,CAHF,EAIEI,UAAU,CAACO,kBAAX,EAJF,EAHK,CAUL;;AACD,SAnBa,CAqBd;;;AACAX,QAAAA,CAAC,IAAI,CAAL;AACD;AACF,KAhCD,MAgCO;AACL;AACA;AACA,UAAIY,IAAI,GAAG,kCAAwBnB,KAAxB,EAA+BI,GAA/B,EAAoC,KAApC,CAAX,CAHK,CAKL;;AACA,WAAK,IAAIgB,CAAT,IAAcD,IAAd,EAAoB;AAClB,gCAAUC,CAAC,YAAYC,kBAAvB,EADkB,CAGlB;;AACA,YAAIV,UAAU,GAAGZ,uBAAuB,CAACC,KAAD,EAAQC,OAAR,EAAiBG,GAAjB,EAAsBgB,CAAtB,CAAxC,CAJkB,CAMlB;;AACA,YAAIT,UAAU,YAAYG,qBAA1B,EAA0C;AACxC;AACAV,UAAAA,GAAG,CAACW,OAAJ,CAAYK,CAAZ;AACD,SAHD,MAGO;AACL;AACA;AACAJ,6BAAOC,kBAAP,CAA0BjB,KAA1B,EAAiCI,GAAjC,EAAsCgB,CAAtC,EAAyCT,UAAzC,EAHK,CAKL;;AACD;AACF;AACF;AACF,GAlEM,CAoEP;;;AACA,SAAO,gBAAKX,KAAL,EAAYC,OAAZ,EAAqBC,MAArB,EAA6B,CAAC,OAAOC,IAAP,KAAgB,QAAhB,GAA2B,IAAIkB,kBAAJ,CAAgBrB,KAAhB,EAAuBG,IAAvB,CAA3B,GAA0DA,IAA3D,EAAiEC,GAAjE,CAA7B,CAAP;AACD","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow strict-local */\n\nimport type { Realm } from \"../realm.js\";\nimport { Value, ObjectValue, NumberValue, UndefinedValue, StringValue } from \"../values/index.js\";\nimport { Create, To } from \"../singletons.js\";\nimport { Get } from \"./get.js\";\nimport { Call } from \"./call.js\";\nimport { IsArray } from \"./is.js\";\nimport { EnumerableOwnProperties } from \"./own.js\";\nimport type { PropertyKeyValue } from \"../types.js\";\nimport invariant from \"../invariant.js\";\n\n// ECMA262 24.3.1.1\nexport function InternalizeJSONProperty(\n  realm: Realm,\n  reviver: ObjectValue,\n  holder: ObjectValue,\n  name: PropertyKeyValue\n): Value {\n  // 1. Let val be ? Get(holder, name).\n  let val = Get(realm, holder, name);\n  // 2. If Type(val) is Object, then\n  if (val instanceof ObjectValue) {\n    // a. Let isArray be ? IsArray(val).\n    let isArray = IsArray(realm, val);\n\n    // b. If isArray is true, then\n    if (isArray === true) {\n      // i. Set I to 0.\n      let I = 0;\n\n      // ii. Let len be ? ToLength(? Get(val, \"length\")).\n      let len = To.ToLength(realm, Get(realm, val, \"length\"));\n\n      // iii. Repeat while I < len,\n      while (I < len) {\n        // 1. Let newElement be ? InternalizeJSONProperty(val, ! ToString(I)).\n        let newElement = InternalizeJSONProperty(realm, reviver, val, To.ToString(realm, new NumberValue(realm, I)));\n\n        // 2. If newElement is undefined, then\n        if (newElement instanceof UndefinedValue) {\n          // a. Perform ? val.[[Delete]](! ToString(I)).\n          val.$Delete(To.ToString(realm, new NumberValue(realm, I)));\n        } else {\n          // 3. Else,\n          // a. Perform ? CreateDataProperty(val, ! ToString(I), newElement).\n          Create.CreateDataProperty(\n            realm,\n            val,\n            To.ToString(realm, new NumberValue(realm, I)),\n            newElement.throwIfNotConcrete()\n          );\n\n          // b. NOTE This algorithm intentionally does not throw an exception if CreateDataProperty returns false.\n        }\n\n        // 4. Add 1 to I.\n        I += 1;\n      }\n    } else {\n      // c. Else,\n      // i. Let keys be ? EnumerableOwnProperties(val, \"key\").\n      let keys = EnumerableOwnProperties(realm, val, \"key\");\n\n      // ii. For each String P in keys do,\n      for (let P of keys) {\n        invariant(P instanceof StringValue);\n\n        // 1. Let newElement be ? InternalizeJSONProperty(val, P).\n        let newElement = InternalizeJSONProperty(realm, reviver, val, P);\n\n        // 2. If newElement is undefined, then\n        if (newElement instanceof UndefinedValue) {\n          // a. Perform ? val.[[Delete]](P).\n          val.$Delete(P);\n        } else {\n          // 3. Else,\n          // a. Perform ? CreateDataProperty(val, P, newElement).\n          Create.CreateDataProperty(realm, val, P, newElement);\n\n          // b. NOTE This algorithm intentionally does not throw an exception if CreateDataProperty returns false.\n        }\n      }\n    }\n  }\n\n  // 3. Return ? Call(reviver, holder, « name, val »).\n  return Call(realm, reviver, holder, [typeof name === \"string\" ? new StringValue(realm, name) : name, val]);\n}\n"],"file":"json.js"}