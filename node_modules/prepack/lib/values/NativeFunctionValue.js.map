{"version":3,"sources":["../../src/values/NativeFunctionValue.js"],"names":["NativeFunctionValue","ECMAScriptFunctionValue","constructor","realm","intrinsicName","name","length","callback","$ThisMode","$HomeObject","undefined","$FunctionKind","$Call","thisArgument","argsList","Functions","$Realm","$ConstructorKind","$Construct","argumentsList","newTarget","$Environment","$GlobalEnv","$DefineOwnProperty","PropertyDescriptor","value","NumberValue","writable","configurable","enumerable","SymbolValue","$Description","throwIfNotConcreteString","StringValue","getTrackedPropertyNames","trackedPropertyNames","hasDefaultLength","getLength","getName","callCallback","context","originalArgsList","originalLength","slice","i","intrinsics","ReturnCompletion","currentLocation","ObjectValue","concat"],"mappings":";;;;;;;AAaA;;AAYA;;AACA;;AACA;;;;AAQA;AACe,MAAMA,mBAAN,SAAkCC,8BAAlC,CAA0D;AACvEC,EAAAA,WAAW,CACTC,KADS,EAETC,aAFS,EAGTC,IAHS,EAITC,MAJS,EAKTC,QALS,EAMTL,WAAqB,GAAG,IANf,EAOT;AACA,UAAMC,KAAN,EAAaC,aAAb;AAEA,SAAKI,SAAL,GAAiB,QAAjB;AACA,SAAKC,WAAL,GAAmBC,SAAnB;AACA,SAAKC,aAAL,GAAqB,QAArB;;AAEA,SAAKC,KAAL,GAAa,CAACC,YAAD,EAAeC,QAAf,KAA4B;AACvC,aAAOC,sBAAUH,KAAV,CAAgB,KAAKI,MAArB,EAA6B,IAA7B,EAAmCH,YAAnC,EAAiDC,QAAjD,CAAP;AACD,KAFD;;AAIA,QAAIZ,WAAJ,EAAiB;AACf,WAAKe,gBAAL,GAAwB,MAAxB;;AACA,WAAKC,UAAL,GAAkB,CAACC,aAAD,EAAgBC,SAAhB,KAA8B;AAC9C,eAAOL,sBAAUG,UAAV,CAAqB,KAAKF,MAA1B,EAAkC,IAAlC,EAAwCG,aAAxC,EAAuDC,SAAvD,CAAP;AACD,OAFD;AAGD;;AAED,SAAKC,YAAL,GAAoBlB,KAAK,CAACmB,UAA1B;AAEA,SAAKf,QAAL,GAAgBA,QAAhB;AACA,SAAKD,MAAL,GAAcA,MAAd;AAEA,SAAKiB,kBAAL,CACE,QADF,EAEE,IAAIC,+BAAJ,CAAuB;AACrBC,MAAAA,KAAK,EAAE,IAAIC,kBAAJ,CAAgBvB,KAAhB,EAAuBG,MAAvB,CADc;AAErBqB,MAAAA,QAAQ,EAAE,KAFW;AAGrBC,MAAAA,YAAY,EAAE,IAHO;AAIrBC,MAAAA,UAAU,EAAE;AAJS,KAAvB,CAFF;;AAUA,QAAIxB,IAAI,KAAKK,SAAT,IAAsBL,IAAI,KAAK,EAAnC,EAAuC;AACrC,UAAIA,IAAI,YAAYyB,kBAApB,EAAiC;AAC/B,aAAKzB,IAAL,GAAYA,IAAI,CAAC0B,YAAL,GAAqB,IAAG1B,IAAI,CAAC0B,YAAL,CAAkBC,wBAAlB,GAA6CP,KAAM,GAA3E,GAAgF,UAA5F;AACD,OAFD,MAEO;AACL,aAAKpB,IAAL,GAAYA,IAAZ;AACD;;AACD,WAAKkB,kBAAL,CACE,MADF,EAEE,IAAIC,+BAAJ,CAAuB;AACrBC,QAAAA,KAAK,EAAE,IAAIQ,kBAAJ,CAAgB9B,KAAhB,EAAuB,KAAKE,IAA5B,CADc;AAErBsB,QAAAA,QAAQ,EAAE,KAFW;AAGrBC,QAAAA,YAAY,EAAE,IAHO;AAIrBC,QAAAA,UAAU,EAAE;AAJS,OAAvB,CAFF;AASD,KAfD,MAeO;AACL,WAAKxB,IAAL,GAAY,QAAZ;AACD;AACF;;AAID6B,EAAAA,uBAAuB,GAAkB;AACvC,WAAOlC,mBAAmB,CAACmC,oBAA3B;AACD;;AAEDC,EAAAA,gBAAgB,GAAY;AAC1B,WAAO,KAAKC,SAAL,OAAqB,KAAK/B,MAAjC;AACD;;AAMD;AACAgC,EAAAA,OAAO,GAAW;AAChB,WAAO,KAAKjC,IAAZ;AACD;;AAEDkC,EAAAA,YAAY,CACVC,OADU,EAEVC,gBAFU,EAGVrB,SAHU,EAIQ;AAClB,QAAIsB,cAAc,GAAGD,gBAAgB,CAACnC,MAAtC;AACA,QAAIQ,QAAQ,GAAG2B,gBAAgB,CAACE,KAAjB,EAAf;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKtC,MAAzB,EAAiCsC,CAAC,EAAlC,EAAsC;AACpC9B,MAAAA,QAAQ,CAAC8B,CAAD,CAAR,GAAcH,gBAAgB,CAACG,CAAD,CAAhB,IAAuB,KAAK5B,MAAL,CAAY6B,UAAZ,CAAuBnC,SAA5D;AACD;;AACD,WAAO,IAAIoC,6BAAJ,CACL,KAAKvC,QAAL,CAAciC,OAAd,EAAuB1B,QAAvB,EAAiC4B,cAAjC,EAAiDtB,SAAjD,CADK,EAEL,KAAKJ,MAAL,CAAY+B,eAFP,CAAP;AAID,GA9FsE,CAgGvE;;;AAhGuE;;;;gBAApD/C,mB,0BA6DWgD,mBAAYb,oBAAZ,CAAiCc,MAAjC,CAAwC,iBAAxC,C","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow strict-local */\n\nimport type { Value } from \"./index.js\";\nimport type { Realm } from \"../realm.js\";\nimport { SymbolValue } from \"./index.js\";\nimport {\n  NumberValue,\n  StringValue,\n  ECMAScriptFunctionValue,\n  ObjectValue,\n  NullValue,\n  ProxyValue,\n  UndefinedValue,\n  AbstractObjectValue,\n} from \"./index.js\";\nimport type { PromiseCapability } from \"../types.js\";\nimport { ReturnCompletion } from \"../completions.js\";\nimport { Functions } from \"../singletons.js\";\nimport { PropertyDescriptor } from \"../descriptors.js\";\nexport type NativeFunctionCallback = (\n  context: UndefinedValue | NullValue | ObjectValue | AbstractObjectValue,\n  args: Array<Value>,\n  argLength: number,\n  newTarget?: void | ObjectValue\n) => Value;\n\n/* Built-in Function Objects */\nexport default class NativeFunctionValue extends ECMAScriptFunctionValue {\n  constructor(\n    realm: Realm,\n    intrinsicName: void | string,\n    name: void | string | SymbolValue,\n    length: number,\n    callback: NativeFunctionCallback,\n    constructor?: boolean = true\n  ) {\n    super(realm, intrinsicName);\n\n    this.$ThisMode = \"strict\";\n    this.$HomeObject = undefined;\n    this.$FunctionKind = \"normal\";\n\n    this.$Call = (thisArgument, argsList) => {\n      return Functions.$Call(this.$Realm, this, thisArgument, argsList);\n    };\n\n    if (constructor) {\n      this.$ConstructorKind = \"base\";\n      this.$Construct = (argumentsList, newTarget) => {\n        return Functions.$Construct(this.$Realm, this, argumentsList, newTarget);\n      };\n    }\n\n    this.$Environment = realm.$GlobalEnv;\n\n    this.callback = callback;\n    this.length = length;\n\n    this.$DefineOwnProperty(\n      \"length\",\n      new PropertyDescriptor({\n        value: new NumberValue(realm, length),\n        writable: false,\n        configurable: true,\n        enumerable: false,\n      })\n    );\n\n    if (name !== undefined && name !== \"\") {\n      if (name instanceof SymbolValue) {\n        this.name = name.$Description ? `[${name.$Description.throwIfNotConcreteString().value}]` : \"[native]\";\n      } else {\n        this.name = name;\n      }\n      this.$DefineOwnProperty(\n        \"name\",\n        new PropertyDescriptor({\n          value: new StringValue(realm, this.name),\n          writable: false,\n          configurable: true,\n          enumerable: false,\n        })\n      );\n    } else {\n      this.name = \"native\";\n    }\n  }\n\n  static trackedPropertyNames = ObjectValue.trackedPropertyNames.concat(\"$RevocableProxy\");\n\n  getTrackedPropertyNames(): Array<string> {\n    return NativeFunctionValue.trackedPropertyNames;\n  }\n\n  hasDefaultLength(): boolean {\n    return this.getLength() === this.length;\n  }\n\n  name: string;\n  callback: NativeFunctionCallback;\n  length: number;\n\n  // Override.\n  getName(): string {\n    return this.name;\n  }\n\n  callCallback(\n    context: UndefinedValue | NullValue | ObjectValue | AbstractObjectValue,\n    originalArgsList: Array<Value>,\n    newTarget?: void | ObjectValue\n  ): ReturnCompletion {\n    let originalLength = originalArgsList.length;\n    let argsList = originalArgsList.slice();\n    for (let i = 0; i < this.length; i++) {\n      argsList[i] = originalArgsList[i] || this.$Realm.intrinsics.undefined;\n    }\n    return new ReturnCompletion(\n      this.callback(context, argsList, originalLength, newTarget),\n      this.$Realm.currentLocation\n    );\n  }\n\n  // for Proxy\n  $RevocableProxy: void | NullValue | ProxyValue;\n\n  // for Promise resolve/reject functions\n  $Promise: ?ObjectValue;\n  $AlreadyResolved: void | { value: boolean };\n\n  // for Promise resolve functions\n  $Capability: void | PromiseCapability;\n  $AlreadyCalled: void | { value: boolean };\n  $Index: void | number;\n  $Values: void | Array<Value>;\n  $Capabilities: void | PromiseCapability;\n  $RemainingElements: void | { value: number };\n}\n"],"file":"NativeFunctionValue.js"}