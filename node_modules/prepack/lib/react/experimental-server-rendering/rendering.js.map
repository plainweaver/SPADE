{"version":3,"sources":["../../../src/react/experimental-server-rendering/rendering.js"],"names":["renderValueWithHelper","realm","value","helper","val","AbstractValue","createFromBuildFunction","Value","dangerousStyleValue","name","isCustomProperty","isEmpty","intrinsics","null","undefined","BooleanValue","StringValue","NumberValue","isUnitlessNumber","hasOwnProperty","trim","createMarkupForCustomAttribute","createMarkupForProperty","htmlEscapeHelper","propertyInfo","attributeName","type","BOOLEAN","OVERLOADED_BOOLEAN","createMarkupForStyles","styles","serialized","delimiter","ObjectValue","isPartialObject","styleName","binding","properties","descriptor","indexOf","styleValue","push","length","renderReactNode","createOpenTagMarkup","tagVerbatim","tagLowercase","propsValue","namespace","makeStaticMarkup","isRootElement","ret","propName","propValue","STYLE","markup","RESERVED_PROPS","has","Array","isArray","reactNode","normalizedNode","args","quasis","lastWasAbstract","element","t","templateElement","raw","cooked","ReactDOMServerRenderer","constructor","previousWasTextNode","arrayHelper","render","depth","rootReactNode","_renderValue","_renderText","text","_renderAbstractConditionalValue","condValue","consequentVal","alternateVal","evaluateWithAbstractConditional","evaluateForEffects","_renderAbstractValue","kind","_renderArrayValue","arrayValue","ArrayValue","isIntrinsicAndHasWidenedNumericProperty","nestedOptimizedFunctionEffects","func","effects","funcCall","result","applyEffects","SimpleNormalCompletion","pureFuncCall","evaluatePure","resolvedEffects","set","collectedNestedOptimizedFunctionEffects","elements","elementValue","renderedElement","_renderReactElement","reactElement","typeValue","AbstractObjectValue","tag","toLowerCase","defaultValueProp","defaultCheckedProp","valueProp","checkedProp","newProps","ObjectPrototype","Properties","Set","inputProps","initialValue","textareaProps","out","footer","omittedCloseTags","innerMarkup","newlineEatingTags","charAt","childrenValue","childrenOut","SymbolValue","UndefinedValue","NullValue","renderToString","staticMarkup","reactStatistics","ReactStatistics","alreadyEvaluated","Map","reconciler","Reconciler","firstRenderOnly","isRoot","modelString","evaluatedRootNode","ECMAScriptSourceFunctionValue","To","ToObject","resolveReactComponentTree","generator","emitStatement","serverRenderer","renderValue"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\n// Warning: This code is experimental and might not fully work. There is no guarantee\n// that it is up-to-date with the current react-dom/server logic and there may also be\n// security holes in the string escaping because of this.\n\nimport type { Realm } from \"../../realm.js\";\nimport { ReactStatistics } from \"../../serializer/types.js\";\nimport { SimpleNormalCompletion } from \"../../completions.js\";\nimport {\n  AbstractObjectValue,\n  AbstractValue,\n  ArrayValue,\n  BooleanValue,\n  ECMAScriptSourceFunctionValue,\n  NullValue,\n  NumberValue,\n  ObjectValue,\n  StringValue,\n  SymbolValue,\n  Value,\n  UndefinedValue,\n} from \"../../values/index.js\";\nimport { Reconciler } from \"../reconcilation.js\";\nimport {\n  applyObjectAssignConfigsForReactElement,\n  createReactEvaluatedNode,\n  forEachArrayValue,\n  getComponentName,\n  getProperty,\n  getReactSymbol,\n  isReactElement,\n} from \"../utils.js\";\nimport * as t from \"@babel/types\";\nimport invariant from \"../../invariant.js\";\nimport {\n  convertValueToNode,\n  createArrayHelper,\n  createHtmlEscapeHelper,\n  createMarkupForRoot,\n  escapeHtml,\n  getNonChildrenInnerMarkup,\n  quoteAttributeValueForBrowser,\n  isCustomComponent,\n  normalizeNode,\n} from \"./utils.js\";\nimport {\n  BOOLEAN,\n  getPropertyInfo,\n  isAttributeNameSafe,\n  isUnitlessNumber,\n  newlineEatingTags,\n  omittedCloseTags,\n  OVERLOADED_BOOLEAN,\n  RESERVED_PROPS,\n  shouldIgnoreAttribute,\n  shouldRemoveAttribute,\n  STYLE,\n} from \"./dom-config.js\";\n// $FlowFixMe: flow complains that this isn't a module but it is, and it seems to load fine\nimport hyphenateStyleName from \"fbjs/lib/hyphenateStyleName\";\nimport { Properties, To } from \"../../singletons.js\";\nimport { createOperationDescriptor } from \"../../utils/generator.js\";\n\nexport type ReactNode = Array<ReactNode> | string | AbstractValue | ArrayValue;\n\nfunction renderValueWithHelper(realm: Realm, value: Value, helper: ECMAScriptSourceFunctionValue): AbstractValue {\n  // given we know nothing of this value, we need to escape the contents of it at runtime\n  let val = AbstractValue.createFromBuildFunction(\n    realm,\n    Value,\n    [helper, value],\n    createOperationDescriptor(\"REACT_SSR_RENDER_VALUE_HELPER\")\n  );\n  invariant(val instanceof AbstractValue);\n  return val;\n}\n\nfunction dangerousStyleValue(realm: Realm, name: string, value: Value, isCustomProperty: boolean): string {\n  let isEmpty =\n    value === realm.intrinsics.null ||\n    value === realm.intrinsics.undefined ||\n    value instanceof BooleanValue ||\n    (value instanceof StringValue && value.value === \"\");\n  if (isEmpty) {\n    return \"\";\n  }\n\n  if (\n    !isCustomProperty &&\n    value instanceof NumberValue &&\n    value.value !== 0 &&\n    !(isUnitlessNumber.hasOwnProperty(name) && isUnitlessNumber[name])\n  ) {\n    return value.value + \"px\";\n  }\n\n  if (value instanceof StringValue || value instanceof NumberValue) {\n    return (\"\" + value.value).trim();\n  } else {\n    invariant(false, \"TODO\");\n  }\n}\n\nexport function createMarkupForCustomAttribute(realm: Realm, name: string, value: Value): ReactNode {\n  if (!isAttributeNameSafe(name) || value == null) {\n    return \"\";\n  }\n  if (value instanceof StringValue || value instanceof NumberValue) {\n    return name + \"=\" + quoteAttributeValueForBrowser(value.value + \"\");\n  } else {\n    invariant(false, \"TODO\");\n  }\n}\n\nfunction createMarkupForProperty(\n  realm: Realm,\n  name: string,\n  value: Value,\n  htmlEscapeHelper: ECMAScriptSourceFunctionValue\n): ReactNode {\n  const propertyInfo = getPropertyInfo(name);\n  if (name !== \"style\" && shouldIgnoreAttribute(name, propertyInfo, false)) {\n    return \"\";\n  }\n  if (shouldRemoveAttribute(realm, name, value, propertyInfo, false)) {\n    return \"\";\n  }\n  if (propertyInfo !== null) {\n    const attributeName = propertyInfo.attributeName;\n    const { type } = propertyInfo;\n    if (type === BOOLEAN || (type === OVERLOADED_BOOLEAN && value === true)) {\n      return attributeName + '=\"\"';\n    } else if (value instanceof StringValue || value instanceof NumberValue || value instanceof BooleanValue) {\n      // $FlowFixMe: Flow complains about booleans being converted to strings, which is the intention\n      return attributeName + \"=\" + quoteAttributeValueForBrowser(value.value + \"\");\n    } else if (value instanceof AbstractValue) {\n      return ([attributeName + \"=\", renderValueWithHelper(realm, value, htmlEscapeHelper)]: Array<ReactNode>);\n    }\n  } else if (value instanceof StringValue || value instanceof NumberValue || value instanceof BooleanValue) {\n    // $FlowFixMe: Flow complains about booleans being converted to strings, which is the intention\n    return name + \"=\" + quoteAttributeValueForBrowser(value.value + \"\");\n  } else if (value instanceof AbstractValue) {\n    return ([name + '=\"', renderValueWithHelper(realm, value, htmlEscapeHelper), '\"']: Array<ReactNode>);\n  }\n  invariant(false, \"TODO\");\n}\n\nfunction createMarkupForStyles(realm: Realm, styles: Value): Value {\n  let serialized = ([]: Array<ReactNode>);\n  let delimiter = \"\";\n\n  if (styles instanceof ObjectValue && !styles.isPartialObject()) {\n    for (let [styleName, binding] of styles.properties) {\n      if (binding.descriptor !== undefined) {\n        let isCustomProperty = styleName.indexOf(\"--\") === 0;\n        let styleValue = getProperty(realm, styles, styleName);\n\n        if (styleValue !== realm.intrinsics.null && styleValue !== realm.intrinsics.undefined) {\n          serialized.push(delimiter + hyphenateStyleName(styleName) + \":\");\n          serialized.push(dangerousStyleValue(realm, styleName, styleValue, isCustomProperty));\n          delimiter = \";\";\n        }\n      }\n    }\n  }\n  if (serialized.length > 0) {\n    return renderReactNode(realm, serialized);\n  }\n  return realm.intrinsics.null;\n}\n\nfunction createOpenTagMarkup(\n  realm: Realm,\n  tagVerbatim: string,\n  tagLowercase: string,\n  propsValue: ObjectValue | AbstractObjectValue,\n  namespace: string,\n  makeStaticMarkup: boolean,\n  isRootElement: boolean,\n  htmlEscapeHelper: ECMAScriptSourceFunctionValue\n): Array<ReactNode> {\n  let ret = [\"<\" + tagVerbatim];\n\n  if (propsValue instanceof ObjectValue && !propsValue.isPartialObject()) {\n    for (let [propName, binding] of propsValue.properties) {\n      if (binding.descriptor !== undefined) {\n        let propValue = getProperty(realm, propsValue, propName);\n        if (propValue === realm.intrinsics.null || propValue === realm.intrinsics.undefined) {\n          continue;\n        }\n        if (propName === STYLE) {\n          propValue = createMarkupForStyles(realm, propValue);\n        }\n        let markup;\n\n        if (isCustomComponent(realm, tagLowercase, propsValue)) {\n          if (!RESERVED_PROPS.has(propName)) {\n            markup = createMarkupForCustomAttribute(realm, propName, propValue);\n          }\n        } else {\n          markup = createMarkupForProperty(realm, propName, propValue, htmlEscapeHelper);\n        }\n        if (Array.isArray(markup)) {\n          ret.push(\" \", ...markup);\n        } else if (typeof markup === \"string\" && markup !== \"\") {\n          ret.push(\" \" + markup);\n        } else if (markup) {\n          ret.push(\" \", markup);\n        }\n      }\n    }\n  } else {\n    invariant(false, \"TODO\");\n  }\n\n  // For static pages, no need to put React ID and checksum. Saves lots of\n  // bytes.\n  if (makeStaticMarkup) {\n    return ret;\n  }\n\n  if (isRootElement) {\n    ret.push(\" \" + createMarkupForRoot());\n  }\n  return ret;\n}\n\nfunction renderReactNode(realm: Realm, reactNode: ReactNode): StringValue | AbstractValue {\n  let normalizedNode = normalizeNode(realm, reactNode);\n  if (typeof normalizedNode === \"string\") {\n    return new StringValue(realm, normalizedNode);\n  } else if (normalizedNode instanceof AbstractValue) {\n    return normalizedNode;\n  }\n  invariant(Array.isArray(normalizedNode));\n  let args = [];\n  let quasis = [];\n  let lastWasAbstract = false;\n  for (let element of normalizedNode) {\n    if (typeof element === \"string\") {\n      lastWasAbstract = false;\n      quasis.push(t.templateElement({ raw: element, cooked: element }));\n    } else {\n      if (lastWasAbstract) {\n        quasis.push(t.templateElement({ raw: \"\", cooked: \"\" }));\n      }\n      lastWasAbstract = true;\n      invariant(element instanceof Value);\n      args.push(element);\n    }\n  }\n  let val = AbstractValue.createFromBuildFunction(\n    realm,\n    StringValue,\n    args,\n    createOperationDescriptor(\"REACT_SSR_TEMPLATE_LITERAL\", { quasis })\n  );\n  invariant(val instanceof AbstractValue);\n  return val;\n}\n\nclass ReactDOMServerRenderer {\n  constructor(realm: Realm, makeStaticMarkup: boolean) {\n    this.realm = realm;\n    this.makeStaticMarkup = makeStaticMarkup;\n    this.previousWasTextNode = false;\n    this.htmlEscapeHelper = createHtmlEscapeHelper(realm);\n    this.arrayHelper = createArrayHelper(realm);\n  }\n  realm: Realm;\n  makeStaticMarkup: boolean;\n  previousWasTextNode: boolean;\n  htmlEscapeHelper: ECMAScriptSourceFunctionValue;\n  arrayHelper: ECMAScriptSourceFunctionValue;\n\n  render(value: Value, namespace: string = \"html\", depth: number = 0): StringValue | AbstractValue {\n    let rootReactNode = this._renderValue(value, namespace, depth);\n    return renderReactNode(this.realm, rootReactNode);\n  }\n\n  _renderText(value: StringValue | NumberValue): string {\n    let text = value.value + \"\";\n\n    if (text === \"\") {\n      return \"\";\n    }\n    if (this.makeStaticMarkup) {\n      return escapeHtml(text);\n    }\n    if (this.previousWasTextNode) {\n      return \"<!-- -->\" + escapeHtml(text);\n    }\n    this.previousWasTextNode = true;\n    return escapeHtml(text);\n  }\n\n  _renderAbstractConditionalValue(\n    condValue: AbstractValue,\n    consequentVal: Value,\n    alternateVal: Value,\n    namespace: string,\n    depth: number\n  ): ReactNode {\n    let val = this.realm.evaluateWithAbstractConditional(\n      condValue,\n      () => {\n        return this.realm.evaluateForEffects(\n          () => this.render(consequentVal, namespace, depth),\n          null,\n          \"_renderAbstractConditionalValue consequent\"\n        );\n      },\n      () => {\n        return this.realm.evaluateForEffects(\n          () => this.render(alternateVal, namespace, depth),\n          null,\n          \"_renderAbstractConditionalValue consequent\"\n        );\n      }\n    );\n    return convertValueToNode(val);\n  }\n\n  _renderAbstractValue(value: AbstractValue, namespace: string, depth: number): ReactNode {\n    if (value.kind === \"conditional\") {\n      let [condValue, consequentVal, alternateVal] = value.args;\n      invariant(condValue instanceof AbstractValue);\n      return this._renderAbstractConditionalValue(condValue, consequentVal, alternateVal, namespace, depth);\n    } else {\n      return renderValueWithHelper(this.realm, value, this.htmlEscapeHelper);\n    }\n  }\n\n  _renderArrayValue(arrayValue: ArrayValue, namespace: string, depth: number): Array<ReactNode> | ReactNode {\n    if (ArrayValue.isIntrinsicAndHasWidenedNumericProperty(arrayValue)) {\n      let nestedOptimizedFunctionEffects = arrayValue.nestedOptimizedFunctionEffects;\n\n      if (nestedOptimizedFunctionEffects !== undefined) {\n        for (let [func, effects] of nestedOptimizedFunctionEffects) {\n          let funcCall = () => {\n            let result = effects.result;\n            this.realm.applyEffects(effects);\n            if (result instanceof SimpleNormalCompletion) {\n              result = result.value;\n            }\n            invariant(result instanceof Value);\n            return this.render(result, namespace, depth);\n          };\n          let pureFuncCall = () =>\n            this.realm.evaluatePure(funcCall, /*bubbles*/ true, () => {\n              invariant(false, \"SSR _renderArrayValue side-effect should have been caught in main React reconciler\");\n            });\n\n          let resolvedEffects;\n          resolvedEffects = this.realm.evaluateForEffects(\n            pureFuncCall,\n            /*state*/ null,\n            `react SSR resolve nested optimized closure`\n          );\n          nestedOptimizedFunctionEffects.set(func, resolvedEffects);\n          this.realm.collectedNestedOptimizedFunctionEffects.set(func, resolvedEffects);\n        }\n        return renderValueWithHelper(this.realm, arrayValue, this.arrayHelper);\n      }\n    }\n    let elements = [];\n    forEachArrayValue(this.realm, arrayValue, elementValue => {\n      let renderedElement = this._renderValue(elementValue, namespace, depth);\n      if (Array.isArray(renderedElement)) {\n        elements.push(...renderedElement);\n      } else {\n        elements.push(renderedElement);\n      }\n    });\n    // $FlowFixMe: flow gets confused here\n    return elements;\n  }\n\n  _renderReactElement(reactElement: ObjectValue, namespace: string, depth: number): Array<ReactNode> {\n    let typeValue = getProperty(this.realm, reactElement, \"type\");\n    let propsValue = getProperty(this.realm, reactElement, \"props\");\n\n    invariant(propsValue instanceof AbstractObjectValue || propsValue instanceof ObjectValue);\n    if (typeValue instanceof StringValue) {\n      let type = typeValue.value;\n      let tag = type.toLowerCase();\n\n      if (tag === \"input\") {\n        let defaultValueProp = getProperty(this.realm, propsValue, \"defaultValue\");\n        let defaultCheckedProp = getProperty(this.realm, propsValue, \"defaultChecked\");\n        let valueProp = getProperty(this.realm, propsValue, \"value\");\n        let checkedProp = getProperty(this.realm, propsValue, \"checked\");\n\n        let newProps = new ObjectValue(this.realm, this.realm.intrinsics.ObjectPrototype);\n        Properties.Set(this.realm, newProps, \"type\", this.realm.intrinsics.undefined, true);\n\n        let inputProps = new ObjectValue(this.realm, this.realm.intrinsics.ObjectPrototype);\n        Properties.Set(this.realm, inputProps, \"defaultChecked\", this.realm.intrinsics.undefined, true);\n        Properties.Set(this.realm, inputProps, \"defaultValue\", this.realm.intrinsics.undefined, true);\n        Properties.Set(\n          this.realm,\n          inputProps,\n          \"value\",\n          valueProp !== this.realm.intrinsics.null ? valueProp : defaultValueProp,\n          true\n        );\n        Properties.Set(\n          this.realm,\n          inputProps,\n          \"checked\",\n          checkedProp !== this.realm.intrinsics.null ? checkedProp : defaultCheckedProp,\n          true\n        );\n        applyObjectAssignConfigsForReactElement(this.realm, newProps, [propsValue, inputProps]);\n        propsValue = newProps;\n      } else if (tag === \"textarea\") {\n        let initialValue = getProperty(this.realm, propsValue, \"value\");\n\n        if (initialValue === this.realm.intrinsics.null) {\n          invariant(false, \"TODO\");\n        }\n\n        let newProps = new ObjectValue(this.realm, this.realm.intrinsics.ObjectPrototype);\n        let textareaProps = new ObjectValue(this.realm, this.realm.intrinsics.ObjectPrototype);\n        Properties.Set(this.realm, textareaProps, \"value\", this.realm.intrinsics.undefined, true);\n        Properties.Set(this.realm, textareaProps, \"children\", initialValue, true);\n        applyObjectAssignConfigsForReactElement(this.realm, newProps, [propsValue, textareaProps]);\n        propsValue = newProps;\n      } else if (tag === \"select\") {\n        invariant(false, \"TODO\");\n      } else if (tag === \"option\") {\n        invariant(false, \"TODO\");\n      }\n      let out = createOpenTagMarkup(\n        this.realm,\n        type,\n        tag,\n        propsValue,\n        namespace,\n        this.makeStaticMarkup,\n        depth === 0,\n        this.htmlEscapeHelper\n      );\n      let footer = \"\";\n\n      if (omittedCloseTags.has(tag)) {\n        out.push(\"/>\");\n      } else {\n        out.push(\">\");\n        footer = \"</\" + type + \">\";\n      }\n      let innerMarkup = getNonChildrenInnerMarkup(this.realm, propsValue);\n      if (innerMarkup instanceof StringValue) {\n        if (newlineEatingTags[tag] && innerMarkup.value.charAt(0) === \"\\n\") {\n          out.push(\"\\n\");\n        }\n        out.push(innerMarkup.value);\n      } else if (innerMarkup instanceof ObjectValue) {\n        invariant(false, \"TODO\");\n      } else {\n        this.previousWasTextNode = false;\n        let childrenValue = getProperty(this.realm, propsValue, \"children\");\n        let childrenOut = this._renderValue(childrenValue, namespace, depth + 1);\n\n        if (Array.isArray(childrenOut)) {\n          out.push(...childrenOut);\n        } else {\n          out.push(childrenOut);\n        }\n      }\n      out.push(footer);\n      this.previousWasTextNode = false;\n      return out;\n    } else if (typeValue instanceof SymbolValue && typeValue === getReactSymbol(\"react.fragment\", this.realm)) {\n      let childrenValue = getProperty(this.realm, propsValue, \"children\");\n      let childrenOut = this._renderValue(childrenValue, namespace, depth + 1);\n      let out = [];\n\n      if (Array.isArray(childrenOut)) {\n        out.push(...childrenOut);\n      } else {\n        out.push(childrenOut);\n      }\n      this.previousWasTextNode = false;\n      return out;\n    } else {\n      invariant(false, \"TODO\");\n    }\n  }\n\n  _renderValue(value: Value, namespace: string, depth: number): ReactNode {\n    if (value instanceof StringValue || value instanceof NumberValue) {\n      return this._renderText(value);\n    } else if (value instanceof ObjectValue && isReactElement(value)) {\n      return this._renderReactElement(value, namespace, depth);\n    } else if (value instanceof AbstractValue) {\n      return this._renderAbstractValue(value, namespace, depth);\n    } else if (value instanceof ArrayValue) {\n      return this._renderArrayValue(value, namespace, depth);\n    } else if (value instanceof BooleanValue || value instanceof UndefinedValue || value instanceof NullValue) {\n      return \"\";\n    }\n    invariant(false, \"TODO\");\n  }\n}\n\nexport function renderToString(\n  realm: Realm,\n  reactElement: ObjectValue,\n  staticMarkup: boolean\n): StringValue | AbstractValue {\n  let reactStatistics = new ReactStatistics();\n  let alreadyEvaluated = new Map();\n  let reconciler = new Reconciler(\n    realm,\n    { firstRenderOnly: true, isRoot: true, modelString: undefined },\n    alreadyEvaluated,\n    reactStatistics\n  );\n  let typeValue = getProperty(realm, reactElement, \"type\");\n  let propsValue = getProperty(realm, reactElement, \"props\");\n  let evaluatedRootNode = createReactEvaluatedNode(\"ROOT\", getComponentName(realm, typeValue));\n  invariant(typeValue instanceof ECMAScriptSourceFunctionValue);\n  if (propsValue instanceof AbstractValue && !(propsValue instanceof AbstractObjectValue)) {\n    propsValue = To.ToObject(realm, propsValue);\n  }\n  invariant(propsValue instanceof ObjectValue || propsValue instanceof AbstractObjectValue);\n  let effects = reconciler.resolveReactComponentTree(typeValue, propsValue, null, evaluatedRootNode);\n\n  invariant(realm.generator);\n  // create a single regex used for the escape functions\n  // by hoisting it, it gets cached by the VM JITs\n  realm.generator.emitStatement([], createOperationDescriptor(\"REACT_SSR_REGEX_CONSTANT\"));\n  invariant(realm.generator);\n  realm.generator.emitStatement([], createOperationDescriptor(\"REACT_SSR_PREV_TEXT_NODE\"));\n  invariant(effects);\n  realm.applyEffects(effects);\n  invariant(effects.result instanceof SimpleNormalCompletion);\n  let serverRenderer = new ReactDOMServerRenderer(realm, staticMarkup);\n  let renderValue = serverRenderer.render(effects.result.value);\n  return renderValue;\n}\n"],"file":"rendering.js"}