{"version":3,"sources":["../../../src/intrinsics/ecma262/SetIteratorPrototype.js"],"names":["realm","obj","defineNativeMethod","context","O","throwIfNotConcrete","ObjectValue","createErrorThrowCompletion","intrinsics","TypeError","s","$IteratedSet","index","$SetNextIndex","itemKind","$SetIterationKind","UndefinedValue","Create","CreateIterResultObject","undefined","$SetData","entries","length","e","CreateArrayFromList","defineNativeProperty","SymbolToStringTag","StringValue","writable"],"mappings":";;;;;;;AAYA;;AACA;;AACA;;;;AAdA;;;;;;;;;AASA;AAOe,kBAASA,KAAT,EAAuBC,GAAvB,EAA+C;AAC5D;AACAA,EAAAA,GAAG,CAACC,kBAAJ,CAAuB,MAAvB,EAA+B,CAA/B,EAAkCC,OAAO,IAAI;AAC3C;AACA,QAAIC,CAAC,GAAGD,OAAO,CAACE,kBAAR,EAAR,CAF2C,CAI3C;;AACA,QAAI,EAAED,CAAC,YAAYE,kBAAf,CAAJ,EAAiC;AAC/B,YAAMN,KAAK,CAACO,0BAAN,CAAiCP,KAAK,CAACQ,UAAN,CAAiBC,SAAlD,EAA6D,eAA7D,CAAN;AACD,KAP0C,CAS3C;;;AACA,QAAI,EAAE,kBAAkBL,CAApB,KAA0B,EAAE,mBAAmBA,CAArB,CAA1B,IAAqD,EAAE,uBAAuBA,CAAzB,CAAzD,EAAsF;AACpF,YAAMJ,KAAK,CAACO,0BAAN,CAAiCP,KAAK,CAACQ,UAAN,CAAiBC,SAAlD,EAA6D,yCAA7D,CAAN;AACD,KAZ0C,CAc3C;;;AACA,QAAIC,CAAC,GAAGN,CAAC,CAACO,YAAV,CAf2C,CAiB3C;;AACA,QAAIC,KAAK,GAAGR,CAAC,CAACS,aAAd;AACA,4BAAU,OAAOD,KAAP,KAAiB,QAA3B,EAnB2C,CAqB3C;;AACA,QAAIE,QAAQ,GAAGV,CAAC,CAACW,iBAAjB,CAtB2C,CAwB3C;;AACA,QAAI,CAACL,CAAD,IAAMA,CAAC,YAAYM,qBAAvB,EACE,OAAOC,mBAAOC,sBAAP,CAA8BlB,KAA9B,EAAqCA,KAAK,CAACQ,UAAN,CAAiBW,SAAtD,EAAiE,IAAjE,CAAP;AACF,4BAAUT,CAAC,YAAYJ,kBAAvB,EA3B2C,CA6B3C;;AACA,4BAAUI,CAAC,CAACU,QAAZ,EAAsB,mCAAtB,EA9B2C,CAgC3C;;AACA,QAAIC,OAAO,GAAGX,CAAC,CAACU,QAAhB;AACA,4BAAUC,OAAV,EAlC2C,CAoC3C;;AACA,WAAOT,KAAK,GAAGS,OAAO,CAACC,MAAvB,EAA+B;AAC7B;AACA,UAAIC,CAAC,GAAGF,OAAO,CAACT,KAAD,CAAf,CAF6B,CAI7B;;AACAA,MAAAA,KAAK,GAAGA,KAAK,GAAG,CAAhB,CAL6B,CAO7B;;AACAR,MAAAA,CAAC,CAACS,aAAF,GAAkBD,KAAlB,CAR6B,CAU7B;;AACA,UAAIW,CAAJ,EAAO;AACL;AACA,YAAIT,QAAQ,KAAK,WAAjB,EAA8B;AAC5B;AACA,iBAAOG,mBAAOC,sBAAP,CAA8BlB,KAA9B,EAAqCiB,mBAAOO,mBAAP,CAA2BxB,KAA3B,EAAkC,CAACuB,CAAD,EAAIA,CAAJ,CAAlC,CAArC,EAAgF,KAAhF,CAAP;AACD,SALI,CAML;;;AACA,eAAON,mBAAOC,sBAAP,CAA8BlB,KAA9B,EAAqCuB,CAArC,EAAwC,KAAxC,CAAP;AACD;AACF,KAzD0C,CA2D3C;;;AACAnB,IAAAA,CAAC,CAACO,YAAF,GAAiBX,KAAK,CAACQ,UAAN,CAAiBW,SAAlC,CA5D2C,CA8D3C;;AACA,WAAOF,mBAAOC,sBAAP,CAA8BlB,KAA9B,EAAqCA,KAAK,CAACQ,UAAN,CAAiBW,SAAtD,EAAiE,IAAjE,CAAP;AACD,GAhED,EAF4D,CAoE5D;;AACAlB,EAAAA,GAAG,CAACwB,oBAAJ,CAAyBzB,KAAK,CAACQ,UAAN,CAAiBkB,iBAA1C,EAA6D,IAAIC,kBAAJ,CAAgB3B,KAAhB,EAAuB,cAAvB,CAA7D,EAAqG;AACnG4B,IAAAA,QAAQ,EAAE;AADyF,GAArG;AAGD","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow strict-local */\n\nimport type { Realm } from \"../../realm.js\";\nimport { StringValue, ObjectValue, UndefinedValue } from \"../../values/index.js\";\nimport { Create } from \"../../singletons.js\";\nimport invariant from \"../../invariant.js\";\n\nexport default function(realm: Realm, obj: ObjectValue): void {\n  // ECMA262 23.2.5.2.1\n  obj.defineNativeMethod(\"next\", 0, context => {\n    // 1. Let O be the this value.\n    let O = context.throwIfNotConcrete();\n\n    // 2. If Type(O) is not Object, throw a TypeError exception.\n    if (!(O instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"not an object\");\n    }\n\n    // 3. If O does not have all of the internal slots of a Set Iterator Instance (23.2.5.3), throw a TypeError exception.\n    if (!(\"$IteratedSet\" in O) || !(\"$SetNextIndex\" in O) || !(\"$SetIterationKind\" in O)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"SetIteratorPrototype.next isn't generic\");\n    }\n\n    // 4. Let s be O.[[IteratedSet]].\n    let s = O.$IteratedSet;\n\n    // 5. Let index be O.[[SetNextIndex]].\n    let index = O.$SetNextIndex;\n    invariant(typeof index === \"number\");\n\n    // 6. Let itemKind be O.[[SetIterationKind]].\n    let itemKind = O.$SetIterationKind;\n\n    // 7. If s is undefined, return CreateIterResultObject(undefined, true).\n    if (!s || s instanceof UndefinedValue)\n      return Create.CreateIterResultObject(realm, realm.intrinsics.undefined, true);\n    invariant(s instanceof ObjectValue);\n\n    // 8. Assert: s has a [[SetData]] internal slot.\n    invariant(s.$SetData, \"s has a [[SetData]] internal slot\");\n\n    // 9. Let entries be the List that is s.[[SetData]].\n    let entries = s.$SetData;\n    invariant(entries);\n\n    // 10. Repeat while index is less than the total number of elements of entries. The number of elements must be redetermined each time this method is evaluated.\n    while (index < entries.length) {\n      // a. Let e be entries[index].\n      let e = entries[index];\n\n      // b. Set index to index+1.\n      index = index + 1;\n\n      // c. Set O.[[SetNextIndex]] to index.\n      O.$SetNextIndex = index;\n\n      // d. If e is not empty, then\n      if (e) {\n        // i. If itemKind is \"key+value\", then\n        if (itemKind === \"key+value\") {\n          // 1. Return CreateIterResultObject(CreateArrayFromList(« e, e »), false).\n          return Create.CreateIterResultObject(realm, Create.CreateArrayFromList(realm, [e, e]), false);\n        }\n        // ii. Return CreateIterResultObject(e, false).\n        return Create.CreateIterResultObject(realm, e, false);\n      }\n    }\n\n    // 11. Set O.[[IteratedSet]] to undefined.\n    O.$IteratedSet = realm.intrinsics.undefined;\n\n    // 12. Return CreateIterResultObject(undefined, true).\n    return Create.CreateIterResultObject(realm, realm.intrinsics.undefined, true);\n  });\n\n  // ECMA262 23.2.5.2.2\n  obj.defineNativeProperty(realm.intrinsics.SymbolToStringTag, new StringValue(realm, \"Set Iterator\"), {\n    writable: false,\n  });\n}\n"],"file":"SetIteratorPrototype.js"}