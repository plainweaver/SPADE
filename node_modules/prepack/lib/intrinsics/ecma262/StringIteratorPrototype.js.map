{"version":3,"sources":["../../../src/intrinsics/ecma262/StringIteratorPrototype.js"],"names":["realm","obj","defineNativeMethod","context","O","throwIfNotConcrete","ObjectValue","createErrorThrowCompletion","intrinsics","TypeError","s","$IteratedString","Create","CreateIterResultObject","undefined","position","$StringIteratorNextIndex","len","value","length","first","charCodeAt","resultString","String","fromCharCode","second","resultSize","StringValue","defineNativeProperty","SymbolToStringTag","writable"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow strict-local */\n\nimport type { Realm } from \"../../realm.js\";\nimport { Create } from \"../../singletons.js\";\nimport { ObjectValue, StringValue } from \"../../values/index.js\";\nimport invariant from \"../../invariant.js\";\n\nexport default function(realm: Realm, obj: ObjectValue): void {\n  // ECMA262 21.1.5.2.1\n  obj.defineNativeMethod(\"next\", 0, context => {\n    // 1. Let O be the this value.\n    let O = context.throwIfNotConcrete();\n\n    // 2. If Type(O) is not Object, throw a TypeError exception.\n    if (!(O instanceof ObjectValue)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"Type(O) is not Object\");\n    }\n\n    // 3. If O does not have all of the internal slots of an String Iterator Instance (21.1.5.3), throw a TypeError exception.\n    if (!(\"$IteratedString\" in O && \"$StringIteratorNextIndex\" in O)) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"Type(O) is not Object\");\n    }\n\n    // 4. Let s be O.[[IteratedString]].\n    let s = O.$IteratedString;\n\n    // 5. If s is undefined, return CreateIterResultObject(undefined, true).\n    if (!s) {\n      return Create.CreateIterResultObject(realm, realm.intrinsics.undefined, true);\n    }\n\n    // 6. Let position be O.[[StringIteratorNextIndex]].\n    let position = O.$StringIteratorNextIndex;\n    invariant(typeof position === \"number\");\n\n    // 7. Let len be the number of elements in s.\n    let len = s.value.length;\n\n    // 8. If position â‰¥ len, then\n    if (position >= len) {\n      // a. Set O.[[IteratedString]] to undefined.\n      O.$IteratedString = undefined;\n\n      // b. Return CreateIterResultObject(undefined, true).\n      return Create.CreateIterResultObject(realm, realm.intrinsics.undefined, true);\n    }\n\n    // 9. Let first be the code unit value at index position in s.\n    let first = s.value.charCodeAt(position);\n\n    let resultString;\n    // 10. If first < 0xD800 or first > 0xDBFF or position+1 = len, let resultString be the string consisting of the single code unit first.\n    if (first < 0xd800 || first > 0xdbff || position + 1 === len) {\n      resultString = String.fromCharCode(first);\n    } else {\n      // 11. Else,\n      // a. Let second be the code unit value at index position+1 in the String s.\n      let second = s.value.charCodeAt(position + 1);\n\n      // b. If second < 0xDC00 or second > 0xDFFF, let resultString be the string consisting of the single code unit first.\n      if (second < 0xdc00 || second > 0xdfff) {\n        resultString = String.fromCharCode(first);\n      } else {\n        // c. Else, let resultString be the string consisting of the code unit first followed by the code unit second.\n        resultString = String.fromCharCode(first, second);\n      }\n    }\n    // 12. Let resultSize be the number of code units in resultString.\n    let resultSize = resultString.length;\n\n    // 13. Set O.[[StringIteratorNextIndex]] to position + resultSize.\n    O.$StringIteratorNextIndex = position + resultSize;\n\n    // 14. Return CreateIterResultObject(resultString, false).\n    return Create.CreateIterResultObject(realm, new StringValue(realm, resultString), false);\n  });\n\n  // ECMA262 21.1.5.2.2\n  obj.defineNativeProperty(realm.intrinsics.SymbolToStringTag, new StringValue(realm, \"String Iterator\"), {\n    writable: false,\n  });\n}\n"],"file":"StringIteratorPrototype.js"}