{"version":3,"sources":["../../../src/intrinsics/ecma262/Proxy.js"],"names":["realm","func","NativeFunctionValue","context","target","handler","argCount","NewTarget","createErrorThrowCompletion","intrinsics","TypeError","defineNativeMethod","p","revoker","createRevoker","$RevocableProxy","result","Create","ObjectCreate","ObjectPrototype","CreateDataProperty","F","undefined","NullValue","null","ProxyValue","$ProxyTarget","$ProxyHandler"],"mappings":";;;;;;;AAYA;;AACA;;AACA;;AACA;;;;AAfA;;;;;;;;;AASA;AAQe,kBAASA,KAAT,EAA4C;AACzD;AACA,MAAIC,IAAI,GAAG,IAAIC,0BAAJ,CAAwBF,KAAxB,EAA+B,OAA/B,EAAwC,OAAxC,EAAiD,CAAjD,EAAoD,CAACG,OAAD,EAAU,CAACC,MAAD,EAASC,OAAT,CAAV,EAA6BC,QAA7B,EAAuCC,SAAvC,KAAqD;AAClH;AACA,QAAI,CAACA,SAAL,EAAgB;AACd,YAAMP,KAAK,CAACQ,0BAAN,CAAiCR,KAAK,CAACS,UAAN,CAAiBC,SAAlD,CAAN;AACD,KAJiH,CAMlH;;;AACA,WAAO,wBAAYV,KAAZ,EAAmBI,MAAnB,EAA2BC,OAA3B,CAAP;AACD,GARU,CAAX,CAFyD,CAYzD;;AACAJ,EAAAA,IAAI,CAACU,kBAAL,CAAwB,WAAxB,EAAqC,CAArC,EAAwC,CAACR,OAAD,EAAU,CAACC,MAAD,EAASC,OAAT,CAAV,KAAgC;AACtE;AACA,QAAIO,CAAC,GAAG,wBAAYZ,KAAZ,EAAmBI,MAAnB,EAA2BC,OAA3B,CAAR,CAFsE,CAItE;;AACA,QAAIQ,OAAO,GAAGC,aAAa,EAA3B,CALsE,CAOtE;;AACAD,IAAAA,OAAO,CAACE,eAAR,GAA0BH,CAA1B,CARsE,CAUtE;;AACA,QAAII,MAAM,GAAGC,mBAAOC,YAAP,CAAoBlB,KAApB,EAA2BA,KAAK,CAACS,UAAN,CAAiBU,eAA5C,CAAb,CAXsE,CAatE;;;AACAF,uBAAOG,kBAAP,CAA0BpB,KAA1B,EAAiCgB,MAAjC,EAAyC,OAAzC,EAAkDJ,CAAlD,EAdsE,CAgBtE;;;AACAK,uBAAOG,kBAAP,CAA0BpB,KAA1B,EAAiCgB,MAAjC,EAAyC,QAAzC,EAAmDH,OAAnD,EAjBsE,CAmBtE;;;AACA,WAAOG,MAAP;AACD,GArBD;;AAuBA,WAASF,aAAT,GAAyB;AACvB,QAAIO,CAAC,GAAG,IAAInB,0BAAJ,CACNF,KADM,EAENsB,SAFM,EAGNA,SAHM,EAIN,CAJM,EAKN,CAACnB,OAAD,EAAU,CAACC,MAAD,EAASC,OAAT,CAAV,EAA6BC,QAA7B,EAAuCC,SAAvC,KAAqD;AACnD;AACA,UAAIK,CAAC,GAAGS,CAAC,CAACN,eAAV,CAFmD,CAInD;;AACA,UAAIH,CAAC,YAAYW,gBAAjB,EAA4B,OAAOvB,KAAK,CAACS,UAAN,CAAiBa,SAAxB,CALuB,CAOnD;;AACAD,MAAAA,CAAC,CAACN,eAAF,GAAoBf,KAAK,CAACS,UAAN,CAAiBe,IAArC,CARmD,CAUnD;;AACA,8BAAUZ,CAAC,YAAYa,iBAAvB,EAAmC,gBAAnC,EAXmD,CAanD;;AACAb,MAAAA,CAAC,CAACc,YAAF,GAAiB1B,KAAK,CAACS,UAAN,CAAiBe,IAAlC,CAdmD,CAgBnD;;AACAZ,MAAAA,CAAC,CAACe,aAAF,GAAkB3B,KAAK,CAACS,UAAN,CAAiBe,IAAnC,CAjBmD,CAmBnD;;AACA,aAAOxB,KAAK,CAACS,UAAN,CAAiBa,SAAxB;AACD,KA1BK,EA2BN,KA3BM,CAAR;AA8BA,WAAOD,CAAP;AACD;;AAED,SAAOpB,IAAP;AACD","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow strict-local */\n\nimport type { Realm } from \"../../realm.js\";\nimport { ProxyValue, NullValue, NativeFunctionValue } from \"../../values/index.js\";\nimport { Create } from \"../../singletons.js\";\nimport { ProxyCreate } from \"../../methods/proxy.js\";\nimport invariant from \"../../invariant.js\";\n\nexport default function(realm: Realm): NativeFunctionValue {\n  // ECMA262 26.2.1.1\n  let func = new NativeFunctionValue(realm, \"Proxy\", \"Proxy\", 2, (context, [target, handler], argCount, NewTarget) => {\n    // 1. If NewTarget is undefined, throw a TypeError exception.\n    if (!NewTarget) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n\n    // 2. Return ? ProxyCreate(target, handler).\n    return ProxyCreate(realm, target, handler);\n  });\n\n  // ECMA262 26.2.2.1\n  func.defineNativeMethod(\"revocable\", 2, (context, [target, handler]) => {\n    // 1. Let p be ? ProxyCreate(target, handler).\n    let p = ProxyCreate(realm, target, handler);\n\n    // 2. Let revoker be a new built-in function object as defined in 26.2.2.1.1.\n    let revoker = createRevoker();\n\n    // 3. Set the [[RevocableProxy]] internal slot of revoker to p.\n    revoker.$RevocableProxy = p;\n\n    // 4. Let result be ObjectCreate(%ObjectPrototype%).\n    let result = Create.ObjectCreate(realm, realm.intrinsics.ObjectPrototype);\n\n    // 5. Perform CreateDataProperty(result, \"proxy\", p).\n    Create.CreateDataProperty(realm, result, \"proxy\", p);\n\n    // 6. Perform CreateDataProperty(result, \"revoke\", revoker).\n    Create.CreateDataProperty(realm, result, \"revoke\", revoker);\n\n    // 7. Return result.\n    return result;\n  });\n\n  function createRevoker() {\n    let F = new NativeFunctionValue(\n      realm,\n      undefined,\n      undefined,\n      0,\n      (context, [target, handler], argCount, NewTarget) => {\n        // 1. Let p be the value of F's [[RevocableProxy]] internal slot.\n        let p = F.$RevocableProxy;\n\n        // 2. If p is null, return undefined.\n        if (p instanceof NullValue) return realm.intrinsics.undefined;\n\n        // 3. Set the value of F's [[RevocableProxy]] internal slot to null.\n        F.$RevocableProxy = realm.intrinsics.null;\n\n        // 4. Assert: p is a Proxy object.\n        invariant(p instanceof ProxyValue, \"expected proxy\");\n\n        // 5. Set the [[ProxyTarget]] internal slot of p to null.\n        p.$ProxyTarget = realm.intrinsics.null;\n\n        // 6. Set the [[ProxyHandler]] internal slot of p to null.\n        p.$ProxyHandler = realm.intrinsics.null;\n\n        // 7. Return undefined.\n        return realm.intrinsics.undefined;\n      },\n      false\n    );\n\n    return F;\n  }\n\n  return func;\n}\n"],"file":"Proxy.js"}