{"version":3,"sources":["../../../src/intrinsics/dom/global.js"],"names":["realm","global","$GlobalObject","isCompatibleWith","MOBILE_JSC_VERSION","$DefineOwnProperty","PropertyDescriptor","value","writable","enumerable","configurable","NativeFunctionValue","context","args","callback","throwIfNotConcrete","FunctionValue","createErrorThrowCompletion","intrinsics","TypeError","useAbstractInterpretation","FatalError","generator","undefined","emitCallAndCaptureResult","TypesDomain","topVal","ValuesDomain","emitCall"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow strict-local */\n\nimport type { Realm } from \"../../realm.js\";\n\nimport { FunctionValue, NativeFunctionValue } from \"../../values/index.js\";\nimport initializeDocument from \"./document.js\";\nimport initializeConsole from \"../common/console.js\";\nimport { FatalError } from \"../../errors.js\";\nimport invariant from \"../../invariant.js\";\nimport { TypesDomain, ValuesDomain } from \"../../domains/index.js\";\nimport { PropertyDescriptor } from \"../../descriptors.js\";\n\nexport default function(realm: Realm): void {\n  let global = realm.$GlobalObject;\n\n  if (!realm.isCompatibleWith(realm.MOBILE_JSC_VERSION) && !realm.isCompatibleWith(\"mobile\"))\n    global.$DefineOwnProperty(\n      \"console\",\n      new PropertyDescriptor({\n        value: initializeConsole(realm),\n        writable: true,\n        enumerable: false,\n        configurable: true,\n      })\n    );\n\n  global.$DefineOwnProperty(\n    \"self\",\n    new PropertyDescriptor({\n      value: global,\n      writable: true,\n      enumerable: true,\n      configurable: true,\n    })\n  );\n\n  global.$DefineOwnProperty(\n    \"window\",\n    new PropertyDescriptor({\n      value: global,\n      writable: true,\n      enumerable: true,\n      configurable: true,\n    })\n  );\n\n  global.$DefineOwnProperty(\n    \"document\",\n    new PropertyDescriptor({\n      value: initializeDocument(realm),\n      writable: true,\n      enumerable: false,\n      configurable: true,\n    })\n  );\n\n  global.$DefineOwnProperty(\n    \"setTimeout\",\n    new PropertyDescriptor({\n      value: new NativeFunctionValue(realm, \"global.setTimeout\", \"\", 2, (context, args) => {\n        let callback = args[0].throwIfNotConcrete();\n        if (!(callback instanceof FunctionValue))\n          throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"callback arguments must be function\");\n        if (!realm.useAbstractInterpretation) throw new FatalError(\"TODO #1003: implement global.setTimeout\");\n        invariant(realm.generator !== undefined);\n        let generator = realm.generator;\n        return generator.emitCallAndCaptureResult(TypesDomain.topVal, ValuesDomain.topVal, \"global.setTimeout\", args);\n      }),\n      writable: true,\n      enumerable: true,\n      configurable: true,\n    })\n  );\n\n  global.$DefineOwnProperty(\n    \"clearTimeout\",\n    new PropertyDescriptor({\n      value: new NativeFunctionValue(realm, \"global.clearTimeout\", \"\", 2, (context, args) => {\n        if (!realm.useAbstractInterpretation) throw new FatalError(\"TODO #1003: implement global.clearTimeout\");\n        invariant(realm.generator !== undefined);\n        let generator = realm.generator;\n        generator.emitCall(\"global.clearTimeout\", args);\n        return realm.intrinsics.undefined;\n      }),\n      writable: true,\n      enumerable: true,\n      configurable: true,\n    })\n  );\n\n  global.$DefineOwnProperty(\n    \"setInterval\",\n    new PropertyDescriptor({\n      value: new NativeFunctionValue(realm, \"global.setInterval\", \"\", 2, (context, args) => {\n        if (!realm.useAbstractInterpretation) throw new FatalError(\"TODO #1003: implement global.setInterval\");\n        let callback = args[0].throwIfNotConcrete();\n        if (!(callback instanceof FunctionValue))\n          throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"callback arguments must be function\");\n        invariant(realm.generator !== undefined);\n        let generator = realm.generator;\n        return generator.emitCallAndCaptureResult(TypesDomain.topVal, ValuesDomain.topVal, \"global.setInterval\", args);\n      }),\n      writable: true,\n      enumerable: true,\n      configurable: true,\n    })\n  );\n\n  global.$DefineOwnProperty(\n    \"clearInterval\",\n    new PropertyDescriptor({\n      value: new NativeFunctionValue(realm, \"global.clearInterval\", \"\", 2, (context, args) => {\n        if (!realm.useAbstractInterpretation) throw new FatalError(\"TODO #1003: implement global.clearInterval\");\n        invariant(realm.generator !== undefined);\n        let generator = realm.generator;\n        generator.emitCall(\"global.clearInterval\", args);\n        return realm.intrinsics.undefined;\n      }),\n      writable: true,\n      enumerable: true,\n      configurable: true,\n    })\n  );\n}\n"],"file":"global.js"}