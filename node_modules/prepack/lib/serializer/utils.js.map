{"version":3,"sources":["../../src/serializer/utils.js"],"names":["getSuggestedArrayLiteralLength","realm","val","instantRenderMode","instantRender","enabled","minLength","maxLength","actualLength","key","properties","keys","Number","prevMax","elem","_SafeGetDataPropertyValue","mightHaveBeenDeleted","AbstractValue","kind","maxLengthVal","IntegralValue","c","x","y","args","EmptyValue","prevActual","undefined","createFromConditionalOp","lengthVal","equals","commonAncestorOf","node1","node2","getParent","n1","n2","count1","count2","p1","p2","getOrDefault","map","defaultFn","value","get","set","withDescriptorValue","propertyNameOrSymbol","descriptor","func","PropertyDescriptor","ClassPropertiesToIgnore","Set","canIgnoreClassLengthProperty","desc","logger","logError","getObjectPrototypeMetadata","obj","proto","$Prototype","skipPrototype","constructor","$IsClassPrototype","ObjectValue","_constructor","FatalError","classFunc","ECMAScriptSourceFunctionValue","createAdditionalEffects","effects","fatalOnAbrupt","name","additionalFunctionEffects","preEvaluationComponentToWriteEffectFunction","optimizedFunction","parentOptimizedFunction","transforms","generator","Generator","fromEffects","retValue","parentAdditionalFunction","additionalRoots","handleReportedSideEffect","exceptionHandler","sideEffectType","binding","expressionLocation","object","intrinsicName","location","pb","refuseSerializationOnPropertyBinding"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport {\n  AbstractValue,\n  ECMAScriptSourceFunctionValue,\n  EmptyValue,\n  FunctionValue,\n  IntegralValue,\n  ObjectValue,\n  SymbolValue,\n} from \"../values/index.js\";\nimport type { Effects, Realm, SideEffectType } from \"../realm.js\";\n\nimport { FatalError } from \"../errors.js\";\nimport type { PropertyBinding, Descriptor } from \"../types.js\";\nimport invariant from \"../invariant.js\";\nimport { IsArray, IsArrayIndex } from \"../methods/index.js\";\nimport { Logger } from \"../utils/logger.js\";\nimport { Generator } from \"../utils/generator.js\";\nimport type { AdditionalFunctionEffects, AdditionalFunctionTransform } from \"./types\";\nimport type { Binding } from \"../environment.js\";\nimport type { BabelNodeSourceLocation } from \"@babel/types\";\nimport { optionalStringOfLocation } from \"../utils/babelhelpers.js\";\nimport { PropertyDescriptor } from \"../descriptors.js\";\n\n/**\n * Get index property list length by searching array properties list for the max index key value plus 1.\n * If tail elements are conditional, return the minimum length if an assignment to the length property\n * can be avoided because of that. The boolean part of the result is a flag that indicates if the latter is true.\n */\nexport function getSuggestedArrayLiteralLength(realm: Realm, val: ObjectValue): [number, boolean] {\n  invariant(IsArray(realm, val));\n  let instantRenderMode = realm.instantRender.enabled;\n  let minLength = 0,\n    maxLength = 0;\n  let actualLength;\n  for (const key of val.properties.keys()) {\n    if (IsArrayIndex(realm, key) && Number(key) >= maxLength) {\n      let prevMax = maxLength;\n      maxLength = Number(key) + 1;\n      let elem = val._SafeGetDataPropertyValue(key);\n      if (instantRenderMode || !elem.mightHaveBeenDeleted()) minLength = maxLength;\n      else if (elem instanceof AbstractValue && elem.kind === \"conditional\") {\n        let maxLengthVal = new IntegralValue(realm, maxLength);\n        let [c, x, y] = elem.args;\n        if (x instanceof EmptyValue && !y.mightHaveBeenDeleted()) {\n          let prevActual = actualLength === undefined ? new IntegralValue(realm, prevMax) : actualLength;\n          actualLength = AbstractValue.createFromConditionalOp(realm, c, prevActual, maxLengthVal);\n        } else if (y instanceof EmptyValue && !x.mightHaveBeenDeleted()) {\n          let prevActual = actualLength === undefined ? new IntegralValue(realm, prevMax) : actualLength;\n          actualLength = AbstractValue.createFromConditionalOp(realm, c, maxLengthVal, prevActual);\n        } else {\n          actualLength = undefined;\n        }\n      }\n    }\n  }\n  if (maxLength > minLength && actualLength instanceof AbstractValue) {\n    let lengthVal = val._SafeGetDataPropertyValue(\"length\");\n    if (lengthVal.equals(actualLength)) return [minLength, true];\n  }\n  return [maxLength, false];\n}\n\nexport function commonAncestorOf<T>(node1: void | T, node2: void | T, getParent: T => void | T): void | T {\n  if (node1 === node2) return node1;\n  // First get the path length to the root node for both nodes while also checking if\n  // either node is the parent of the other.\n  let n1 = node1,\n    n2 = node2,\n    count1 = 0,\n    count2 = 0;\n  while (true) {\n    let p1 = n1 && getParent(n1);\n    let p2 = n2 && getParent(n2);\n    if (p1 === node2) return node2;\n    if (p2 === node1) return node1;\n    if (p1 !== undefined) count1++;\n    if (p2 !== undefined) count2++;\n    if (p1 === undefined && p2 === undefined) break;\n    n1 = p1;\n    n2 = p2;\n  }\n  // Now shorten the longest path to the same length as the shorter path\n  n1 = node1;\n  while (count1 > count2) {\n    invariant(n1 !== undefined);\n    n1 = getParent(n1);\n    count1--;\n  }\n  n2 = node2;\n  while (count1 < count2) {\n    invariant(n2 !== undefined);\n    n2 = getParent(n2);\n    count2--;\n  }\n  // Now run up both paths in tandem, stopping at the first common entry\n  while (n1 !== n2) {\n    invariant(n1 !== undefined);\n    n1 = getParent(n1);\n    invariant(n2 !== undefined);\n    n2 = getParent(n2);\n  }\n  return n1;\n}\n\n// Gets map[key] with default value provided by defaultFn\nexport function getOrDefault<K, V>(map: Map<K, V>, key: K, defaultFn: () => V): V {\n  let value = map.get(key);\n  if (value === undefined) map.set(key, (value = defaultFn()));\n  invariant(value !== undefined);\n  return value;\n}\n\nexport function withDescriptorValue(\n  propertyNameOrSymbol: string | SymbolValue,\n  descriptor: void | Descriptor,\n  func: Function\n): void {\n  if (descriptor !== undefined) {\n    invariant(descriptor instanceof PropertyDescriptor); // TODO: Handle joined descriptors.\n    if (descriptor.value !== undefined) {\n      func(propertyNameOrSymbol, descriptor.value, \"value\");\n    } else {\n      if (descriptor.get !== undefined) {\n        func(propertyNameOrSymbol, descriptor.get, \"get\");\n      }\n      if (descriptor.set !== undefined) {\n        func(propertyNameOrSymbol, descriptor.set, \"set\");\n      }\n    }\n  }\n}\n\nexport const ClassPropertiesToIgnore: Set<string> = new Set([\"arguments\", \"name\", \"caller\"]);\n\nexport function canIgnoreClassLengthProperty(val: ObjectValue, desc: void | Descriptor, logger: Logger): boolean {\n  if (desc) {\n    if (desc instanceof PropertyDescriptor) {\n      if (desc.value === undefined) {\n        logger.logError(val, \"Functions with length accessor properties are not supported in residual heap.\");\n      }\n    } else {\n      logger.logError(\n        val,\n        \"Functions with length properties with different attributes are not supported in residual heap.\"\n      );\n    }\n  }\n  return true;\n}\n\nexport function getObjectPrototypeMetadata(\n  realm: Realm,\n  obj: ObjectValue\n): { skipPrototype: boolean, constructor: void | ECMAScriptSourceFunctionValue } {\n  let proto = obj.$Prototype;\n  let skipPrototype = false;\n  let constructor;\n\n  if (obj.$IsClassPrototype) {\n    skipPrototype = true;\n  }\n  if (proto && proto.$IsClassPrototype) {\n    invariant(proto instanceof ObjectValue);\n    // we now need to check if the prototpe has a constructor\n    let _constructor = proto.properties.get(\"constructor\");\n    if (_constructor !== undefined) {\n      // if the contructor has been deleted then we have no way\n      // to serialize the original class AST as it won't have been\n      // evluated and thus visited\n      if (_constructor.descriptor === undefined) {\n        throw new FatalError(\"TODO #1024: implement object prototype serialization with deleted constructor\");\n      }\n      if (!(_constructor.descriptor instanceof PropertyDescriptor)) {\n        throw new FatalError(\n          \"TODO #1024: implement object prototype serialization with multiple constructor attributes\"\n        );\n      }\n      let classFunc = _constructor.descriptor.value;\n      if (classFunc instanceof ECMAScriptSourceFunctionValue) {\n        constructor = classFunc;\n        skipPrototype = true;\n      }\n    }\n  }\n\n  return {\n    skipPrototype,\n    constructor,\n  };\n}\n\nexport function createAdditionalEffects(\n  realm: Realm,\n  effects: Effects,\n  fatalOnAbrupt: boolean,\n  name: string,\n  additionalFunctionEffects: Map<FunctionValue, AdditionalFunctionEffects>,\n  preEvaluationComponentToWriteEffectFunction: Map<FunctionValue, FunctionValue>,\n  optimizedFunction: FunctionValue,\n  parentOptimizedFunction: FunctionValue | void,\n  transforms: Array<AdditionalFunctionTransform> = []\n): AdditionalFunctionEffects | null {\n  let generator = Generator.fromEffects(\n    effects,\n    realm,\n    name,\n    additionalFunctionEffects,\n    preEvaluationComponentToWriteEffectFunction,\n    optimizedFunction\n  );\n  let retValue: AdditionalFunctionEffects = {\n    parentAdditionalFunction: parentOptimizedFunction || undefined,\n    effects,\n    transforms,\n    generator,\n    additionalRoots: new Set(),\n  };\n  return retValue;\n}\n\nexport function handleReportedSideEffect(\n  exceptionHandler: (string, ?BabelNodeSourceLocation) => void,\n  sideEffectType: SideEffectType,\n  binding: void | Binding | PropertyBinding,\n  expressionLocation: ?BabelNodeSourceLocation\n): void {\n  // This causes an infinite recursion because creating a callstack causes internal-only side effects\n  if (binding && binding.object && binding.object.intrinsicName === \"__checkedBindings\") return;\n  let location = optionalStringOfLocation(expressionLocation);\n\n  if (sideEffectType === \"MODIFIED_BINDING\") {\n    let name = binding ? `\"${((binding: any): Binding).name}\"` : \"unknown\";\n    exceptionHandler(`side-effects from mutating the binding ${name}${location}`, expressionLocation);\n  } else if (sideEffectType === \"MODIFIED_PROPERTY\" || sideEffectType === \"MODIFIED_GLOBAL\") {\n    let name = \"\";\n    let pb = ((binding: any): PropertyBinding);\n    let key = pb.key;\n    if (typeof key === \"string\") {\n      name = `\"${key}\"`;\n    }\n    if (sideEffectType === \"MODIFIED_PROPERTY\") {\n      if (!ObjectValue.refuseSerializationOnPropertyBinding(pb))\n        exceptionHandler(`side-effects from mutating a property ${name}${location}`, expressionLocation);\n    } else {\n      exceptionHandler(`side-effects from mutating the global object property ${name}${location}`, expressionLocation);\n    }\n  } else if (sideEffectType === \"EXCEPTION_THROWN\") {\n    exceptionHandler(`side-effects from throwing exception${location}`, expressionLocation);\n  }\n}\n"],"file":"utils.js"}