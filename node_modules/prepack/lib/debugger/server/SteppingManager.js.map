{"version":3,"sources":["../../../src/debugger/server/SteppingManager.js"],"names":["SteppingManager","constructor","realm","keepOldSteppers","_realm","_steppers","_keepOldSteppers","processStepCommand","kind","currentNodeLocation","_processStepIn","_processStepOver","_processStepOut","loc","source","push","StepIntoStepper","start","line","column","contextStack","length","StepOverStepper","StepOutStepper","getAndDeleteCompletedSteppers","ast","i","completedSteppers","stepper","isComplete","splice"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow strict-local */\n\nimport { BabelNodeSourceLocation } from \"@babel/types\";\nimport invariant from \"./../common/invariant.js\";\nimport { Stepper, StepIntoStepper, StepOverStepper, StepOutStepper } from \"./Stepper.js\";\nimport type { Realm } from \"./../../realm.js\";\nimport type { StoppableObject } from \"./StopEventManager.js\";\n\nexport class SteppingManager {\n  constructor(realm: Realm, keepOldSteppers?: boolean) {\n    this._realm = realm;\n    this._steppers = [];\n    this._keepOldSteppers = false;\n    if (keepOldSteppers === true) this._keepOldSteppers = true;\n  }\n  _realm: Realm;\n  _keepOldSteppers: boolean;\n  _steppers: Array<Stepper>;\n\n  processStepCommand(kind: \"in\" | \"over\" | \"out\", currentNodeLocation: BabelNodeSourceLocation): void {\n    if (kind === \"in\") {\n      this._processStepIn(currentNodeLocation);\n    } else if (kind === \"over\") {\n      this._processStepOver(currentNodeLocation);\n    } else if (kind === \"out\") {\n      this._processStepOut(currentNodeLocation);\n    } else {\n      invariant(false, `Invalid step type: ${kind}`);\n    }\n  }\n\n  _processStepIn(loc: BabelNodeSourceLocation): void {\n    invariant(loc && loc.source !== null);\n    if (!this._keepOldSteppers) {\n      this._steppers = [];\n    }\n    this._steppers.push(\n      new StepIntoStepper(loc.source, loc.start.line, loc.start.column, this._realm.contextStack.length)\n    );\n  }\n\n  _processStepOver(loc: BabelNodeSourceLocation): void {\n    invariant(loc && loc.source !== null);\n    if (!this._keepOldSteppers) {\n      this._steppers = [];\n    }\n    this._steppers.push(\n      new StepOverStepper(loc.source, loc.start.line, loc.start.column, this._realm.contextStack.length)\n    );\n  }\n\n  _processStepOut(loc: BabelNodeSourceLocation): void {\n    invariant(loc && loc.source !== null);\n    if (!this._keepOldSteppers) {\n      this._steppers = [];\n    }\n    this._steppers.push(\n      new StepOutStepper(loc.source, loc.start.line, loc.start.column, this._realm.contextStack.length)\n    );\n  }\n\n  getAndDeleteCompletedSteppers(ast: BabelNode): Array<StoppableObject> {\n    invariant(ast.loc && ast.loc.source);\n    let i = 0;\n    let completedSteppers: Array<StoppableObject> = [];\n    while (i < this._steppers.length) {\n      let stepper = this._steppers[i];\n      if (stepper.isComplete(ast, this._realm.contextStack.length)) {\n        completedSteppers.push(stepper);\n        this._steppers.splice(i, 1);\n      } else {\n        i++;\n      }\n    }\n    return completedSteppers;\n  }\n}\n"],"file":"SteppingManager.js"}