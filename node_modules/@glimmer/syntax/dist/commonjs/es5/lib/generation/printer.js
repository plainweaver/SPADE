'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _tokenizerEventHandlers = require('../parser/tokenizer-event-handlers');

var _util = require('./util');

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

var NON_WHITESPACE = /\S/;

var Printer = function () {
    function Printer(options) {
        _classCallCheck(this, Printer);

        this.buffer = '';
        this.options = options;
    }
    /*
      This is used by _all_ methods on this Printer class that add to `this.buffer`,
      it allows consumers of the printer to use alternate string representations for
      a given node.
         The primary use case for this are things like source -> source codemod utilities.
      For example, ember-template-recast attempts to always preserve the original string
      formatting in each AST node if no modifications are made to it.
    */

    Printer.prototype.handledByOverride = function handledByOverride(node) {
        var ensureLeadingWhitespace = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

        if (this.options.override !== undefined) {
            var result = this.options.override(node, this.options);
            if (typeof result === 'string') {
                if (ensureLeadingWhitespace && NON_WHITESPACE.test(result[0])) {
                    result = ' ' + result;
                }
                this.buffer += result;
                return true;
            }
        }
        return false;
    };

    Printer.prototype.Node = function Node(node) {
        switch (node.type) {
            case 'MustacheStatement':
            case 'BlockStatement':
            case 'PartialStatement':
            case 'MustacheCommentStatement':
            case 'CommentStatement':
            case 'TextNode':
            case 'ElementNode':
            case 'AttrNode':
            case 'Block':
            case 'Template':
                return this.TopLevelStatement(node);
            case 'StringLiteral':
            case 'BooleanLiteral':
            case 'NumberLiteral':
            case 'UndefinedLiteral':
            case 'NullLiteral':
            case 'PathExpression':
            case 'SubExpression':
                return this.Expression(node);
            case 'Program':
                return this.Block(node);
            case 'ConcatStatement':
                // should have an AttrNode parent
                return this.ConcatStatement(node);
            case 'Hash':
                return this.Hash(node);
            case 'HashPair':
                return this.HashPair(node);
            case 'ElementModifierStatement':
                return this.ElementModifierStatement(node);
        }
        return unreachable(node);
    };

    Printer.prototype.Expression = function Expression(expression) {
        switch (expression.type) {
            case 'StringLiteral':
            case 'BooleanLiteral':
            case 'NumberLiteral':
            case 'UndefinedLiteral':
            case 'NullLiteral':
                return this.Literal(expression);
            case 'PathExpression':
                return this.PathExpression(expression);
            case 'SubExpression':
                return this.SubExpression(expression);
        }
        return unreachable(expression);
    };

    Printer.prototype.Literal = function Literal(literal) {
        switch (literal.type) {
            case 'StringLiteral':
                return this.StringLiteral(literal);
            case 'BooleanLiteral':
                return this.BooleanLiteral(literal);
            case 'NumberLiteral':
                return this.NumberLiteral(literal);
            case 'UndefinedLiteral':
                return this.UndefinedLiteral(literal);
            case 'NullLiteral':
                return this.NullLiteral(literal);
        }
        return unreachable(literal);
    };

    Printer.prototype.TopLevelStatement = function TopLevelStatement(statement) {
        switch (statement.type) {
            case 'MustacheStatement':
                return this.MustacheStatement(statement);
            case 'BlockStatement':
                return this.BlockStatement(statement);
            case 'PartialStatement':
                return this.PartialStatement(statement);
            case 'MustacheCommentStatement':
                return this.MustacheCommentStatement(statement);
            case 'CommentStatement':
                return this.CommentStatement(statement);
            case 'TextNode':
                return this.TextNode(statement);
            case 'ElementNode':
                return this.ElementNode(statement);
            case 'Block':
            case 'Template':
                return this.Block(statement);
            case 'AttrNode':
                // should have element
                return this.AttrNode(statement);
        }
        unreachable(statement);
    };

    Printer.prototype.Block = function Block(block) {
        /*
          When processing a template like:
               ```hbs
          {{#if whatever}}
            whatever
          {{else if somethingElse}}
            something else
          {{else}}
            fallback
          {{/if}}
          ```
               The AST still _effectively_ looks like:
               ```hbs
          {{#if whatever}}
            whatever
          {{else}}{{#if somethingElse}}
            something else
          {{else}}
            fallback
          {{/if}}{{/if}}
          ```
               The only way we can tell if that is the case is by checking for
          `block.chained`, but unfortunately when the actual statements are
          processed the `block.body[0]` node (which will always be a
          `BlockStatement`) has no clue that its anscestor `Block` node was
          chained.
               This "forwards" the `chained` setting so that we can check
          it later when processing the `BlockStatement`.
        */
        if (block.chained) {
            var firstChild = block.body[0];
            firstChild.chained = true;
        }
        if (this.handledByOverride(block)) {
            return;
        }
        this.TopLevelStatements(block.body);
    };

    Printer.prototype.TopLevelStatements = function TopLevelStatements(statements) {
        var _this = this;

        statements.forEach(function (statement) {
            return _this.TopLevelStatement(statement);
        });
    };

    Printer.prototype.ElementNode = function ElementNode(el) {
        if (this.handledByOverride(el)) {
            return;
        }
        this.OpenElementNode(el);
        this.TopLevelStatements(el.children);
        this.CloseElementNode(el);
    };

    Printer.prototype.OpenElementNode = function OpenElementNode(el) {
        var _this2 = this;

        this.buffer += '<' + el.tag;
        if (el.attributes.length) {
            el.attributes.forEach(function (attr) {
                _this2.buffer += ' ';
                _this2.AttrNode(attr);
            });
        }
        if (el.modifiers.length) {
            el.modifiers.forEach(function (mod) {
                _this2.buffer += ' ';
                _this2.ElementModifierStatement(mod);
            });
        }
        if (el.comments.length) {
            el.comments.forEach(function (comment) {
                _this2.buffer += ' ';
                _this2.MustacheCommentStatement(comment);
            });
        }
        if (el.blockParams.length) {
            this.BlockParams(el.blockParams);
        }
        if (el.selfClosing) {
            this.buffer += ' /';
        }
        this.buffer += '>';
    };

    Printer.prototype.CloseElementNode = function CloseElementNode(el) {
        if (el.selfClosing || _tokenizerEventHandlers.voidMap[el.tag.toLowerCase()]) {
            return;
        }
        this.buffer += '</' + el.tag + '>';
    };

    Printer.prototype.AttrNode = function AttrNode(attr) {
        if (this.handledByOverride(attr)) {
            return;
        }
        var name = attr.name,
            value = attr.value;

        this.buffer += name;
        if (value.type !== 'TextNode' || value.chars.length > 0) {
            this.buffer += '=';
            this.AttrNodeValue(value);
        }
    };

    Printer.prototype.AttrNodeValue = function AttrNodeValue(value) {
        if (value.type === 'TextNode') {
            this.buffer += '"';
            this.TextNode(value, true);
            this.buffer += '"';
        } else {
            this.Node(value);
        }
    };

    Printer.prototype.TextNode = function TextNode(text, isAttr) {
        if (this.handledByOverride(text)) {
            return;
        }
        if (this.options.entityEncoding === 'raw') {
            this.buffer += text.chars;
        } else if (isAttr) {
            this.buffer += (0, _util.escapeAttrValue)(text.chars);
        } else {
            this.buffer += (0, _util.escapeText)(text.chars);
        }
    };

    Printer.prototype.MustacheStatement = function MustacheStatement(mustache) {
        if (this.handledByOverride(mustache)) {
            return;
        }
        this.buffer += mustache.escaped ? '{{' : '{{{';
        if (mustache.strip.open) {
            this.buffer += '~';
        }
        this.Expression(mustache.path);
        this.Params(mustache.params);
        this.Hash(mustache.hash);
        if (mustache.strip.close) {
            this.buffer += '~';
        }
        this.buffer += mustache.escaped ? '}}' : '}}}';
    };

    Printer.prototype.BlockStatement = function BlockStatement(block) {
        if (this.handledByOverride(block)) {
            return;
        }
        if (block.chained) {
            this.buffer += block.inverseStrip.open ? '{{~' : '{{';
            this.buffer += 'else ';
        } else {
            this.buffer += block.openStrip.open ? '{{~#' : '{{#';
        }
        this.Expression(block.path);
        this.Params(block.params);
        this.Hash(block.hash);
        if (block.program.blockParams.length) {
            this.BlockParams(block.program.blockParams);
        }
        if (block.chained) {
            this.buffer += block.inverseStrip.close ? '~}}' : '}}';
        } else {
            this.buffer += block.openStrip.close ? '~}}' : '}}';
        }
        this.Block(block.program);
        if (block.inverse) {
            if (!block.inverse.chained) {
                this.buffer += block.inverseStrip.open ? '{{~' : '{{';
                this.buffer += 'else';
                this.buffer += block.inverseStrip.close ? '~}}' : '}}';
            }
            this.Block(block.inverse);
        }
        if (!block.chained) {
            this.buffer += block.closeStrip.open ? '{{~/' : '{{/';
            this.Expression(block.path);
            this.buffer += block.closeStrip.close ? '~}}' : '}}';
        }
    };

    Printer.prototype.BlockParams = function BlockParams(blockParams) {
        this.buffer += ' as |' + blockParams.join(' ') + '|';
    };

    Printer.prototype.PartialStatement = function PartialStatement(partial) {
        if (this.handledByOverride(partial)) {
            return;
        }
        this.buffer += '{{>';
        this.Expression(partial.name);
        this.Params(partial.params);
        this.Hash(partial.hash);
        this.buffer += '}}';
    };

    Printer.prototype.ConcatStatement = function ConcatStatement(concat) {
        var _this3 = this;

        if (this.handledByOverride(concat)) {
            return;
        }
        this.buffer += '"';
        concat.parts.forEach(function (part) {
            if (part.type === 'TextNode') {
                _this3.TextNode(part, true);
            } else {
                _this3.Node(part);
            }
        });
        this.buffer += '"';
    };

    Printer.prototype.MustacheCommentStatement = function MustacheCommentStatement(comment) {
        if (this.handledByOverride(comment)) {
            return;
        }
        this.buffer += '{{!--' + comment.value + '--}}';
    };

    Printer.prototype.ElementModifierStatement = function ElementModifierStatement(mod) {
        if (this.handledByOverride(mod)) {
            return;
        }
        this.buffer += '{{';
        this.Expression(mod.path);
        this.Params(mod.params);
        this.Hash(mod.hash);
        this.buffer += '}}';
    };

    Printer.prototype.CommentStatement = function CommentStatement(comment) {
        if (this.handledByOverride(comment)) {
            return;
        }
        this.buffer += '<!--' + comment.value + '-->';
    };

    Printer.prototype.PathExpression = function PathExpression(path) {
        if (this.handledByOverride(path)) {
            return;
        }
        this.buffer += path.original;
    };

    Printer.prototype.SubExpression = function SubExpression(sexp) {
        if (this.handledByOverride(sexp)) {
            return;
        }
        this.buffer += '(';
        this.Expression(sexp.path);
        this.Params(sexp.params);
        this.Hash(sexp.hash);
        this.buffer += ')';
    };

    Printer.prototype.Params = function Params(params) {
        var _this4 = this;

        // TODO: implement a top level Params AST node (just like the Hash object)
        // so that this can also be overridden
        if (params.length) {
            params.forEach(function (param) {
                _this4.buffer += ' ';
                _this4.Expression(param);
            });
        }
    };

    Printer.prototype.Hash = function Hash(hash) {
        var _this5 = this;

        if (this.handledByOverride(hash, true)) {
            return;
        }
        hash.pairs.forEach(function (pair) {
            _this5.buffer += ' ';
            _this5.HashPair(pair);
        });
    };

    Printer.prototype.HashPair = function HashPair(pair) {
        if (this.handledByOverride(pair)) {
            return;
        }
        this.buffer += pair.key;
        this.buffer += '=';
        this.Node(pair.value);
    };

    Printer.prototype.StringLiteral = function StringLiteral(str) {
        if (this.handledByOverride(str)) {
            return;
        }
        this.buffer += JSON.stringify(str.value);
    };

    Printer.prototype.BooleanLiteral = function BooleanLiteral(bool) {
        if (this.handledByOverride(bool)) {
            return;
        }
        this.buffer += bool.value;
    };

    Printer.prototype.NumberLiteral = function NumberLiteral(number) {
        if (this.handledByOverride(number)) {
            return;
        }
        this.buffer += number.value;
    };

    Printer.prototype.UndefinedLiteral = function UndefinedLiteral(node) {
        if (this.handledByOverride(node)) {
            return;
        }
        this.buffer += 'undefined';
    };

    Printer.prototype.NullLiteral = function NullLiteral(node) {
        if (this.handledByOverride(node)) {
            return;
        }
        this.buffer += 'null';
    };

    Printer.prototype.print = function print(node) {
        var options = this.options;

        if (options.override) {
            var result = options.override(node, options);
            if (result !== undefined) {
                return result;
            }
        }
        this.buffer = '';
        this.Node(node);
        return this.buffer;
    };

    return Printer;
}();

exports.default = Printer;


function unreachable(node) {
    throw new Error('Non-exhaustive node narrowing ' + node.type);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC9saWIvZ2VuZXJhdGlvbi9wcmludGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQTRCQTs7QUFDQTs7Ozs7Ozs7QUFFQSxJQUFNLGlCQUFOLElBQUE7O0lBc0JjLFU7QUFJWixhQUFBLE9BQUEsQ0FBQSxPQUFBLEVBQW1DO0FBQUEsd0JBQUEsSUFBQSxFQUFBLE9BQUE7O0FBSDNCLGFBQUEsTUFBQSxHQUFBLEVBQUE7QUFJTixhQUFBLE9BQUEsR0FBQSxPQUFBO0FBQ0Q7QUFFRDs7Ozs7Ozs7O3NCQVNBLGlCLDhCQUFBLEksRUFBNkQ7QUFBQSxZQUEvQiwwQkFBK0IsVUFBQSxNQUFBLEdBQUEsQ0FBQSxJQUFBLFVBQUEsQ0FBQSxNQUFBLFNBQUEsR0FBQSxVQUFBLENBQUEsQ0FBQSxHQUE3RCxLQUE2RDs7QUFDM0QsWUFBSSxLQUFBLE9BQUEsQ0FBQSxRQUFBLEtBQUosU0FBQSxFQUF5QztBQUN2QyxnQkFBSSxTQUFTLEtBQUEsT0FBQSxDQUFBLFFBQUEsQ0FBQSxJQUFBLEVBQTRCLEtBQXpDLE9BQWEsQ0FBYjtBQUNBLGdCQUFJLE9BQUEsTUFBQSxLQUFKLFFBQUEsRUFBZ0M7QUFDOUIsb0JBQUksMkJBQTJCLGVBQUEsSUFBQSxDQUFvQixPQUFuRCxDQUFtRCxDQUFwQixDQUEvQixFQUErRDtBQUM3RCw2QkFBQSxNQUFBLE1BQUE7QUFDRDtBQUVELHFCQUFBLE1BQUEsSUFBQSxNQUFBO0FBQ0EsdUJBQUEsSUFBQTtBQUNEO0FBQ0Y7QUFFRCxlQUFBLEtBQUE7OztzQkFHRixJLGlCQUFBLEksRUFBZTtBQUNiLGdCQUFRLEtBQVIsSUFBQTtBQUNFLGlCQUFBLG1CQUFBO0FBQ0EsaUJBQUEsZ0JBQUE7QUFDQSxpQkFBQSxrQkFBQTtBQUNBLGlCQUFBLDBCQUFBO0FBQ0EsaUJBQUEsa0JBQUE7QUFDQSxpQkFBQSxVQUFBO0FBQ0EsaUJBQUEsYUFBQTtBQUNBLGlCQUFB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T0FBYSxDQUFiO0FBRUEsZ0JBQUksV0FBSixTQUFBLEVBQTBCO0FBQ3hCLHVCQUFBLE1BQUE7QUFDRDtBQUNGO0FBRUQsYUFBQSxNQUFBLEdBQUEsRUFBQTtBQUNBLGFBQUEsSUFBQSxDQUFBLElBQUE7QUFDQSxlQUFPLEtBQVAsTUFBQTs7Ozs7O2tCQTllVSxPOzs7QUFrZmQsU0FBQSxXQUFBLENBQUEsSUFBQSxFQUFnQztBQUM5QixVQUFNLElBQUEsS0FBQSxDQUFBLG1DQUE2QyxLQUFuRCxJQUFNLENBQU47QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEF0dHJOb2RlLFxuICBCbG9jayxcbiAgQmxvY2tTdGF0ZW1lbnQsXG4gIEVsZW1lbnROb2RlLFxuICBNdXN0YWNoZVN0YXRlbWVudCxcbiAgTm9kZSxcbiAgUHJvZ3JhbSxcbiAgVGV4dE5vZGUsXG4gIFBhcnRpYWxTdGF0ZW1lbnQsXG4gIENvbmNhdFN0YXRlbWVudCxcbiAgTXVzdGFjaGVDb21tZW50U3RhdGVtZW50LFxuICBDb21tZW50U3RhdGVtZW50LFxuICBFbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnQsXG4gIEV4cHJlc3Npb24sXG4gIFBhdGhFeHByZXNzaW9uLFxuICBTdWJFeHByZXNzaW9uLFxuICBIYXNoLFxuICBIYXNoUGFpcixcbiAgTGl0ZXJhbCxcbiAgU3RyaW5nTGl0ZXJhbCxcbiAgQm9vbGVhbkxpdGVyYWwsXG4gIE51bWJlckxpdGVyYWwsXG4gIFVuZGVmaW5lZExpdGVyYWwsXG4gIE51bGxMaXRlcmFsLFxuICBUb3BMZXZlbFN0YXRlbWVudCxcbiAgVGVtcGxhdGUsXG59IGZyb20gJy4uL3R5cGVzL25vZGVzJztcbmltcG9ydCB7IHZvaWRNYXAgfSBmcm9tICcuLi9wYXJzZXIvdG9rZW5pemVyLWV2ZW50LWhhbmRsZXJzJztcbmltcG9ydCB7IGVzY2FwZVRleHQsIGVzY2FwZUF0dHJWYWx1ZSB9IGZyb20gJy4vdXRpbCc7XG5cbmNvbnN0IE5PTl9XSElURVNQQUNFID0gL1xcUy87XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJpbnRlck9wdGlvbnMge1xuICBlbnRpdHlFbmNvZGluZzogJ3RyYW5zZm9ybWVkJyB8ICdyYXcnO1xuXG4gIC8qKlxuICAgKiBVc2VkIHRvIG92ZXJyaWRlIHRoZSBtZWNoYW5pc20gb2YgcHJpbnRpbmcgYSBnaXZlbiBBU1QuTm9kZS5cbiAgICpcbiAgICogVGhpcyB3aWxsIGdlbmVyYWxseSBvbmx5IGJlIHVzZWZ1bCB0byBzb3VyY2UgLT4gc291cmNlIGNvZGVtb2RzXG4gICAqIHdoZXJlIHlvdSB3b3VsZCBsaWtlIHRvIHNwZWNpYWxpemUvb3ZlcnJpZGUgdGhlIHdheSBhIGdpdmVuIG5vZGUgaXNcbiAgICogcHJpbnRlZCAoZS5nLiB5b3Ugd291bGQgbGlrZSB0byBwcmVzZXJ2ZSBhcyBtdWNoIG9mIHRoZSBvcmlnaW5hbFxuICAgKiBmb3JtYXR0aW5nIGFzIHBvc3NpYmxlKS5cbiAgICpcbiAgICogV2hlbiB0aGUgcHJvdmlkZWQgb3ZlcnJpZGUgcmV0dXJucyB1bmRlZmluZWQsIHRoZSBkZWZhdWx0IGJ1aWx0IGluIHByaW50aW5nXG4gICAqIHdpbGwgYmUgZG9uZSBmb3IgdGhlIEFTVC5Ob2RlLlxuICAgKlxuICAgKiBAcGFyYW0gYXN0IHRoZSBhc3Qgbm9kZSB0byBiZSBwcmludGVkXG4gICAqIEBwYXJhbSBvcHRpb25zIHRoZSBvcHRpb25zIHNwZWNpZmllZCBkdXJpbmcgdGhlIHByaW50KCkgaW52b2NhdGlvblxuICAgKi9cbiAgb3ZlcnJpZGU/KGFzdDogTm9kZSwgb3B0aW9uczogUHJpbnRlck9wdGlvbnMpOiB2b2lkIHwgc3RyaW5nO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQcmludGVyIHtcbiAgcHJpdmF0ZSBidWZmZXIgPSAnJztcbiAgcHJpdmF0ZSBvcHRpb25zOiBQcmludGVyT3B0aW9ucztcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBQcmludGVyT3B0aW9ucykge1xuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gIH1cblxuICAvKlxuICAgIFRoaXMgaXMgdXNlZCBieSBfYWxsXyBtZXRob2RzIG9uIHRoaXMgUHJpbnRlciBjbGFzcyB0aGF0IGFkZCB0byBgdGhpcy5idWZmZXJgLFxuICAgIGl0IGFsbG93cyBjb25zdW1lcnMgb2YgdGhlIHByaW50ZXIgdG8gdXNlIGFsdGVybmF0ZSBzdHJpbmcgcmVwcmVzZW50YXRpb25zIGZvclxuICAgIGEgZ2l2ZW4gbm9kZS5cblxuICAgIFRoZSBwcmltYXJ5IHVzZSBjYXNlIGZvciB0aGlzIGFyZSB0aGluZ3MgbGlrZSBzb3VyY2UgLT4gc291cmNlIGNvZGVtb2QgdXRpbGl0aWVzLlxuICAgIEZvciBleGFtcGxlLCBlbWJlci10ZW1wbGF0ZS1yZWNhc3QgYXR0ZW1wdHMgdG8gYWx3YXlzIHByZXNlcnZlIHRoZSBvcmlnaW5hbCBzdHJpbmdcbiAgICBmb3JtYXR0aW5nIGluIGVhY2ggQVNUIG5vZGUgaWYgbm8gbW9kaWZpY2F0aW9ucyBhcmUgbWFkZSB0byBpdC5cbiAgKi9cbiAgaGFuZGxlZEJ5T3ZlcnJpZGUobm9kZTogTm9kZSwgZW5zdXJlTGVhZGluZ1doaXRlc3BhY2UgPSBmYWxzZSk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLm9wdGlvbnMub3ZlcnJpZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgbGV0IHJlc3VsdCA9IHRoaXMub3B0aW9ucy5vdmVycmlkZShub2RlLCB0aGlzLm9wdGlvbnMpO1xuICAgICAgaWYgKHR5cGVvZiByZXN1bHQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGlmIChlbnN1cmVMZWFkaW5nV2hpdGVzcGFjZSAmJiBOT05fV0hJVEVTUEFDRS50ZXN0KHJlc3VsdFswXSkpIHtcbiAgICAgICAgICByZXN1bHQgPSBgICR7cmVzdWx0fWA7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmJ1ZmZlciArPSByZXN1bHQ7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIE5vZGUobm9kZTogTm9kZSk6IHZvaWQge1xuICAgIHN3aXRjaCAobm9kZS50eXBlKSB7XG4gICAgICBjYXNlICdNdXN0YWNoZVN0YXRlbWVudCc6XG4gICAgICBjYXNlICdCbG9ja1N0YXRlbWVudCc6XG4gICAgICBjYXNlICdQYXJ0aWFsU3RhdGVtZW50JzpcbiAgICAgIGNhc2UgJ011c3RhY2hlQ29tbWVudFN0YXRlbWVudCc6XG4gICAgICBjYXNlICdDb21tZW50U3RhdGVtZW50JzpcbiAgICAgIGNhc2UgJ1RleHROb2RlJzpcbiAgICAgIGNhc2UgJ0VsZW1lbnROb2RlJzpcbiAgICAgIGNhc2UgJ0F0dHJOb2RlJzpcbiAgICAgIGNhc2UgJ0Jsb2NrJzpcbiAgICAgIGNhc2UgJ1RlbXBsYXRlJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuVG9wTGV2ZWxTdGF0ZW1lbnQobm9kZSk7XG4gICAgICBjYXNlICdTdHJpbmdMaXRlcmFsJzpcbiAgICAgIGNhc2UgJ0Jvb2xlYW5MaXRlcmFsJzpcbiAgICAgIGNhc2UgJ051bWJlckxpdGVyYWwnOlxuICAgICAgY2FzZSAnVW5kZWZpbmVkTGl0ZXJhbCc6XG4gICAgICBjYXNlICdOdWxsTGl0ZXJhbCc6XG4gICAgICBjYXNlICdQYXRoRXhwcmVzc2lvbic6XG4gICAgICBjYXNlICdTdWJFeHByZXNzaW9uJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuRXhwcmVzc2lvbihub2RlKTtcbiAgICAgIGNhc2UgJ1Byb2dyYW0nOlxuICAgICAgICByZXR1cm4gdGhpcy5CbG9jayhub2RlKTtcbiAgICAgIGNhc2UgJ0NvbmNhdFN0YXRlbWVudCc6XG4gICAgICAgIC8vIHNob3VsZCBoYXZlIGFuIEF0dHJOb2RlIHBhcmVudFxuICAgICAgICByZXR1cm4gdGhpcy5Db25jYXRTdGF0ZW1lbnQobm9kZSk7XG4gICAgICBjYXNlICdIYXNoJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuSGFzaChub2RlKTtcbiAgICAgIGNhc2UgJ0hhc2hQYWlyJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuSGFzaFBhaXIobm9kZSk7XG4gICAgICBjYXNlICdFbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnQnOlxuICAgICAgICByZXR1cm4gdGhpcy5FbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnQobm9kZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHVucmVhY2hhYmxlKG5vZGUpO1xuICB9XG5cbiAgRXhwcmVzc2lvbihleHByZXNzaW9uOiBFeHByZXNzaW9uKTogdm9pZCB7XG4gICAgc3dpdGNoIChleHByZXNzaW9uLnR5cGUpIHtcbiAgICAgIGNhc2UgJ1N0cmluZ0xpdGVyYWwnOlxuICAgICAgY2FzZSAnQm9vbGVhbkxpdGVyYWwnOlxuICAgICAgY2FzZSAnTnVtYmVyTGl0ZXJhbCc6XG4gICAgICBjYXNlICdVbmRlZmluZWRMaXRlcmFsJzpcbiAgICAgIGNhc2UgJ051bGxMaXRlcmFsJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuTGl0ZXJhbChleHByZXNzaW9uKTtcbiAgICAgIGNhc2UgJ1BhdGhFeHByZXNzaW9uJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuUGF0aEV4cHJlc3Npb24oZXhwcmVzc2lvbik7XG4gICAgICBjYXNlICdTdWJFeHByZXNzaW9uJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuU3ViRXhwcmVzc2lvbihleHByZXNzaW9uKTtcbiAgICB9XG4gICAgcmV0dXJuIHVucmVhY2hhYmxlKGV4cHJlc3Npb24pO1xuICB9XG5cbiAgTGl0ZXJhbChsaXRlcmFsOiBMaXRlcmFsKSB7XG4gICAgc3dpdGNoIChsaXRlcmFsLnR5cGUpIHtcbiAgICAgIGNhc2UgJ1N0cmluZ0xpdGVyYWwnOlxuICAgICAgICByZXR1cm4gdGhpcy5TdHJpbmdMaXRlcmFsKGxpdGVyYWwpO1xuICAgICAgY2FzZSAnQm9vbGVhbkxpdGVyYWwnOlxuICAgICAgICByZXR1cm4gdGhpcy5Cb29sZWFuTGl0ZXJhbChsaXRlcmFsKTtcbiAgICAgIGNhc2UgJ051bWJlckxpdGVyYWwnOlxuICAgICAgICByZXR1cm4gdGhpcy5OdW1iZXJMaXRlcmFsKGxpdGVyYWwpO1xuICAgICAgY2FzZSAnVW5kZWZpbmVkTGl0ZXJhbCc6XG4gICAgICAgIHJldHVybiB0aGlzLlVuZGVmaW5lZExpdGVyYWwobGl0ZXJhbCk7XG4gICAgICBjYXNlICdOdWxsTGl0ZXJhbCc6XG4gICAgICAgIHJldHVybiB0aGlzLk51bGxMaXRlcmFsKGxpdGVyYWwpO1xuICAgIH1cbiAgICByZXR1cm4gdW5yZWFjaGFibGUobGl0ZXJhbCk7XG4gIH1cblxuICBUb3BMZXZlbFN0YXRlbWVudChzdGF0ZW1lbnQ6IFRvcExldmVsU3RhdGVtZW50KSB7XG4gICAgc3dpdGNoIChzdGF0ZW1lbnQudHlwZSkge1xuICAgICAgY2FzZSAnTXVzdGFjaGVTdGF0ZW1lbnQnOlxuICAgICAgICByZXR1cm4gdGhpcy5NdXN0YWNoZVN0YXRlbWVudChzdGF0ZW1lbnQpO1xuICAgICAgY2FzZSAnQmxvY2tTdGF0ZW1lbnQnOlxuICAgICAgICByZXR1cm4gdGhpcy5CbG9ja1N0YXRlbWVudChzdGF0ZW1lbnQpO1xuICAgICAgY2FzZSAnUGFydGlhbFN0YXRlbWVudCc6XG4gICAgICAgIHJldHVybiB0aGlzLlBhcnRpYWxTdGF0ZW1lbnQoc3RhdGVtZW50KTtcbiAgICAgIGNhc2UgJ011c3RhY2hlQ29tbWVudFN0YXRlbWVudCc6XG4gICAgICAgIHJldHVybiB0aGlzLk11c3RhY2hlQ29tbWVudFN0YXRlbWVudChzdGF0ZW1lbnQpO1xuICAgICAgY2FzZSAnQ29tbWVudFN0YXRlbWVudCc6XG4gICAgICAgIHJldHVybiB0aGlzLkNvbW1lbnRTdGF0ZW1lbnQoc3RhdGVtZW50KTtcbiAgICAgIGNhc2UgJ1RleHROb2RlJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuVGV4dE5vZGUoc3RhdGVtZW50KTtcbiAgICAgIGNhc2UgJ0VsZW1lbnROb2RlJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuRWxlbWVudE5vZGUoc3RhdGVtZW50KTtcbiAgICAgIGNhc2UgJ0Jsb2NrJzpcbiAgICAgIGNhc2UgJ1RlbXBsYXRlJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuQmxvY2soc3RhdGVtZW50KTtcbiAgICAgIGNhc2UgJ0F0dHJOb2RlJzpcbiAgICAgICAgLy8gc2hvdWxkIGhhdmUgZWxlbWVudFxuICAgICAgICByZXR1cm4gdGhpcy5BdHRyTm9kZShzdGF0ZW1lbnQpO1xuICAgIH1cbiAgICB1bnJlYWNoYWJsZShzdGF0ZW1lbnQpO1xuICB9XG5cbiAgQmxvY2soYmxvY2s6IEJsb2NrIHwgUHJvZ3JhbSB8IFRlbXBsYXRlKTogdm9pZCB7XG4gICAgLypcbiAgICAgIFdoZW4gcHJvY2Vzc2luZyBhIHRlbXBsYXRlIGxpa2U6XG5cbiAgICAgIGBgYGhic1xuICAgICAge3sjaWYgd2hhdGV2ZXJ9fVxuICAgICAgICB3aGF0ZXZlclxuICAgICAge3tlbHNlIGlmIHNvbWV0aGluZ0Vsc2V9fVxuICAgICAgICBzb21ldGhpbmcgZWxzZVxuICAgICAge3tlbHNlfX1cbiAgICAgICAgZmFsbGJhY2tcbiAgICAgIHt7L2lmfX1cbiAgICAgIGBgYFxuXG4gICAgICBUaGUgQVNUIHN0aWxsIF9lZmZlY3RpdmVseV8gbG9va3MgbGlrZTpcblxuICAgICAgYGBgaGJzXG4gICAgICB7eyNpZiB3aGF0ZXZlcn19XG4gICAgICAgIHdoYXRldmVyXG4gICAgICB7e2Vsc2V9fXt7I2lmIHNvbWV0aGluZ0Vsc2V9fVxuICAgICAgICBzb21ldGhpbmcgZWxzZVxuICAgICAge3tlbHNlfX1cbiAgICAgICAgZmFsbGJhY2tcbiAgICAgIHt7L2lmfX17ey9pZn19XG4gICAgICBgYGBcblxuICAgICAgVGhlIG9ubHkgd2F5IHdlIGNhbiB0ZWxsIGlmIHRoYXQgaXMgdGhlIGNhc2UgaXMgYnkgY2hlY2tpbmcgZm9yXG4gICAgICBgYmxvY2suY2hhaW5lZGAsIGJ1dCB1bmZvcnR1bmF0ZWx5IHdoZW4gdGhlIGFjdHVhbCBzdGF0ZW1lbnRzIGFyZVxuICAgICAgcHJvY2Vzc2VkIHRoZSBgYmxvY2suYm9keVswXWAgbm9kZSAod2hpY2ggd2lsbCBhbHdheXMgYmUgYVxuICAgICAgYEJsb2NrU3RhdGVtZW50YCkgaGFzIG5vIGNsdWUgdGhhdCBpdHMgYW5zY2VzdG9yIGBCbG9ja2Agbm9kZSB3YXNcbiAgICAgIGNoYWluZWQuXG5cbiAgICAgIFRoaXMgXCJmb3J3YXJkc1wiIHRoZSBgY2hhaW5lZGAgc2V0dGluZyBzbyB0aGF0IHdlIGNhbiBjaGVja1xuICAgICAgaXQgbGF0ZXIgd2hlbiBwcm9jZXNzaW5nIHRoZSBgQmxvY2tTdGF0ZW1lbnRgLlxuICAgICovXG4gICAgaWYgKGJsb2NrLmNoYWluZWQpIHtcbiAgICAgIGxldCBmaXJzdENoaWxkID0gYmxvY2suYm9keVswXSBhcyBCbG9ja1N0YXRlbWVudDtcbiAgICAgIGZpcnN0Q2hpbGQuY2hhaW5lZCA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUoYmxvY2spKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5Ub3BMZXZlbFN0YXRlbWVudHMoYmxvY2suYm9keSk7XG4gIH1cblxuICBUb3BMZXZlbFN0YXRlbWVudHMoc3RhdGVtZW50czogVG9wTGV2ZWxTdGF0ZW1lbnRbXSkge1xuICAgIHN0YXRlbWVudHMuZm9yRWFjaChzdGF0ZW1lbnQgPT4gdGhpcy5Ub3BMZXZlbFN0YXRlbWVudChzdGF0ZW1lbnQpKTtcbiAgfVxuXG4gIEVsZW1lbnROb2RlKGVsOiBFbGVtZW50Tm9kZSk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKGVsKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuT3BlbkVsZW1lbnROb2RlKGVsKTtcbiAgICB0aGlzLlRvcExldmVsU3RhdGVtZW50cyhlbC5jaGlsZHJlbik7XG4gICAgdGhpcy5DbG9zZUVsZW1lbnROb2RlKGVsKTtcbiAgfVxuXG4gIE9wZW5FbGVtZW50Tm9kZShlbDogRWxlbWVudE5vZGUpOiB2b2lkIHtcbiAgICB0aGlzLmJ1ZmZlciArPSBgPCR7ZWwudGFnfWA7XG4gICAgaWYgKGVsLmF0dHJpYnV0ZXMubGVuZ3RoKSB7XG4gICAgICBlbC5hdHRyaWJ1dGVzLmZvckVhY2goYXR0ciA9PiB7XG4gICAgICAgIHRoaXMuYnVmZmVyICs9ICcgJztcbiAgICAgICAgdGhpcy5BdHRyTm9kZShhdHRyKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoZWwubW9kaWZpZXJzLmxlbmd0aCkge1xuICAgICAgZWwubW9kaWZpZXJzLmZvckVhY2gobW9kID0+IHtcbiAgICAgICAgdGhpcy5idWZmZXIgKz0gJyAnO1xuICAgICAgICB0aGlzLkVsZW1lbnRNb2RpZmllclN0YXRlbWVudChtb2QpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChlbC5jb21tZW50cy5sZW5ndGgpIHtcbiAgICAgIGVsLmNvbW1lbnRzLmZvckVhY2goY29tbWVudCA9PiB7XG4gICAgICAgIHRoaXMuYnVmZmVyICs9ICcgJztcbiAgICAgICAgdGhpcy5NdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQoY29tbWVudCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGVsLmJsb2NrUGFyYW1zLmxlbmd0aCkge1xuICAgICAgdGhpcy5CbG9ja1BhcmFtcyhlbC5ibG9ja1BhcmFtcyk7XG4gICAgfVxuICAgIGlmIChlbC5zZWxmQ2xvc2luZykge1xuICAgICAgdGhpcy5idWZmZXIgKz0gJyAvJztcbiAgICB9XG4gICAgdGhpcy5idWZmZXIgKz0gJz4nO1xuICB9XG5cbiAgQ2xvc2VFbGVtZW50Tm9kZShlbDogRWxlbWVudE5vZGUpOiB2b2lkIHtcbiAgICBpZiAoZWwuc2VsZkNsb3NpbmcgfHwgdm9pZE1hcFtlbC50YWcudG9Mb3dlckNhc2UoKV0pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5idWZmZXIgKz0gYDwvJHtlbC50YWd9PmA7XG4gIH1cblxuICBBdHRyTm9kZShhdHRyOiBBdHRyTm9kZSk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKGF0dHIpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IHsgbmFtZSwgdmFsdWUgfSA9IGF0dHI7XG5cbiAgICB0aGlzLmJ1ZmZlciArPSBuYW1lO1xuICAgIGlmICh2YWx1ZS50eXBlICE9PSAnVGV4dE5vZGUnIHx8IHZhbHVlLmNoYXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuYnVmZmVyICs9ICc9JztcbiAgICAgIHRoaXMuQXR0ck5vZGVWYWx1ZSh2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgQXR0ck5vZGVWYWx1ZSh2YWx1ZTogQXR0ck5vZGVbJ3ZhbHVlJ10pIHtcbiAgICBpZiAodmFsdWUudHlwZSA9PT0gJ1RleHROb2RlJykge1xuICAgICAgdGhpcy5idWZmZXIgKz0gJ1wiJztcbiAgICAgIHRoaXMuVGV4dE5vZGUodmFsdWUsIHRydWUpO1xuICAgICAgdGhpcy5idWZmZXIgKz0gJ1wiJztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5Ob2RlKHZhbHVlKTtcbiAgICB9XG4gIH1cblxuICBUZXh0Tm9kZSh0ZXh0OiBUZXh0Tm9kZSwgaXNBdHRyPzogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKHRleHQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5lbnRpdHlFbmNvZGluZyA9PT0gJ3JhdycpIHtcbiAgICAgIHRoaXMuYnVmZmVyICs9IHRleHQuY2hhcnM7XG4gICAgfSBlbHNlIGlmIChpc0F0dHIpIHtcbiAgICAgIHRoaXMuYnVmZmVyICs9IGVzY2FwZUF0dHJWYWx1ZSh0ZXh0LmNoYXJzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5idWZmZXIgKz0gZXNjYXBlVGV4dCh0ZXh0LmNoYXJzKTtcbiAgICB9XG4gIH1cblxuICBNdXN0YWNoZVN0YXRlbWVudChtdXN0YWNoZTogTXVzdGFjaGVTdGF0ZW1lbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShtdXN0YWNoZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSBtdXN0YWNoZS5lc2NhcGVkID8gJ3t7JyA6ICd7e3snO1xuXG4gICAgaWYgKG11c3RhY2hlLnN0cmlwLm9wZW4pIHtcbiAgICAgIHRoaXMuYnVmZmVyICs9ICd+JztcbiAgICB9XG5cbiAgICB0aGlzLkV4cHJlc3Npb24obXVzdGFjaGUucGF0aCk7XG4gICAgdGhpcy5QYXJhbXMobXVzdGFjaGUucGFyYW1zKTtcbiAgICB0aGlzLkhhc2gobXVzdGFjaGUuaGFzaCk7XG5cbiAgICBpZiAobXVzdGFjaGUuc3RyaXAuY2xvc2UpIHtcbiAgICAgIHRoaXMuYnVmZmVyICs9ICd+JztcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSBtdXN0YWNoZS5lc2NhcGVkID8gJ319JyA6ICd9fX0nO1xuICB9XG5cbiAgQmxvY2tTdGF0ZW1lbnQoYmxvY2s6IEJsb2NrU3RhdGVtZW50KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUoYmxvY2spKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGJsb2NrLmNoYWluZWQpIHtcbiAgICAgIHRoaXMuYnVmZmVyICs9IGJsb2NrLmludmVyc2VTdHJpcC5vcGVuID8gJ3t7ficgOiAne3snO1xuICAgICAgdGhpcy5idWZmZXIgKz0gJ2Vsc2UgJztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5idWZmZXIgKz0gYmxvY2sub3BlblN0cmlwLm9wZW4gPyAne3t+IycgOiAne3sjJztcbiAgICB9XG5cbiAgICB0aGlzLkV4cHJlc3Npb24oYmxvY2sucGF0aCk7XG4gICAgdGhpcy5QYXJhbXMoYmxvY2sucGFyYW1zKTtcbiAgICB0aGlzLkhhc2goYmxvY2suaGFzaCk7XG4gICAgaWYgKGJsb2NrLnByb2dyYW0uYmxvY2tQYXJhbXMubGVuZ3RoKSB7XG4gICAgICB0aGlzLkJsb2NrUGFyYW1zKGJsb2NrLnByb2dyYW0uYmxvY2tQYXJhbXMpO1xuICAgIH1cblxuICAgIGlmIChibG9jay5jaGFpbmVkKSB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSBibG9jay5pbnZlcnNlU3RyaXAuY2xvc2UgPyAnfn19JyA6ICd9fSc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYnVmZmVyICs9IGJsb2NrLm9wZW5TdHJpcC5jbG9zZSA/ICd+fX0nIDogJ319JztcbiAgICB9XG5cbiAgICB0aGlzLkJsb2NrKGJsb2NrLnByb2dyYW0pO1xuXG4gICAgaWYgKGJsb2NrLmludmVyc2UpIHtcbiAgICAgIGlmICghYmxvY2suaW52ZXJzZS5jaGFpbmVkKSB7XG4gICAgICAgIHRoaXMuYnVmZmVyICs9IGJsb2NrLmludmVyc2VTdHJpcC5vcGVuID8gJ3t7ficgOiAne3snO1xuICAgICAgICB0aGlzLmJ1ZmZlciArPSAnZWxzZSc7XG4gICAgICAgIHRoaXMuYnVmZmVyICs9IGJsb2NrLmludmVyc2VTdHJpcC5jbG9zZSA/ICd+fX0nIDogJ319JztcbiAgICAgIH1cblxuICAgICAgdGhpcy5CbG9jayhibG9jay5pbnZlcnNlKTtcbiAgICB9XG5cbiAgICBpZiAoIWJsb2NrLmNoYWluZWQpIHtcbiAgICAgIHRoaXMuYnVmZmVyICs9IGJsb2NrLmNsb3NlU3RyaXAub3BlbiA/ICd7e34vJyA6ICd7ey8nO1xuICAgICAgdGhpcy5FeHByZXNzaW9uKGJsb2NrLnBhdGgpO1xuICAgICAgdGhpcy5idWZmZXIgKz0gYmxvY2suY2xvc2VTdHJpcC5jbG9zZSA/ICd+fX0nIDogJ319JztcbiAgICB9XG4gIH1cblxuICBCbG9ja1BhcmFtcyhibG9ja1BhcmFtczogc3RyaW5nW10pIHtcbiAgICB0aGlzLmJ1ZmZlciArPSBgIGFzIHwke2Jsb2NrUGFyYW1zLmpvaW4oJyAnKX18YDtcbiAgfVxuXG4gIFBhcnRpYWxTdGF0ZW1lbnQocGFydGlhbDogUGFydGlhbFN0YXRlbWVudCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKHBhcnRpYWwpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gJ3t7Pic7XG4gICAgdGhpcy5FeHByZXNzaW9uKHBhcnRpYWwubmFtZSk7XG4gICAgdGhpcy5QYXJhbXMocGFydGlhbC5wYXJhbXMpO1xuICAgIHRoaXMuSGFzaChwYXJ0aWFsLmhhc2gpO1xuICAgIHRoaXMuYnVmZmVyICs9ICd9fSc7XG4gIH1cblxuICBDb25jYXRTdGF0ZW1lbnQoY29uY2F0OiBDb25jYXRTdGF0ZW1lbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShjb25jYXQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gJ1wiJztcbiAgICBjb25jYXQucGFydHMuZm9yRWFjaChwYXJ0ID0+IHtcbiAgICAgIGlmIChwYXJ0LnR5cGUgPT09ICdUZXh0Tm9kZScpIHtcbiAgICAgICAgdGhpcy5UZXh0Tm9kZShwYXJ0LCB0cnVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuTm9kZShwYXJ0KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLmJ1ZmZlciArPSAnXCInO1xuICB9XG5cbiAgTXVzdGFjaGVDb21tZW50U3RhdGVtZW50KGNvbW1lbnQ6IE11c3RhY2hlQ29tbWVudFN0YXRlbWVudCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKGNvbW1lbnQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gYHt7IS0tJHtjb21tZW50LnZhbHVlfS0tfX1gO1xuICB9XG5cbiAgRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50KG1vZDogRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUobW9kKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9ICd7eyc7XG4gICAgdGhpcy5FeHByZXNzaW9uKG1vZC5wYXRoKTtcbiAgICB0aGlzLlBhcmFtcyhtb2QucGFyYW1zKTtcbiAgICB0aGlzLkhhc2gobW9kLmhhc2gpO1xuICAgIHRoaXMuYnVmZmVyICs9ICd9fSc7XG4gIH1cblxuICBDb21tZW50U3RhdGVtZW50KGNvbW1lbnQ6IENvbW1lbnRTdGF0ZW1lbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShjb21tZW50KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9IGA8IS0tJHtjb21tZW50LnZhbHVlfS0tPmA7XG4gIH1cblxuICBQYXRoRXhwcmVzc2lvbihwYXRoOiBQYXRoRXhwcmVzc2lvbik6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKHBhdGgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gcGF0aC5vcmlnaW5hbDtcbiAgfVxuXG4gIFN1YkV4cHJlc3Npb24oc2V4cDogU3ViRXhwcmVzc2lvbik6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKHNleHApKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gJygnO1xuICAgIHRoaXMuRXhwcmVzc2lvbihzZXhwLnBhdGgpO1xuICAgIHRoaXMuUGFyYW1zKHNleHAucGFyYW1zKTtcbiAgICB0aGlzLkhhc2goc2V4cC5oYXNoKTtcbiAgICB0aGlzLmJ1ZmZlciArPSAnKSc7XG4gIH1cblxuICBQYXJhbXMocGFyYW1zOiBFeHByZXNzaW9uW10pIHtcbiAgICAvLyBUT0RPOiBpbXBsZW1lbnQgYSB0b3AgbGV2ZWwgUGFyYW1zIEFTVCBub2RlIChqdXN0IGxpa2UgdGhlIEhhc2ggb2JqZWN0KVxuICAgIC8vIHNvIHRoYXQgdGhpcyBjYW4gYWxzbyBiZSBvdmVycmlkZGVuXG4gICAgaWYgKHBhcmFtcy5sZW5ndGgpIHtcbiAgICAgIHBhcmFtcy5mb3JFYWNoKHBhcmFtID0+IHtcbiAgICAgICAgdGhpcy5idWZmZXIgKz0gJyAnO1xuICAgICAgICB0aGlzLkV4cHJlc3Npb24ocGFyYW0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgSGFzaChoYXNoOiBIYXNoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUoaGFzaCwgdHJ1ZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBoYXNoLnBhaXJzLmZvckVhY2gocGFpciA9PiB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSAnICc7XG4gICAgICB0aGlzLkhhc2hQYWlyKHBhaXIpO1xuICAgIH0pO1xuICB9XG5cbiAgSGFzaFBhaXIocGFpcjogSGFzaFBhaXIpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShwYWlyKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9IHBhaXIua2V5O1xuICAgIHRoaXMuYnVmZmVyICs9ICc9JztcbiAgICB0aGlzLk5vZGUocGFpci52YWx1ZSk7XG4gIH1cblxuICBTdHJpbmdMaXRlcmFsKHN0cjogU3RyaW5nTGl0ZXJhbCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKHN0cikpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSBKU09OLnN0cmluZ2lmeShzdHIudmFsdWUpO1xuICB9XG5cbiAgQm9vbGVhbkxpdGVyYWwoYm9vbDogQm9vbGVhbkxpdGVyYWwpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShib29sKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9IGJvb2wudmFsdWU7XG4gIH1cblxuICBOdW1iZXJMaXRlcmFsKG51bWJlcjogTnVtYmVyTGl0ZXJhbCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKG51bWJlcikpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSBudW1iZXIudmFsdWU7XG4gIH1cblxuICBVbmRlZmluZWRMaXRlcmFsKG5vZGU6IFVuZGVmaW5lZExpdGVyYWwpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShub2RlKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9ICd1bmRlZmluZWQnO1xuICB9XG5cbiAgTnVsbExpdGVyYWwobm9kZTogTnVsbExpdGVyYWwpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShub2RlKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9ICdudWxsJztcbiAgfVxuXG4gIHByaW50KG5vZGU6IE5vZGUpIHtcbiAgICBsZXQgeyBvcHRpb25zIH0gPSB0aGlzO1xuXG4gICAgaWYgKG9wdGlvbnMub3ZlcnJpZGUpIHtcbiAgICAgIGxldCByZXN1bHQgPSBvcHRpb25zLm92ZXJyaWRlKG5vZGUsIG9wdGlvbnMpO1xuXG4gICAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciA9ICcnO1xuICAgIHRoaXMuTm9kZShub2RlKTtcbiAgICByZXR1cm4gdGhpcy5idWZmZXI7XG4gIH1cbn1cblxuZnVuY3Rpb24gdW5yZWFjaGFibGUobm9kZTogbmV2ZXIpOiBuZXZlciB7XG4gIHRocm93IG5ldyBFcnJvcihgTm9uLWV4aGF1c3RpdmUgbm9kZSBuYXJyb3dpbmcgJHsoKG5vZGUgYXMgYW55KSBhcyBOb2RlKS50eXBlfWApO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==