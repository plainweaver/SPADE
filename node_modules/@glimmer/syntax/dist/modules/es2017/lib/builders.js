import { deprecate, assign } from '@glimmer/util';

function buildMustache(path, params, hash, raw, loc, strip) {
    if (typeof path === 'string') {
        path = buildHead(path);
    }
    return {
        type: 'MustacheStatement',
        path,
        params: params || [],
        hash: hash || buildHash([]),
        escaped: !raw,
        loc: buildLoc(loc || null),
        strip: strip || { open: false, close: false }
    };
}
function buildBlock(path, params, hash, _defaultBlock, _elseBlock, loc, openStrip, inverseStrip, closeStrip) {
    let defaultBlock;
    let elseBlock;
    if (_defaultBlock.type === 'Template') {
        if (false) {
            (false && !(false) && deprecate(`b.program is deprecated. Use b.blockItself instead.`));
        }
        defaultBlock = assign({}, _defaultBlock, { type: 'Block' });
    } else {
        defaultBlock = _defaultBlock;
    }
    if (_elseBlock !== undefined && _elseBlock !== null && _elseBlock.type === 'Template') {
        if (false) {
            (false && !(false) && deprecate(`b.program is deprecated. Use b.blockItself instead.`));
        }
        elseBlock = assign({}, _elseBlock, { type: 'Block' });
    } else {
        elseBlock = _elseBlock;
    }
    return {
        type: 'BlockStatement',
        path: buildHead(path),
        params: params || [],
        hash: hash || buildHash([]),
        program: defaultBlock || null,
        inverse: elseBlock || null,
        loc: buildLoc(loc || null),
        openStrip: openStrip || { open: false, close: false },
        inverseStrip: inverseStrip || { open: false, close: false },
        closeStrip: closeStrip || { open: false, close: false }
    };
}
function buildElementModifier(path, params, hash, loc) {
    return {
        type: 'ElementModifierStatement',
        path: buildHead(path),
        params: params || [],
        hash: hash || buildHash([]),
        loc: buildLoc(loc || null)
    };
}
function buildPartial(name, params, hash, indent, loc) {
    return {
        type: 'PartialStatement',
        name: name,
        params: params || [],
        hash: hash || buildHash([]),
        indent: indent || '',
        strip: { open: false, close: false },
        loc: buildLoc(loc || null)
    };
}
function buildComment(value, loc) {
    return {
        type: 'CommentStatement',
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildMustacheComment(value, loc) {
    return {
        type: 'MustacheCommentStatement',
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildConcat(parts, loc) {
    return {
        type: 'ConcatStatement',
        parts: parts || [],
        loc: buildLoc(loc || null)
    };
}
export function isLocSexp(value) {
    return Array.isArray(value) && value.length === 2 && value[0] === 'loc';
}
export function isParamsSexp(value) {
    return Array.isArray(value) && !isLocSexp(value);
}
export function isHashSexp(value) {
    if (typeof value === 'object' && value && !Array.isArray(value)) {
        expectType(value);
        return true;
    } else {
        return false;
    }
}
function expectType(_input) {
    return;
}
export function normalizeModifier(sexp) {
    if (typeof sexp === 'string') {
        return buildElementModifier(sexp);
    }
    let path = normalizeHead(sexp[0]);
    let params;
    let hash;
    let loc = null;
    let parts = sexp.slice(1);
    let next = parts.shift();
    _process: {
        if (isParamsSexp(next)) {
            params = next;
        } else {
            break _process;
        }
        next = parts.shift();
        if (isHashSexp(next)) {
            hash = normalizeHash(next);
        } else {
            break _process;
        }
    }
    if (isLocSexp(next)) {
        loc = next[1];
    }
    return {
        type: 'ElementModifierStatement',
        path,
        params: params || [],
        hash: hash || buildHash([]),
        loc: buildLoc(loc || null)
    };
}
export function normalizeAttr(sexp) {
    let name = sexp[0];
    let value;
    if (typeof sexp[1] === 'string') {
        value = buildText(sexp[1]);
    } else {
        value = sexp[1];
    }
    let loc = sexp[2] ? sexp[2][1] : undefined;
    return buildAttr(name, value, loc);
}
export function normalizeHash(hash, loc) {
    let pairs = [];
    Object.keys(hash).forEach(key => {
        pairs.push(buildPair(key, hash[key]));
    });
    return buildHash(pairs, loc);
}
export function normalizeHead(path) {
    if (typeof path === 'string') {
        return buildHead(path);
    } else {
        return buildHead(path[1], path[2] && path[2][1]);
    }
}
export function normalizeElementOptions(...args) {
    let out = {};
    for (let arg of args) {
        switch (arg[0]) {
            case 'attrs':
                {
                    let [, ...rest] = arg;
                    out.attrs = rest.map(normalizeAttr);
                    break;
                }
            case 'modifiers':
                {
                    let [, ...rest] = arg;
                    out.modifiers = rest.map(normalizeModifier);
                    break;
                }
            case 'body':
                {
                    let [, ...rest] = arg;
                    out.children = rest;
                    break;
                }
            case 'comments':
                {
                    let [, ...rest] = arg;
                    out.comments = rest;
                    break;
                }
            case 'as':
                {
                    let [, ...rest] = arg;
                    out.blockParams = rest;
                    break;
                }
            case 'loc':
                {
                    let [, rest] = arg;
                    out.loc = rest;
                    break;
                }
        }
    }
    return out;
}
function buildElement(tag, options, ...rest) {
    let normalized;
    if (Array.isArray(options)) {
        normalized = normalizeElementOptions(options, ...rest);
    } else {
        normalized = options || {};
    }
    let { attrs, blockParams, modifiers, comments, children, loc } = normalized;
    // this is used for backwards compat, prior to `selfClosing` being part of the ElementNode AST
    let selfClosing = false;
    if (typeof tag === 'object') {
        selfClosing = tag.selfClosing;
        tag = tag.name;
    } else {
        if (tag.slice(-1) === '/') {
            tag = tag.slice(0, -1);
            selfClosing = true;
        }
    }
    return {
        type: 'ElementNode',
        tag: tag || '',
        selfClosing: selfClosing,
        attributes: attrs || [],
        blockParams: blockParams || [],
        modifiers: modifiers || [],
        comments: comments || [],
        children: children || [],
        loc: buildLoc(loc || null)
    };
}
function buildAttr(name, value, loc) {
    return {
        type: 'AttrNode',
        name: name,
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildText(chars, loc) {
    return {
        type: 'TextNode',
        chars: chars || '',
        loc: buildLoc(loc || null)
    };
}
// Expressions
function buildSexpr(path, params, hash, loc) {
    return {
        type: 'SubExpression',
        path: buildHead(path),
        params: params || [],
        hash: hash || buildHash([]),
        loc: buildLoc(loc || null)
    };
}
function buildHead(original, loc) {
    if (typeof original !== 'string') return original;
    let parts = original.split('.');
    let thisHead = false;
    if (parts[0] === 'this') {
        thisHead = true;
        parts = parts.slice(1);
    }
    return {
        type: 'PathExpression',
        original,
        this: thisHead,
        parts,
        data: false,
        loc: buildLoc(loc || null)
    };
}
function buildLiteral(type, value, loc) {
    return {
        type,
        value,
        original: value,
        loc: buildLoc(loc || null)
    };
}
// Miscellaneous
function buildHash(pairs, loc) {
    return {
        type: 'Hash',
        pairs: pairs || [],
        loc: buildLoc(loc || null)
    };
}
function buildPair(key, value, loc) {
    return {
        type: 'HashPair',
        key: key,
        value,
        loc: buildLoc(loc || null)
    };
}
function buildProgram(body, blockParams, loc) {
    return {
        type: 'Template',
        body: body || [],
        blockParams: blockParams || [],
        loc: buildLoc(loc || null)
    };
}
function buildBlockItself(body, blockParams, chained = false, loc) {
    return {
        type: 'Block',
        body: body || [],
        blockParams: blockParams || [],
        chained,
        loc: buildLoc(loc || null)
    };
}
function buildTemplate(body, blockParams, loc) {
    return {
        type: 'Template',
        body: body || [],
        blockParams: blockParams || [],
        loc: buildLoc(loc || null)
    };
}
function buildSource(source) {
    return source || null;
}
function buildPosition(line, column) {
    return {
        line,
        column
    };
}
export const SYNTHETIC = {
    source: '(synthetic)',
    start: { line: 1, column: 0 },
    end: { line: 1, column: 0 }
};
function buildLoc(...args) {
    if (args.length === 1) {
        let loc = args[0];
        if (loc && typeof loc === 'object') {
            return {
                source: buildSource(loc.source),
                start: buildPosition(loc.start.line, loc.start.column),
                end: buildPosition(loc.end.line, loc.end.column)
            };
        } else {
            return SYNTHETIC;
        }
    } else {
        let [startLine, startColumn, endLine, endColumn, source] = args;
        return {
            source: buildSource(source),
            start: buildPosition(startLine, startColumn),
            end: buildPosition(endLine, endColumn)
        };
    }
}
export default {
    mustache: buildMustache,
    block: buildBlock,
    partial: buildPartial,
    comment: buildComment,
    mustacheComment: buildMustacheComment,
    element: buildElement,
    elementModifier: buildElementModifier,
    attr: buildAttr,
    text: buildText,
    sexpr: buildSexpr,
    path: buildHead,
    concat: buildConcat,
    hash: buildHash,
    pair: buildPair,
    literal: buildLiteral,
    program: buildProgram,
    blockItself: buildBlockItself,
    template: buildTemplate,
    loc: buildLoc,
    pos: buildPosition,
    string: literal('StringLiteral'),
    boolean: literal('BooleanLiteral'),
    number: literal('NumberLiteral'),
    undefined() {
        return buildLiteral('UndefinedLiteral', undefined);
    },
    null() {
        return buildLiteral('NullLiteral', null);
    }
};
function literal(type) {
    return function (value) {
        return buildLiteral(type, value);
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC9saWIvYnVpbGRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsU0FBUyxTQUFULEVBQW9CLE1BQXBCLFFBQWtDLGVBQWxDOztBQVNBLFNBQVMsYUFBVCxDQUNFLElBREYsRUFFRSxNQUZGLEVBR0UsSUFIRixFQUlFLEdBSkYsRUFLRSxHQUxGLEVBTUUsS0FORixFQU13QjtBQUV0QixRQUFJLE9BQU8sSUFBUCxLQUFnQixRQUFwQixFQUE4QjtBQUM1QixlQUFPLFVBQVUsSUFBVixDQUFQO0FBQ0Q7QUFFRCxXQUFPO0FBQ0wsY0FBTSxtQkFERDtBQUVMLFlBRks7QUFHTCxnQkFBUSxVQUFVLEVBSGI7QUFJTCxjQUFNLFFBQVEsVUFBVSxFQUFWLENBSlQ7QUFLTCxpQkFBUyxDQUFDLEdBTEw7QUFNTCxhQUFLLFNBQVMsT0FBTyxJQUFoQixDQU5BO0FBT0wsZUFBTyxTQUFTLEVBQUUsTUFBTSxLQUFSLEVBQWUsT0FBTyxLQUF0QjtBQVBYLEtBQVA7QUFTRDtBQUVELFNBQVMsVUFBVCxDQUNFLElBREYsRUFFRSxNQUZGLEVBR0UsSUFIRixFQUlFLGFBSkYsRUFLRSxVQUxGLEVBTUUsR0FORixFQU9FLFNBUEYsRUFRRSxZQVJGLEVBU0UsVUFURixFQVM2QjtBQUUzQixRQUFJLFlBQUo7QUFDQSxRQUFJLFNBQUo7QUFFQSxRQUFJLGNBQWMsSUFBZCxLQUF1QixVQUEzQixFQUF1QztBQUNyQyxtQkFBYTtBQUFBLGtDQUNYLFVBQVUscURBQVYsQ0FEVztBQUVaO0FBRUQsdUJBQWdCLE9BQU8sRUFBUCxFQUFXLGFBQVgsRUFBMEIsRUFBRSxNQUFNLE9BQVIsRUFBMUIsQ0FBaEI7QUFDRCxLQU5ELE1BTU87QUFDTCx1QkFBZSxhQUFmO0FBQ0Q7QUFFRCxRQUFJLGVBQWUsU0FBZixJQUE0QixlQUFlLElBQTNDLElBQW1ELFdBQVcsSUFBWCxLQUFvQixVQUEzRSxFQUF1RjtBQUNyRixtQkFB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Q0FBUDtBQUNELEtBRkQ7QUFHRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEFTVCBmcm9tICcuL3R5cGVzL25vZGVzJztcbmltcG9ydCB7IE9wdGlvbiwgRGljdCB9IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgZGVwcmVjYXRlLCBhc3NpZ24gfSBmcm9tICdAZ2xpbW1lci91dGlsJztcbmltcG9ydCB7IERFVk1PREUgfSBmcm9tICdAZ2xpbW1lci9sb2NhbC1kZWJ1Zy1mbGFncyc7XG5pbXBvcnQgeyBTdHJpbmdMaXRlcmFsLCBCb29sZWFuTGl0ZXJhbCwgTnVtYmVyTGl0ZXJhbCB9IGZyb20gJy4vdHlwZXMvaGFuZGxlYmFycy1hc3QnO1xuXG4vLyBTdGF0ZW1lbnRzXG5cbmV4cG9ydCB0eXBlIEJ1aWxkZXJIZWFkID0gc3RyaW5nIHwgQVNULkV4cHJlc3Npb247XG5leHBvcnQgdHlwZSBUYWdEZXNjcmlwdG9yID0gc3RyaW5nIHwgeyBuYW1lOiBzdHJpbmc7IHNlbGZDbG9zaW5nOiBib29sZWFuIH07XG5cbmZ1bmN0aW9uIGJ1aWxkTXVzdGFjaGUoXG4gIHBhdGg6IEJ1aWxkZXJIZWFkIHwgQVNULkxpdGVyYWwsXG4gIHBhcmFtcz86IEFTVC5FeHByZXNzaW9uW10sXG4gIGhhc2g/OiBBU1QuSGFzaCxcbiAgcmF3PzogYm9vbGVhbixcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uLFxuICBzdHJpcD86IEFTVC5TdHJpcEZsYWdzXG4pOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQge1xuICBpZiAodHlwZW9mIHBhdGggPT09ICdzdHJpbmcnKSB7XG4gICAgcGF0aCA9IGJ1aWxkSGVhZChwYXRoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgdHlwZTogJ011c3RhY2hlU3RhdGVtZW50JyxcbiAgICBwYXRoLFxuICAgIHBhcmFtczogcGFyYW1zIHx8IFtdLFxuICAgIGhhc2g6IGhhc2ggfHwgYnVpbGRIYXNoKFtdKSxcbiAgICBlc2NhcGVkOiAhcmF3LFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICAgIHN0cmlwOiBzdHJpcCB8fCB7IG9wZW46IGZhbHNlLCBjbG9zZTogZmFsc2UgfSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRCbG9jayhcbiAgcGF0aDogQnVpbGRlckhlYWQsXG4gIHBhcmFtczogT3B0aW9uPEFTVC5FeHByZXNzaW9uW10+LFxuICBoYXNoOiBPcHRpb248QVNULkhhc2g+LFxuICBfZGVmYXVsdEJsb2NrOiBBU1QuUG9zc2libHlEZXByZWNhdGVkQmxvY2ssXG4gIF9lbHNlQmxvY2s/OiBPcHRpb248QVNULlBvc3NpYmx5RGVwcmVjYXRlZEJsb2NrPixcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uLFxuICBvcGVuU3RyaXA/OiBBU1QuU3RyaXBGbGFncyxcbiAgaW52ZXJzZVN0cmlwPzogQVNULlN0cmlwRmxhZ3MsXG4gIGNsb3NlU3RyaXA/OiBBU1QuU3RyaXBGbGFnc1xuKTogQVNULkJsb2NrU3RhdGVtZW50IHtcbiAgbGV0IGRlZmF1bHRCbG9jazogQVNULkJsb2NrO1xuICBsZXQgZWxzZUJsb2NrOiBPcHRpb248QVNULkJsb2NrPiB8IHVuZGVmaW5lZDtcblxuICBpZiAoX2RlZmF1bHRCbG9jay50eXBlID09PSAnVGVtcGxhdGUnKSB7XG4gICAgaWYgKERFVk1PREUpIHtcbiAgICAgIGRlcHJlY2F0ZShgYi5wcm9ncmFtIGlzIGRlcHJlY2F0ZWQuIFVzZSBiLmJsb2NrSXRzZWxmIGluc3RlYWQuYCk7XG4gICAgfVxuXG4gICAgZGVmYXVsdEJsb2NrID0gKGFzc2lnbih7fSwgX2RlZmF1bHRCbG9jaywgeyB0eXBlOiAnQmxvY2snIH0pIGFzIHVua25vd24pIGFzIEFTVC5CbG9jaztcbiAgfSBlbHNlIHtcbiAgICBkZWZhdWx0QmxvY2sgPSBfZGVmYXVsdEJsb2NrO1xuICB9XG5cbiAgaWYgKF9lbHNlQmxvY2sgIT09IHVuZGVmaW5lZCAmJiBfZWxzZUJsb2NrICE9PSBudWxsICYmIF9lbHNlQmxvY2sudHlwZSA9PT0gJ1RlbXBsYXRlJykge1xuICAgIGlmIChERVZNT0RFKSB7XG4gICAgICBkZXByZWNhdGUoYGIucHJvZ3JhbSBpcyBkZXByZWNhdGVkLiBVc2UgYi5ibG9ja0l0c2VsZiBpbnN0ZWFkLmApO1xuICAgIH1cblxuICAgIGVsc2VCbG9jayA9IChhc3NpZ24oe30sIF9lbHNlQmxvY2ssIHsgdHlwZTogJ0Jsb2NrJyB9KSBhcyB1bmtub3duKSBhcyBBU1QuQmxvY2s7XG4gIH0gZWxzZSB7XG4gICAgZWxzZUJsb2NrID0gX2Vsc2VCbG9jaztcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0Jsb2NrU3RhdGVtZW50JyxcbiAgICBwYXRoOiBidWlsZEhlYWQocGF0aCksXG4gICAgcGFyYW1zOiBwYXJhbXMgfHwgW10sXG4gICAgaGFzaDogaGFzaCB8fCBidWlsZEhhc2goW10pLFxuICAgIHByb2dyYW06IGRlZmF1bHRCbG9jayB8fCBudWxsLFxuICAgIGludmVyc2U6IGVsc2VCbG9jayB8fCBudWxsLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICAgIG9wZW5TdHJpcDogb3BlblN0cmlwIHx8IHsgb3BlbjogZmFsc2UsIGNsb3NlOiBmYWxzZSB9LFxuICAgIGludmVyc2VTdHJpcDogaW52ZXJzZVN0cmlwIHx8IHsgb3BlbjogZmFsc2UsIGNsb3NlOiBmYWxzZSB9LFxuICAgIGNsb3NlU3RyaXA6IGNsb3NlU3RyaXAgfHwgeyBvcGVuOiBmYWxzZSwgY2xvc2U6IGZhbHNlIH0sXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkRWxlbWVudE1vZGlmaWVyKFxuICBwYXRoOiBCdWlsZGVySGVhZCxcbiAgcGFyYW1zPzogQVNULkV4cHJlc3Npb25bXSxcbiAgaGFzaD86IEFTVC5IYXNoLFxuICBsb2M/OiBPcHRpb248QVNULlNvdXJjZUxvY2F0aW9uPlxuKTogQVNULkVsZW1lbnRNb2RpZmllclN0YXRlbWVudCB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0VsZW1lbnRNb2RpZmllclN0YXRlbWVudCcsXG4gICAgcGF0aDogYnVpbGRIZWFkKHBhdGgpLFxuICAgIHBhcmFtczogcGFyYW1zIHx8IFtdLFxuICAgIGhhc2g6IGhhc2ggfHwgYnVpbGRIYXNoKFtdKSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRQYXJ0aWFsKFxuICBuYW1lOiBBU1QuUGF0aEV4cHJlc3Npb24sXG4gIHBhcmFtcz86IEFTVC5FeHByZXNzaW9uW10sXG4gIGhhc2g/OiBBU1QuSGFzaCxcbiAgaW5kZW50Pzogc3RyaW5nLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5QYXJ0aWFsU3RhdGVtZW50IHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnUGFydGlhbFN0YXRlbWVudCcsXG4gICAgbmFtZTogbmFtZSxcbiAgICBwYXJhbXM6IHBhcmFtcyB8fCBbXSxcbiAgICBoYXNoOiBoYXNoIHx8IGJ1aWxkSGFzaChbXSksXG4gICAgaW5kZW50OiBpbmRlbnQgfHwgJycsXG4gICAgc3RyaXA6IHsgb3BlbjogZmFsc2UsIGNsb3NlOiBmYWxzZSB9LFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZENvbW1lbnQodmFsdWU6IHN0cmluZywgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkNvbW1lbnRTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdDb21tZW50U3RhdGVtZW50JyxcbiAgICB2YWx1ZTogdmFsdWUsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkTXVzdGFjaGVDb21tZW50KFxuICB2YWx1ZTogc3RyaW5nLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5NdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdNdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQnLFxuICAgIHZhbHVlOiB2YWx1ZSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRDb25jYXQoXG4gIHBhcnRzOiAoQVNULlRleHROb2RlIHwgQVNULk11c3RhY2hlU3RhdGVtZW50KVtdLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5Db25jYXRTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdDb25jYXRTdGF0ZW1lbnQnLFxuICAgIHBhcnRzOiBwYXJ0cyB8fCBbXSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuLy8gTm9kZXNcblxuZXhwb3J0IHR5cGUgRWxlbWVudEFyZ3MgPVxuICB8IFsnYXR0cnMnLCAuLi5BdHRyU2V4cFtdXVxuICB8IFsnbW9kaWZpZXJzJywgLi4uTW9kaWZpZXJTZXhwW11dXG4gIHwgWydib2R5JywgLi4uQVNULlN0YXRlbWVudFtdXVxuICB8IFsnY29tbWVudHMnLCAuLi5FbGVtZW50Q29tbWVudFtdXVxuICB8IFsnYXMnLCAuLi5zdHJpbmdbXV1cbiAgfCBbJ2xvYycsIEFTVC5Tb3VyY2VMb2NhdGlvbl07XG5cbmV4cG9ydCB0eXBlIFBhdGhTZXhwID0gc3RyaW5nIHwgWydwYXRoJywgc3RyaW5nLCBMb2NTZXhwP107XG5cbmV4cG9ydCB0eXBlIE1vZGlmaWVyU2V4cCA9XG4gIHwgc3RyaW5nXG4gIHwgW1BhdGhTZXhwLCBMb2NTZXhwP11cbiAgfCBbUGF0aFNleHAsIEFTVC5FeHByZXNzaW9uW10sIExvY1NleHA/XVxuICB8IFtQYXRoU2V4cCwgQVNULkV4cHJlc3Npb25bXSwgRGljdDxBU1QuRXhwcmVzc2lvbj4sIExvY1NleHA/XTtcblxuZXhwb3J0IHR5cGUgQXR0clNleHAgPSBbc3RyaW5nLCBBU1QuQXR0ck5vZGVbJ3ZhbHVlJ10gfCBzdHJpbmcsIExvY1NleHA/XTtcblxuZXhwb3J0IHR5cGUgTG9jU2V4cCA9IFsnbG9jJywgQVNULlNvdXJjZUxvY2F0aW9uXTtcblxuZXhwb3J0IHR5cGUgRWxlbWVudENvbW1lbnQgPSBBU1QuTXVzdGFjaGVDb21tZW50U3RhdGVtZW50IHwgQVNULlNvdXJjZUxvY2F0aW9uIHwgc3RyaW5nO1xuXG5leHBvcnQgdHlwZSBTZXhwVmFsdWUgPVxuICB8IHN0cmluZ1xuICB8IEFTVC5FeHByZXNzaW9uW11cbiAgfCBEaWN0PEFTVC5FeHByZXNzaW9uPlxuICB8IExvY1NleHBcbiAgfCBQYXRoU2V4cFxuICB8IHVuZGVmaW5lZDtcblxuZXhwb3J0IGZ1bmN0aW9uIGlzTG9jU2V4cCh2YWx1ZTogU2V4cFZhbHVlKTogdmFsdWUgaXMgTG9jU2V4cCB7XG4gIHJldHVybiBBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDIgJiYgdmFsdWVbMF0gPT09ICdsb2MnO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNQYXJhbXNTZXhwKHZhbHVlOiBTZXhwVmFsdWUpOiB2YWx1ZSBpcyBBU1QuRXhwcmVzc2lvbltdIHtcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpICYmICFpc0xvY1NleHAodmFsdWUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNIYXNoU2V4cCh2YWx1ZTogU2V4cFZhbHVlKTogdmFsdWUgaXMgRGljdDxBU1QuRXhwcmVzc2lvbj4ge1xuICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiAhQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICBleHBlY3RUeXBlPERpY3Q8QVNULkV4cHJlc3Npb24+Pih2YWx1ZSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGV4cGVjdFR5cGU8VD4oX2lucHV0OiBUKTogdm9pZCB7XG4gIHJldHVybjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZU1vZGlmaWVyKHNleHA6IE1vZGlmaWVyU2V4cCk6IEFTVC5FbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnQge1xuICBpZiAodHlwZW9mIHNleHAgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGJ1aWxkRWxlbWVudE1vZGlmaWVyKHNleHApO1xuICB9XG5cbiAgbGV0IHBhdGg6IEFTVC5FeHByZXNzaW9uID0gbm9ybWFsaXplSGVhZChzZXhwWzBdKTtcbiAgbGV0IHBhcmFtczogQVNULkV4cHJlc3Npb25bXSB8IHVuZGVmaW5lZDtcbiAgbGV0IGhhc2g6IEFTVC5IYXNoIHwgdW5kZWZpbmVkO1xuICBsZXQgbG9jOiBBU1QuU291cmNlTG9jYXRpb24gfCBudWxsID0gbnVsbDtcblxuICBsZXQgcGFydHMgPSBzZXhwLnNsaWNlKDEpO1xuICBsZXQgbmV4dCA9IHBhcnRzLnNoaWZ0KCk7XG5cbiAgX3Byb2Nlc3M6IHtcbiAgICBpZiAoaXNQYXJhbXNTZXhwKG5leHQpKSB7XG4gICAgICBwYXJhbXMgPSBuZXh0IGFzIEFTVC5FeHByZXNzaW9uW107XG4gICAgfSBlbHNlIHtcbiAgICAgIGJyZWFrIF9wcm9jZXNzO1xuICAgIH1cblxuICAgIG5leHQgPSBwYXJ0cy5zaGlmdCgpO1xuXG4gICAgaWYgKGlzSGFzaFNleHAobmV4dCkpIHtcbiAgICAgIGhhc2ggPSBub3JtYWxpemVIYXNoKG5leHQgYXMgRGljdDxBU1QuRXhwcmVzc2lvbj4pO1xuICAgIH0gZWxzZSB7XG4gICAgICBicmVhayBfcHJvY2VzcztcbiAgICB9XG4gIH1cblxuICBpZiAoaXNMb2NTZXhwKG5leHQpKSB7XG4gICAgbG9jID0gbmV4dFsxXTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0VsZW1lbnRNb2RpZmllclN0YXRlbWVudCcsXG4gICAgcGF0aCxcbiAgICBwYXJhbXM6IHBhcmFtcyB8fCBbXSxcbiAgICBoYXNoOiBoYXNoIHx8IGJ1aWxkSGFzaChbXSksXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVBdHRyKHNleHA6IEF0dHJTZXhwKTogQVNULkF0dHJOb2RlIHtcbiAgbGV0IG5hbWUgPSBzZXhwWzBdO1xuICBsZXQgdmFsdWU7XG5cbiAgaWYgKHR5cGVvZiBzZXhwWzFdID09PSAnc3RyaW5nJykge1xuICAgIHZhbHVlID0gYnVpbGRUZXh0KHNleHBbMV0pO1xuICB9IGVsc2Uge1xuICAgIHZhbHVlID0gc2V4cFsxXTtcbiAgfVxuXG4gIGxldCBsb2MgPSBzZXhwWzJdID8gc2V4cFsyXVsxXSA6IHVuZGVmaW5lZDtcblxuICByZXR1cm4gYnVpbGRBdHRyKG5hbWUsIHZhbHVlLCBsb2MpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplSGFzaChoYXNoOiBEaWN0PEFTVC5FeHByZXNzaW9uPiwgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkhhc2gge1xuICBsZXQgcGFpcnM6IEFTVC5IYXNoUGFpcltdID0gW107XG5cbiAgT2JqZWN0LmtleXMoaGFzaCkuZm9yRWFjaChrZXkgPT4ge1xuICAgIHBhaXJzLnB1c2goYnVpbGRQYWlyKGtleSwgaGFzaFtrZXldKSk7XG4gIH0pO1xuXG4gIHJldHVybiBidWlsZEhhc2gocGFpcnMsIGxvYyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVIZWFkKHBhdGg6IFBhdGhTZXhwKTogQVNULkV4cHJlc3Npb24ge1xuICBpZiAodHlwZW9mIHBhdGggPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGJ1aWxkSGVhZChwYXRoKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYnVpbGRIZWFkKHBhdGhbMV0sIHBhdGhbMl0gJiYgcGF0aFsyXVsxXSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUVsZW1lbnRPcHRpb25zKC4uLmFyZ3M6IEVsZW1lbnRBcmdzW10pOiBCdWlsZEVsZW1lbnRPcHRpb25zIHtcbiAgbGV0IG91dDogQnVpbGRFbGVtZW50T3B0aW9ucyA9IHt9O1xuXG4gIGZvciAobGV0IGFyZyBvZiBhcmdzKSB7XG4gICAgc3dpdGNoIChhcmdbMF0pIHtcbiAgICAgIGNhc2UgJ2F0dHJzJzoge1xuICAgICAgICBsZXQgWywgLi4ucmVzdF0gPSBhcmc7XG4gICAgICAgIG91dC5hdHRycyA9IHJlc3QubWFwKG5vcm1hbGl6ZUF0dHIpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgJ21vZGlmaWVycyc6IHtcbiAgICAgICAgbGV0IFssIC4uLnJlc3RdID0gYXJnO1xuICAgICAgICBvdXQubW9kaWZpZXJzID0gcmVzdC5tYXAobm9ybWFsaXplTW9kaWZpZXIpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgJ2JvZHknOiB7XG4gICAgICAgIGxldCBbLCAuLi5yZXN0XSA9IGFyZztcbiAgICAgICAgb3V0LmNoaWxkcmVuID0gcmVzdDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlICdjb21tZW50cyc6IHtcbiAgICAgICAgbGV0IFssIC4uLnJlc3RdID0gYXJnO1xuXG4gICAgICAgIG91dC5jb21tZW50cyA9IHJlc3Q7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSAnYXMnOiB7XG4gICAgICAgIGxldCBbLCAuLi5yZXN0XSA9IGFyZztcbiAgICAgICAgb3V0LmJsb2NrUGFyYW1zID0gcmVzdDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlICdsb2MnOiB7XG4gICAgICAgIGxldCBbLCByZXN0XSA9IGFyZztcbiAgICAgICAgb3V0LmxvYyA9IHJlc3Q7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvdXQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQnVpbGRFbGVtZW50T3B0aW9ucyB7XG4gIGF0dHJzPzogQVNULkF0dHJOb2RlW107XG4gIG1vZGlmaWVycz86IEFTVC5FbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnRbXTtcbiAgY2hpbGRyZW4/OiBBU1QuU3RhdGVtZW50W107XG4gIGNvbW1lbnRzPzogRWxlbWVudENvbW1lbnRbXTtcbiAgYmxvY2tQYXJhbXM/OiBzdHJpbmdbXTtcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uO1xufVxuXG5mdW5jdGlvbiBidWlsZEVsZW1lbnQodGFnOiBUYWdEZXNjcmlwdG9yLCBvcHRpb25zPzogQnVpbGRFbGVtZW50T3B0aW9ucyk6IEFTVC5FbGVtZW50Tm9kZTtcbmZ1bmN0aW9uIGJ1aWxkRWxlbWVudCh0YWc6IFRhZ0Rlc2NyaXB0b3IsIC4uLm9wdGlvbnM6IEVsZW1lbnRBcmdzW10pOiBBU1QuRWxlbWVudE5vZGU7XG5mdW5jdGlvbiBidWlsZEVsZW1lbnQoXG4gIHRhZzogVGFnRGVzY3JpcHRvcixcbiAgb3B0aW9ucz86IEJ1aWxkRWxlbWVudE9wdGlvbnMgfCBFbGVtZW50QXJncyxcbiAgLi4ucmVzdDogRWxlbWVudEFyZ3NbXVxuKTogQVNULkVsZW1lbnROb2RlIHtcbiAgbGV0IG5vcm1hbGl6ZWQ6IEJ1aWxkRWxlbWVudE9wdGlvbnM7XG4gIGlmIChBcnJheS5pc0FycmF5KG9wdGlvbnMpKSB7XG4gICAgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZUVsZW1lbnRPcHRpb25zKG9wdGlvbnMsIC4uLnJlc3QpO1xuICB9IGVsc2Uge1xuICAgIG5vcm1hbGl6ZWQgPSBvcHRpb25zIHx8IHt9O1xuICB9XG5cbiAgbGV0IHsgYXR0cnMsIGJsb2NrUGFyYW1zLCBtb2RpZmllcnMsIGNvbW1lbnRzLCBjaGlsZHJlbiwgbG9jIH0gPSBub3JtYWxpemVkO1xuXG4gIC8vIHRoaXMgaXMgdXNlZCBmb3IgYmFja3dhcmRzIGNvbXBhdCwgcHJpb3IgdG8gYHNlbGZDbG9zaW5nYCBiZWluZyBwYXJ0IG9mIHRoZSBFbGVtZW50Tm9kZSBBU1RcbiAgbGV0IHNlbGZDbG9zaW5nID0gZmFsc2U7XG4gIGlmICh0eXBlb2YgdGFnID09PSAnb2JqZWN0Jykge1xuICAgIHNlbGZDbG9zaW5nID0gdGFnLnNlbGZDbG9zaW5nO1xuICAgIHRhZyA9IHRhZy5uYW1lO1xuICB9IGVsc2Uge1xuICAgIGlmICh0YWcuc2xpY2UoLTEpID09PSAnLycpIHtcbiAgICAgIHRhZyA9IHRhZy5zbGljZSgwLCAtMSk7XG4gICAgICBzZWxmQ2xvc2luZyA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnRWxlbWVudE5vZGUnLFxuICAgIHRhZzogdGFnIHx8ICcnLFxuICAgIHNlbGZDbG9zaW5nOiBzZWxmQ2xvc2luZyxcbiAgICBhdHRyaWJ1dGVzOiBhdHRycyB8fCBbXSxcbiAgICBibG9ja1BhcmFtczogYmxvY2tQYXJhbXMgfHwgW10sXG4gICAgbW9kaWZpZXJzOiBtb2RpZmllcnMgfHwgW10sXG4gICAgY29tbWVudHM6IChjb21tZW50cyBhcyBBU1QuTXVzdGFjaGVDb21tZW50U3RhdGVtZW50W10pIHx8IFtdLFxuICAgIGNoaWxkcmVuOiBjaGlsZHJlbiB8fCBbXSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRBdHRyKFxuICBuYW1lOiBzdHJpbmcsXG4gIHZhbHVlOiBBU1QuQXR0ck5vZGVbJ3ZhbHVlJ10sXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULkF0dHJOb2RlIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnQXR0ck5vZGUnLFxuICAgIG5hbWU6IG5hbWUsXG4gICAgdmFsdWU6IHZhbHVlLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFRleHQoY2hhcnM/OiBzdHJpbmcsIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5UZXh0Tm9kZSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ1RleHROb2RlJyxcbiAgICBjaGFyczogY2hhcnMgfHwgJycsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbi8vIEV4cHJlc3Npb25zXG5cbmZ1bmN0aW9uIGJ1aWxkU2V4cHIoXG4gIHBhdGg6IEJ1aWxkZXJIZWFkLFxuICBwYXJhbXM/OiBBU1QuRXhwcmVzc2lvbltdLFxuICBoYXNoPzogQVNULkhhc2gsXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULlN1YkV4cHJlc3Npb24ge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdTdWJFeHByZXNzaW9uJyxcbiAgICBwYXRoOiBidWlsZEhlYWQocGF0aCksXG4gICAgcGFyYW1zOiBwYXJhbXMgfHwgW10sXG4gICAgaGFzaDogaGFzaCB8fCBidWlsZEhhc2goW10pLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZEhlYWQob3JpZ2luYWw6IEJ1aWxkZXJIZWFkLCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuRXhwcmVzc2lvbiB7XG4gIGlmICh0eXBlb2Ygb3JpZ2luYWwgIT09ICdzdHJpbmcnKSByZXR1cm4gb3JpZ2luYWw7XG5cbiAgbGV0IHBhcnRzID0gb3JpZ2luYWwuc3BsaXQoJy4nKTtcbiAgbGV0IHRoaXNIZWFkID0gZmFsc2U7XG5cbiAgaWYgKHBhcnRzWzBdID09PSAndGhpcycpIHtcbiAgICB0aGlzSGVhZCA9IHRydWU7XG4gICAgcGFydHMgPSBwYXJ0cy5zbGljZSgxKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgdHlwZTogJ1BhdGhFeHByZXNzaW9uJyxcbiAgICBvcmlnaW5hbCxcbiAgICB0aGlzOiB0aGlzSGVhZCxcbiAgICBwYXJ0cyxcbiAgICBkYXRhOiBmYWxzZSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRMaXRlcmFsPFQgZXh0ZW5kcyBBU1QuTGl0ZXJhbD4oXG4gIHR5cGU6IFRbJ3R5cGUnXSxcbiAgdmFsdWU6IFRbJ3ZhbHVlJ10sXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogVCB7XG4gIHJldHVybiB7XG4gICAgdHlwZSxcbiAgICB2YWx1ZSxcbiAgICBvcmlnaW5hbDogdmFsdWUsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH0gYXMgVDtcbn1cblxuLy8gTWlzY2VsbGFuZW91c1xuXG5mdW5jdGlvbiBidWlsZEhhc2gocGFpcnM/OiBBU1QuSGFzaFBhaXJbXSwgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkhhc2gge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdIYXNoJyxcbiAgICBwYWlyczogcGFpcnMgfHwgW10sXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkUGFpcihrZXk6IHN0cmluZywgdmFsdWU6IEFTVC5FeHByZXNzaW9uLCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuSGFzaFBhaXIge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdIYXNoUGFpcicsXG4gICAga2V5OiBrZXksXG4gICAgdmFsdWUsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkUHJvZ3JhbShcbiAgYm9keT86IEFTVC5TdGF0ZW1lbnRbXSxcbiAgYmxvY2tQYXJhbXM/OiBzdHJpbmdbXSxcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uXG4pOiBBU1QuVGVtcGxhdGUge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdUZW1wbGF0ZScsXG4gICAgYm9keTogYm9keSB8fCBbXSxcbiAgICBibG9ja1BhcmFtczogYmxvY2tQYXJhbXMgfHwgW10sXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQmxvY2tJdHNlbGYoXG4gIGJvZHk/OiBBU1QuU3RhdGVtZW50W10sXG4gIGJsb2NrUGFyYW1zPzogc3RyaW5nW10sXG4gIGNoYWluZWQgPSBmYWxzZSxcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uXG4pOiBBU1QuQmxvY2sge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdCbG9jaycsXG4gICAgYm9keTogYm9keSB8fCBbXSxcbiAgICBibG9ja1BhcmFtczogYmxvY2tQYXJhbXMgfHwgW10sXG4gICAgY2hhaW5lZCxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRUZW1wbGF0ZShcbiAgYm9keT86IEFTVC5TdGF0ZW1lbnRbXSxcbiAgYmxvY2tQYXJhbXM/OiBzdHJpbmdbXSxcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uXG4pOiBBU1QuVGVtcGxhdGUge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdUZW1wbGF0ZScsXG4gICAgYm9keTogYm9keSB8fCBbXSxcbiAgICBibG9ja1BhcmFtczogYmxvY2tQYXJhbXMgfHwgW10sXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkU291cmNlKHNvdXJjZT86IHN0cmluZykge1xuICByZXR1cm4gc291cmNlIHx8IG51bGw7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkUG9zaXRpb24obGluZTogbnVtYmVyLCBjb2x1bW46IG51bWJlcikge1xuICByZXR1cm4ge1xuICAgIGxpbmUsXG4gICAgY29sdW1uLFxuICB9O1xufVxuXG5leHBvcnQgY29uc3QgU1lOVEhFVElDOiBBU1QuU291cmNlTG9jYXRpb24gPSB7XG4gIHNvdXJjZTogJyhzeW50aGV0aWMpJyxcbiAgc3RhcnQ6IHsgbGluZTogMSwgY29sdW1uOiAwIH0sXG4gIGVuZDogeyBsaW5lOiAxLCBjb2x1bW46IDAgfSxcbn07XG5cbmZ1bmN0aW9uIGJ1aWxkTG9jKGxvYzogT3B0aW9uPEFTVC5Tb3VyY2VMb2NhdGlvbj4pOiBBU1QuU291cmNlTG9jYXRpb247XG5mdW5jdGlvbiBidWlsZExvYyhcbiAgc3RhcnRMaW5lOiBudW1iZXIsXG4gIHN0YXJ0Q29sdW1uOiBudW1iZXIsXG4gIGVuZExpbmU/OiBudW1iZXIsXG4gIGVuZENvbHVtbj86IG51bWJlcixcbiAgc291cmNlPzogc3RyaW5nXG4pOiBBU1QuU291cmNlTG9jYXRpb247XG5cbmZ1bmN0aW9uIGJ1aWxkTG9jKC4uLmFyZ3M6IGFueVtdKTogQVNULlNvdXJjZUxvY2F0aW9uIHtcbiAgaWYgKGFyZ3MubGVuZ3RoID09PSAxKSB7XG4gICAgbGV0IGxvYyA9IGFyZ3NbMF07XG5cbiAgICBpZiAobG9jICYmIHR5cGVvZiBsb2MgPT09ICdvYmplY3QnKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzb3VyY2U6IGJ1aWxkU291cmNlKGxvYy5zb3VyY2UpLFxuICAgICAgICBzdGFydDogYnVpbGRQb3NpdGlvbihsb2Muc3RhcnQubGluZSwgbG9jLnN0YXJ0LmNvbHVtbiksXG4gICAgICAgIGVuZDogYnVpbGRQb3NpdGlvbihsb2MuZW5kLmxpbmUsIGxvYy5lbmQuY29sdW1uKSxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBTWU5USEVUSUM7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxldCBbc3RhcnRMaW5lLCBzdGFydENvbHVtbiwgZW5kTGluZSwgZW5kQ29sdW1uLCBzb3VyY2VdID0gYXJncztcbiAgICByZXR1cm4ge1xuICAgICAgc291cmNlOiBidWlsZFNvdXJjZShzb3VyY2UpLFxuICAgICAgc3RhcnQ6IGJ1aWxkUG9zaXRpb24oc3RhcnRMaW5lLCBzdGFydENvbHVtbiksXG4gICAgICBlbmQ6IGJ1aWxkUG9zaXRpb24oZW5kTGluZSwgZW5kQ29sdW1uKSxcbiAgICB9O1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgbXVzdGFjaGU6IGJ1aWxkTXVzdGFjaGUsXG4gIGJsb2NrOiBidWlsZEJsb2NrLFxuICBwYXJ0aWFsOiBidWlsZFBhcnRpYWwsXG4gIGNvbW1lbnQ6IGJ1aWxkQ29tbWVudCxcbiAgbXVzdGFjaGVDb21tZW50OiBidWlsZE11c3RhY2hlQ29tbWVudCxcbiAgZWxlbWVudDogYnVpbGRFbGVtZW50LFxuICBlbGVtZW50TW9kaWZpZXI6IGJ1aWxkRWxlbWVudE1vZGlmaWVyLFxuICBhdHRyOiBidWlsZEF0dHIsXG4gIHRleHQ6IGJ1aWxkVGV4dCxcbiAgc2V4cHI6IGJ1aWxkU2V4cHIsXG4gIHBhdGg6IGJ1aWxkSGVhZCxcbiAgY29uY2F0OiBidWlsZENvbmNhdCxcbiAgaGFzaDogYnVpbGRIYXNoLFxuICBwYWlyOiBidWlsZFBhaXIsXG4gIGxpdGVyYWw6IGJ1aWxkTGl0ZXJhbCxcbiAgcHJvZ3JhbTogYnVpbGRQcm9ncmFtLFxuICBibG9ja0l0c2VsZjogYnVpbGRCbG9ja0l0c2VsZixcbiAgdGVtcGxhdGU6IGJ1aWxkVGVtcGxhdGUsXG4gIGxvYzogYnVpbGRMb2MsXG4gIHBvczogYnVpbGRQb3NpdGlvbixcblxuICBzdHJpbmc6IGxpdGVyYWwoJ1N0cmluZ0xpdGVyYWwnKSBhcyAodmFsdWU6IHN0cmluZykgPT4gU3RyaW5nTGl0ZXJhbCxcbiAgYm9vbGVhbjogbGl0ZXJhbCgnQm9vbGVhbkxpdGVyYWwnKSBhcyAodmFsdWU6IGJvb2xlYW4pID0+IEJvb2xlYW5MaXRlcmFsLFxuICBudW1iZXI6IGxpdGVyYWwoJ051bWJlckxpdGVyYWwnKSBhcyAodmFsdWU6IG51bWJlcikgPT4gTnVtYmVyTGl0ZXJhbCxcbiAgdW5kZWZpbmVkKCkge1xuICAgIHJldHVybiBidWlsZExpdGVyYWwoJ1VuZGVmaW5lZExpdGVyYWwnLCB1bmRlZmluZWQpO1xuICB9LFxuICBudWxsKCkge1xuICAgIHJldHVybiBidWlsZExpdGVyYWwoJ051bGxMaXRlcmFsJywgbnVsbCk7XG4gIH0sXG59O1xuXG50eXBlIEJ1aWxkTGl0ZXJhbDxUIGV4dGVuZHMgQVNULkxpdGVyYWw+ID0gKHZhbHVlOiBUWyd2YWx1ZSddKSA9PiBUO1xuXG5mdW5jdGlvbiBsaXRlcmFsPFQgZXh0ZW5kcyBBU1QuTGl0ZXJhbD4odHlwZTogVFsndHlwZSddKTogQnVpbGRMaXRlcmFsPFQ+IHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlOiBUWyd2YWx1ZSddKTogVCB7XG4gICAgcmV0dXJuIGJ1aWxkTGl0ZXJhbCh0eXBlLCB2YWx1ZSk7XG4gIH07XG59XG4iXSwic291cmNlUm9vdCI6IiJ9