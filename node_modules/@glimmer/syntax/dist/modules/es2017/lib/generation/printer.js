import { voidMap } from '../parser/tokenizer-event-handlers';
import { escapeText, escapeAttrValue } from './util';
const NON_WHITESPACE = /\S/;
export default class Printer {
    constructor(options) {
        this.buffer = '';
        this.options = options;
    }
    /*
      This is used by _all_ methods on this Printer class that add to `this.buffer`,
      it allows consumers of the printer to use alternate string representations for
      a given node.
         The primary use case for this are things like source -> source codemod utilities.
      For example, ember-template-recast attempts to always preserve the original string
      formatting in each AST node if no modifications are made to it.
    */
    handledByOverride(node, ensureLeadingWhitespace = false) {
        if (this.options.override !== undefined) {
            let result = this.options.override(node, this.options);
            if (typeof result === 'string') {
                if (ensureLeadingWhitespace && NON_WHITESPACE.test(result[0])) {
                    result = ` ${result}`;
                }
                this.buffer += result;
                return true;
            }
        }
        return false;
    }
    Node(node) {
        switch (node.type) {
            case 'MustacheStatement':
            case 'BlockStatement':
            case 'PartialStatement':
            case 'MustacheCommentStatement':
            case 'CommentStatement':
            case 'TextNode':
            case 'ElementNode':
            case 'AttrNode':
            case 'Block':
            case 'Template':
                return this.TopLevelStatement(node);
            case 'StringLiteral':
            case 'BooleanLiteral':
            case 'NumberLiteral':
            case 'UndefinedLiteral':
            case 'NullLiteral':
            case 'PathExpression':
            case 'SubExpression':
                return this.Expression(node);
            case 'Program':
                return this.Block(node);
            case 'ConcatStatement':
                // should have an AttrNode parent
                return this.ConcatStatement(node);
            case 'Hash':
                return this.Hash(node);
            case 'HashPair':
                return this.HashPair(node);
            case 'ElementModifierStatement':
                return this.ElementModifierStatement(node);
        }
        return unreachable(node);
    }
    Expression(expression) {
        switch (expression.type) {
            case 'StringLiteral':
            case 'BooleanLiteral':
            case 'NumberLiteral':
            case 'UndefinedLiteral':
            case 'NullLiteral':
                return this.Literal(expression);
            case 'PathExpression':
                return this.PathExpression(expression);
            case 'SubExpression':
                return this.SubExpression(expression);
        }
        return unreachable(expression);
    }
    Literal(literal) {
        switch (literal.type) {
            case 'StringLiteral':
                return this.StringLiteral(literal);
            case 'BooleanLiteral':
                return this.BooleanLiteral(literal);
            case 'NumberLiteral':
                return this.NumberLiteral(literal);
            case 'UndefinedLiteral':
                return this.UndefinedLiteral(literal);
            case 'NullLiteral':
                return this.NullLiteral(literal);
        }
        return unreachable(literal);
    }
    TopLevelStatement(statement) {
        switch (statement.type) {
            case 'MustacheStatement':
                return this.MustacheStatement(statement);
            case 'BlockStatement':
                return this.BlockStatement(statement);
            case 'PartialStatement':
                return this.PartialStatement(statement);
            case 'MustacheCommentStatement':
                return this.MustacheCommentStatement(statement);
            case 'CommentStatement':
                return this.CommentStatement(statement);
            case 'TextNode':
                return this.TextNode(statement);
            case 'ElementNode':
                return this.ElementNode(statement);
            case 'Block':
            case 'Template':
                return this.Block(statement);
            case 'AttrNode':
                // should have element
                return this.AttrNode(statement);
        }
        unreachable(statement);
    }
    Block(block) {
        /*
          When processing a template like:
               ```hbs
          {{#if whatever}}
            whatever
          {{else if somethingElse}}
            something else
          {{else}}
            fallback
          {{/if}}
          ```
               The AST still _effectively_ looks like:
               ```hbs
          {{#if whatever}}
            whatever
          {{else}}{{#if somethingElse}}
            something else
          {{else}}
            fallback
          {{/if}}{{/if}}
          ```
               The only way we can tell if that is the case is by checking for
          `block.chained`, but unfortunately when the actual statements are
          processed the `block.body[0]` node (which will always be a
          `BlockStatement`) has no clue that its anscestor `Block` node was
          chained.
               This "forwards" the `chained` setting so that we can check
          it later when processing the `BlockStatement`.
        */
        if (block.chained) {
            let firstChild = block.body[0];
            firstChild.chained = true;
        }
        if (this.handledByOverride(block)) {
            return;
        }
        this.TopLevelStatements(block.body);
    }
    TopLevelStatements(statements) {
        statements.forEach(statement => this.TopLevelStatement(statement));
    }
    ElementNode(el) {
        if (this.handledByOverride(el)) {
            return;
        }
        this.OpenElementNode(el);
        this.TopLevelStatements(el.children);
        this.CloseElementNode(el);
    }
    OpenElementNode(el) {
        this.buffer += `<${el.tag}`;
        if (el.attributes.length) {
            el.attributes.forEach(attr => {
                this.buffer += ' ';
                this.AttrNode(attr);
            });
        }
        if (el.modifiers.length) {
            el.modifiers.forEach(mod => {
                this.buffer += ' ';
                this.ElementModifierStatement(mod);
            });
        }
        if (el.comments.length) {
            el.comments.forEach(comment => {
                this.buffer += ' ';
                this.MustacheCommentStatement(comment);
            });
        }
        if (el.blockParams.length) {
            this.BlockParams(el.blockParams);
        }
        if (el.selfClosing) {
            this.buffer += ' /';
        }
        this.buffer += '>';
    }
    CloseElementNode(el) {
        if (el.selfClosing || voidMap[el.tag.toLowerCase()]) {
            return;
        }
        this.buffer += `</${el.tag}>`;
    }
    AttrNode(attr) {
        if (this.handledByOverride(attr)) {
            return;
        }
        let { name, value } = attr;
        this.buffer += name;
        if (value.type !== 'TextNode' || value.chars.length > 0) {
            this.buffer += '=';
            this.AttrNodeValue(value);
        }
    }
    AttrNodeValue(value) {
        if (value.type === 'TextNode') {
            this.buffer += '"';
            this.TextNode(value, true);
            this.buffer += '"';
        } else {
            this.Node(value);
        }
    }
    TextNode(text, isAttr) {
        if (this.handledByOverride(text)) {
            return;
        }
        if (this.options.entityEncoding === 'raw') {
            this.buffer += text.chars;
        } else if (isAttr) {
            this.buffer += escapeAttrValue(text.chars);
        } else {
            this.buffer += escapeText(text.chars);
        }
    }
    MustacheStatement(mustache) {
        if (this.handledByOverride(mustache)) {
            return;
        }
        this.buffer += mustache.escaped ? '{{' : '{{{';
        if (mustache.strip.open) {
            this.buffer += '~';
        }
        this.Expression(mustache.path);
        this.Params(mustache.params);
        this.Hash(mustache.hash);
        if (mustache.strip.close) {
            this.buffer += '~';
        }
        this.buffer += mustache.escaped ? '}}' : '}}}';
    }
    BlockStatement(block) {
        if (this.handledByOverride(block)) {
            return;
        }
        if (block.chained) {
            this.buffer += block.inverseStrip.open ? '{{~' : '{{';
            this.buffer += 'else ';
        } else {
            this.buffer += block.openStrip.open ? '{{~#' : '{{#';
        }
        this.Expression(block.path);
        this.Params(block.params);
        this.Hash(block.hash);
        if (block.program.blockParams.length) {
            this.BlockParams(block.program.blockParams);
        }
        if (block.chained) {
            this.buffer += block.inverseStrip.close ? '~}}' : '}}';
        } else {
            this.buffer += block.openStrip.close ? '~}}' : '}}';
        }
        this.Block(block.program);
        if (block.inverse) {
            if (!block.inverse.chained) {
                this.buffer += block.inverseStrip.open ? '{{~' : '{{';
                this.buffer += 'else';
                this.buffer += block.inverseStrip.close ? '~}}' : '}}';
            }
            this.Block(block.inverse);
        }
        if (!block.chained) {
            this.buffer += block.closeStrip.open ? '{{~/' : '{{/';
            this.Expression(block.path);
            this.buffer += block.closeStrip.close ? '~}}' : '}}';
        }
    }
    BlockParams(blockParams) {
        this.buffer += ` as |${blockParams.join(' ')}|`;
    }
    PartialStatement(partial) {
        if (this.handledByOverride(partial)) {
            return;
        }
        this.buffer += '{{>';
        this.Expression(partial.name);
        this.Params(partial.params);
        this.Hash(partial.hash);
        this.buffer += '}}';
    }
    ConcatStatement(concat) {
        if (this.handledByOverride(concat)) {
            return;
        }
        this.buffer += '"';
        concat.parts.forEach(part => {
            if (part.type === 'TextNode') {
                this.TextNode(part, true);
            } else {
                this.Node(part);
            }
        });
        this.buffer += '"';
    }
    MustacheCommentStatement(comment) {
        if (this.handledByOverride(comment)) {
            return;
        }
        this.buffer += `{{!--${comment.value}--}}`;
    }
    ElementModifierStatement(mod) {
        if (this.handledByOverride(mod)) {
            return;
        }
        this.buffer += '{{';
        this.Expression(mod.path);
        this.Params(mod.params);
        this.Hash(mod.hash);
        this.buffer += '}}';
    }
    CommentStatement(comment) {
        if (this.handledByOverride(comment)) {
            return;
        }
        this.buffer += `<!--${comment.value}-->`;
    }
    PathExpression(path) {
        if (this.handledByOverride(path)) {
            return;
        }
        this.buffer += path.original;
    }
    SubExpression(sexp) {
        if (this.handledByOverride(sexp)) {
            return;
        }
        this.buffer += '(';
        this.Expression(sexp.path);
        this.Params(sexp.params);
        this.Hash(sexp.hash);
        this.buffer += ')';
    }
    Params(params) {
        // TODO: implement a top level Params AST node (just like the Hash object)
        // so that this can also be overridden
        if (params.length) {
            params.forEach(param => {
                this.buffer += ' ';
                this.Expression(param);
            });
        }
    }
    Hash(hash) {
        if (this.handledByOverride(hash, true)) {
            return;
        }
        hash.pairs.forEach(pair => {
            this.buffer += ' ';
            this.HashPair(pair);
        });
    }
    HashPair(pair) {
        if (this.handledByOverride(pair)) {
            return;
        }
        this.buffer += pair.key;
        this.buffer += '=';
        this.Node(pair.value);
    }
    StringLiteral(str) {
        if (this.handledByOverride(str)) {
            return;
        }
        this.buffer += JSON.stringify(str.value);
    }
    BooleanLiteral(bool) {
        if (this.handledByOverride(bool)) {
            return;
        }
        this.buffer += bool.value;
    }
    NumberLiteral(number) {
        if (this.handledByOverride(number)) {
            return;
        }
        this.buffer += number.value;
    }
    UndefinedLiteral(node) {
        if (this.handledByOverride(node)) {
            return;
        }
        this.buffer += 'undefined';
    }
    NullLiteral(node) {
        if (this.handledByOverride(node)) {
            return;
        }
        this.buffer += 'null';
    }
    print(node) {
        let { options } = this;
        if (options.override) {
            let result = options.override(node, options);
            if (result !== undefined) {
                return result;
            }
        }
        this.buffer = '';
        this.Node(node);
        return this.buffer;
    }
}
function unreachable(node) {
    throw new Error(`Non-exhaustive node narrowing ${node.type}`);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC9saWIvZ2VuZXJhdGlvbi9wcmludGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQTRCQSxTQUFTLE9BQVQsUUFBd0Isb0NBQXhCO0FBQ0EsU0FBUyxVQUFULEVBQXFCLGVBQXJCLFFBQTRDLFFBQTVDO0FBRUEsTUFBTSxpQkFBaUIsSUFBdkI7QUFzQkEsZUFBYyxNQUFPLE9BQVAsQ0FBYztBQUkxQixnQkFBWSxPQUFaLEVBQW1DO0FBSDNCLGFBQUEsTUFBQSxHQUFTLEVBQVQ7QUFJTixhQUFLLE9BQUwsR0FBZSxPQUFmO0FBQ0Q7QUFFRDs7Ozs7Ozs7QUFTQSxzQkFBa0IsSUFBbEIsRUFBOEIsMEJBQTBCLEtBQXhELEVBQTZEO0FBQzNELFlBQUksS0FBSyxPQUFMLENBQWEsUUFBYixLQUEwQixTQUE5QixFQUF5QztBQUN2QyxnQkFBSSxTQUFTLEtBQUssT0FBTCxDQUFhLFFBQWIsQ0FBc0IsSUFBdEIsRUFBNEIsS0FBSyxPQUFqQyxDQUFiO0FBQ0EsZ0JBQUksT0FBTyxNQUFQLEtBQWtCLFFBQXRCLEVBQWdDO0FBQzlCLG9CQUFJLDJCQUEyQixlQUFlLElBQWYsQ0FBb0IsT0FBTyxDQUFQLENBQXBCLENBQS9CLEVBQStEO0FBQzdELDZCQUFTLElBQUksTUFBTSxFQUFuQjtBQUNEO0FBRUQscUJBQUssTUFBTCxJQUFlLE1BQWY7QUFDQSx1QkFBTyxJQUFQO0FBQ0Q7QUFDRjtBQUVELGVBQU8sS0FBUDtBQUNEO0FBRUQsU0FBSyxJQUFMLEVBQWU7QUFDYixnQkFBUSxLQUFLLElBQWI7QUFDRSxpQkFBSyxtQkFBTDtBQUNBLGlCQUFLLGdCQUFMO0FBQ0EsaUJBQUssa0JBQUw7QUFDQSxpQkFBSywwQkFBTDtBQUNBLGlCQUFLLGtCQUFMO0FBQ0EsaUJBQUssVUFBTDtBQUNBLGlCQUFLLGFBQUw7QUFDQSxpQkFBSyxVQUFMO0FBQ0EsaUJBQUssT0FBTDtBQUNBLGlCQUFLLFVBQUw7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LENBQWlCLElBQWpCLEVBQXVCLE9BQXZCLENBQWI7QUFFQSxnQkFBSSxXQUFXLFNBQWYsRUFBMEI7QUFDeEIsdUJBQU8sTUFBUDtBQUNEO0FBQ0Y7QUFFRCxhQUFLLE1BQUwsR0FBYyxFQUFkO0FBQ0EsYUFBSyxJQUFMLENBQVUsSUFBVjtBQUNBLGVBQU8sS0FBSyxNQUFaO0FBQ0Q7QUEvZXlCO0FBa2Y1QixTQUFTLFdBQVQsQ0FBcUIsSUFBckIsRUFBZ0M7QUFDOUIsVUFBTSxJQUFJLEtBQUosQ0FBVSxpQ0FBbUMsS0FBc0IsSUFBSSxFQUF2RSxDQUFOO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBdHRyTm9kZSxcbiAgQmxvY2ssXG4gIEJsb2NrU3RhdGVtZW50LFxuICBFbGVtZW50Tm9kZSxcbiAgTXVzdGFjaGVTdGF0ZW1lbnQsXG4gIE5vZGUsXG4gIFByb2dyYW0sXG4gIFRleHROb2RlLFxuICBQYXJ0aWFsU3RhdGVtZW50LFxuICBDb25jYXRTdGF0ZW1lbnQsXG4gIE11c3RhY2hlQ29tbWVudFN0YXRlbWVudCxcbiAgQ29tbWVudFN0YXRlbWVudCxcbiAgRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50LFxuICBFeHByZXNzaW9uLFxuICBQYXRoRXhwcmVzc2lvbixcbiAgU3ViRXhwcmVzc2lvbixcbiAgSGFzaCxcbiAgSGFzaFBhaXIsXG4gIExpdGVyYWwsXG4gIFN0cmluZ0xpdGVyYWwsXG4gIEJvb2xlYW5MaXRlcmFsLFxuICBOdW1iZXJMaXRlcmFsLFxuICBVbmRlZmluZWRMaXRlcmFsLFxuICBOdWxsTGl0ZXJhbCxcbiAgVG9wTGV2ZWxTdGF0ZW1lbnQsXG4gIFRlbXBsYXRlLFxufSBmcm9tICcuLi90eXBlcy9ub2Rlcyc7XG5pbXBvcnQgeyB2b2lkTWFwIH0gZnJvbSAnLi4vcGFyc2VyL3Rva2VuaXplci1ldmVudC1oYW5kbGVycyc7XG5pbXBvcnQgeyBlc2NhcGVUZXh0LCBlc2NhcGVBdHRyVmFsdWUgfSBmcm9tICcuL3V0aWwnO1xuXG5jb25zdCBOT05fV0hJVEVTUEFDRSA9IC9cXFMvO1xuXG5leHBvcnQgaW50ZXJmYWNlIFByaW50ZXJPcHRpb25zIHtcbiAgZW50aXR5RW5jb2Rpbmc6ICd0cmFuc2Zvcm1lZCcgfCAncmF3JztcblxuICAvKipcbiAgICogVXNlZCB0byBvdmVycmlkZSB0aGUgbWVjaGFuaXNtIG9mIHByaW50aW5nIGEgZ2l2ZW4gQVNULk5vZGUuXG4gICAqXG4gICAqIFRoaXMgd2lsbCBnZW5lcmFsbHkgb25seSBiZSB1c2VmdWwgdG8gc291cmNlIC0+IHNvdXJjZSBjb2RlbW9kc1xuICAgKiB3aGVyZSB5b3Ugd291bGQgbGlrZSB0byBzcGVjaWFsaXplL292ZXJyaWRlIHRoZSB3YXkgYSBnaXZlbiBub2RlIGlzXG4gICAqIHByaW50ZWQgKGUuZy4geW91IHdvdWxkIGxpa2UgdG8gcHJlc2VydmUgYXMgbXVjaCBvZiB0aGUgb3JpZ2luYWxcbiAgICogZm9ybWF0dGluZyBhcyBwb3NzaWJsZSkuXG4gICAqXG4gICAqIFdoZW4gdGhlIHByb3ZpZGVkIG92ZXJyaWRlIHJldHVybnMgdW5kZWZpbmVkLCB0aGUgZGVmYXVsdCBidWlsdCBpbiBwcmludGluZ1xuICAgKiB3aWxsIGJlIGRvbmUgZm9yIHRoZSBBU1QuTm9kZS5cbiAgICpcbiAgICogQHBhcmFtIGFzdCB0aGUgYXN0IG5vZGUgdG8gYmUgcHJpbnRlZFxuICAgKiBAcGFyYW0gb3B0aW9ucyB0aGUgb3B0aW9ucyBzcGVjaWZpZWQgZHVyaW5nIHRoZSBwcmludCgpIGludm9jYXRpb25cbiAgICovXG4gIG92ZXJyaWRlPyhhc3Q6IE5vZGUsIG9wdGlvbnM6IFByaW50ZXJPcHRpb25zKTogdm9pZCB8IHN0cmluZztcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJpbnRlciB7XG4gIHByaXZhdGUgYnVmZmVyID0gJyc7XG4gIHByaXZhdGUgb3B0aW9uczogUHJpbnRlck9wdGlvbnM7XG5cbiAgY29uc3RydWN0b3Iob3B0aW9uczogUHJpbnRlck9wdGlvbnMpIHtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICB9XG5cbiAgLypcbiAgICBUaGlzIGlzIHVzZWQgYnkgX2FsbF8gbWV0aG9kcyBvbiB0aGlzIFByaW50ZXIgY2xhc3MgdGhhdCBhZGQgdG8gYHRoaXMuYnVmZmVyYCxcbiAgICBpdCBhbGxvd3MgY29uc3VtZXJzIG9mIHRoZSBwcmludGVyIHRvIHVzZSBhbHRlcm5hdGUgc3RyaW5nIHJlcHJlc2VudGF0aW9ucyBmb3JcbiAgICBhIGdpdmVuIG5vZGUuXG5cbiAgICBUaGUgcHJpbWFyeSB1c2UgY2FzZSBmb3IgdGhpcyBhcmUgdGhpbmdzIGxpa2Ugc291cmNlIC0+IHNvdXJjZSBjb2RlbW9kIHV0aWxpdGllcy5cbiAgICBGb3IgZXhhbXBsZSwgZW1iZXItdGVtcGxhdGUtcmVjYXN0IGF0dGVtcHRzIHRvIGFsd2F5cyBwcmVzZXJ2ZSB0aGUgb3JpZ2luYWwgc3RyaW5nXG4gICAgZm9ybWF0dGluZyBpbiBlYWNoIEFTVCBub2RlIGlmIG5vIG1vZGlmaWNhdGlvbnMgYXJlIG1hZGUgdG8gaXQuXG4gICovXG4gIGhhbmRsZWRCeU92ZXJyaWRlKG5vZGU6IE5vZGUsIGVuc3VyZUxlYWRpbmdXaGl0ZXNwYWNlID0gZmFsc2UpOiBib29sZWFuIHtcbiAgICBpZiAodGhpcy5vcHRpb25zLm92ZXJyaWRlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGxldCByZXN1bHQgPSB0aGlzLm9wdGlvbnMub3ZlcnJpZGUobm9kZSwgdGhpcy5vcHRpb25zKTtcbiAgICAgIGlmICh0eXBlb2YgcmVzdWx0ID09PSAnc3RyaW5nJykge1xuICAgICAgICBpZiAoZW5zdXJlTGVhZGluZ1doaXRlc3BhY2UgJiYgTk9OX1dISVRFU1BBQ0UudGVzdChyZXN1bHRbMF0pKSB7XG4gICAgICAgICAgcmVzdWx0ID0gYCAke3Jlc3VsdH1gO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5idWZmZXIgKz0gcmVzdWx0O1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBOb2RlKG5vZGU6IE5vZGUpOiB2b2lkIHtcbiAgICBzd2l0Y2ggKG5vZGUudHlwZSkge1xuICAgICAgY2FzZSAnTXVzdGFjaGVTdGF0ZW1lbnQnOlxuICAgICAgY2FzZSAnQmxvY2tTdGF0ZW1lbnQnOlxuICAgICAgY2FzZSAnUGFydGlhbFN0YXRlbWVudCc6XG4gICAgICBjYXNlICdNdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQnOlxuICAgICAgY2FzZSAnQ29tbWVudFN0YXRlbWVudCc6XG4gICAgICBjYXNlICdUZXh0Tm9kZSc6XG4gICAgICBjYXNlICdFbGVtZW50Tm9kZSc6XG4gICAgICBjYXNlICdBdHRyTm9kZSc6XG4gICAgICBjYXNlICdCbG9jayc6XG4gICAgICBjYXNlICdUZW1wbGF0ZSc6XG4gICAgICAgIHJldHVybiB0aGlzLlRvcExldmVsU3RhdGVtZW50KG5vZGUpO1xuICAgICAgY2FzZSAnU3RyaW5nTGl0ZXJhbCc6XG4gICAgICBjYXNlICdCb29sZWFuTGl0ZXJhbCc6XG4gICAgICBjYXNlICdOdW1iZXJMaXRlcmFsJzpcbiAgICAgIGNhc2UgJ1VuZGVmaW5lZExpdGVyYWwnOlxuICAgICAgY2FzZSAnTnVsbExpdGVyYWwnOlxuICAgICAgY2FzZSAnUGF0aEV4cHJlc3Npb24nOlxuICAgICAgY2FzZSAnU3ViRXhwcmVzc2lvbic6XG4gICAgICAgIHJldHVybiB0aGlzLkV4cHJlc3Npb24obm9kZSk7XG4gICAgICBjYXNlICdQcm9ncmFtJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuQmxvY2sobm9kZSk7XG4gICAgICBjYXNlICdDb25jYXRTdGF0ZW1lbnQnOlxuICAgICAgICAvLyBzaG91bGQgaGF2ZSBhbiBBdHRyTm9kZSBwYXJlbnRcbiAgICAgICAgcmV0dXJuIHRoaXMuQ29uY2F0U3RhdGVtZW50KG5vZGUpO1xuICAgICAgY2FzZSAnSGFzaCc6XG4gICAgICAgIHJldHVybiB0aGlzLkhhc2gobm9kZSk7XG4gICAgICBjYXNlICdIYXNoUGFpcic6XG4gICAgICAgIHJldHVybiB0aGlzLkhhc2hQYWlyKG5vZGUpO1xuICAgICAgY2FzZSAnRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50JzpcbiAgICAgICAgcmV0dXJuIHRoaXMuRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50KG5vZGUpO1xuICAgIH1cblxuICAgIHJldHVybiB1bnJlYWNoYWJsZShub2RlKTtcbiAgfVxuXG4gIEV4cHJlc3Npb24oZXhwcmVzc2lvbjogRXhwcmVzc2lvbik6IHZvaWQge1xuICAgIHN3aXRjaCAoZXhwcmVzc2lvbi50eXBlKSB7XG4gICAgICBjYXNlICdTdHJpbmdMaXRlcmFsJzpcbiAgICAgIGNhc2UgJ0Jvb2xlYW5MaXRlcmFsJzpcbiAgICAgIGNhc2UgJ051bWJlckxpdGVyYWwnOlxuICAgICAgY2FzZSAnVW5kZWZpbmVkTGl0ZXJhbCc6XG4gICAgICBjYXNlICdOdWxsTGl0ZXJhbCc6XG4gICAgICAgIHJldHVybiB0aGlzLkxpdGVyYWwoZXhwcmVzc2lvbik7XG4gICAgICBjYXNlICdQYXRoRXhwcmVzc2lvbic6XG4gICAgICAgIHJldHVybiB0aGlzLlBhdGhFeHByZXNzaW9uKGV4cHJlc3Npb24pO1xuICAgICAgY2FzZSAnU3ViRXhwcmVzc2lvbic6XG4gICAgICAgIHJldHVybiB0aGlzLlN1YkV4cHJlc3Npb24oZXhwcmVzc2lvbik7XG4gICAgfVxuICAgIHJldHVybiB1bnJlYWNoYWJsZShleHByZXNzaW9uKTtcbiAgfVxuXG4gIExpdGVyYWwobGl0ZXJhbDogTGl0ZXJhbCkge1xuICAgIHN3aXRjaCAobGl0ZXJhbC50eXBlKSB7XG4gICAgICBjYXNlICdTdHJpbmdMaXRlcmFsJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuU3RyaW5nTGl0ZXJhbChsaXRlcmFsKTtcbiAgICAgIGNhc2UgJ0Jvb2xlYW5MaXRlcmFsJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuQm9vbGVhbkxpdGVyYWwobGl0ZXJhbCk7XG4gICAgICBjYXNlICdOdW1iZXJMaXRlcmFsJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuTnVtYmVyTGl0ZXJhbChsaXRlcmFsKTtcbiAgICAgIGNhc2UgJ1VuZGVmaW5lZExpdGVyYWwnOlxuICAgICAgICByZXR1cm4gdGhpcy5VbmRlZmluZWRMaXRlcmFsKGxpdGVyYWwpO1xuICAgICAgY2FzZSAnTnVsbExpdGVyYWwnOlxuICAgICAgICByZXR1cm4gdGhpcy5OdWxsTGl0ZXJhbChsaXRlcmFsKTtcbiAgICB9XG4gICAgcmV0dXJuIHVucmVhY2hhYmxlKGxpdGVyYWwpO1xuICB9XG5cbiAgVG9wTGV2ZWxTdGF0ZW1lbnQoc3RhdGVtZW50OiBUb3BMZXZlbFN0YXRlbWVudCkge1xuICAgIHN3aXRjaCAoc3RhdGVtZW50LnR5cGUpIHtcbiAgICAgIGNhc2UgJ011c3RhY2hlU3RhdGVtZW50JzpcbiAgICAgICAgcmV0dXJuIHRoaXMuTXVzdGFjaGVTdGF0ZW1lbnQoc3RhdGVtZW50KTtcbiAgICAgIGNhc2UgJ0Jsb2NrU3RhdGVtZW50JzpcbiAgICAgICAgcmV0dXJuIHRoaXMuQmxvY2tTdGF0ZW1lbnQoc3RhdGVtZW50KTtcbiAgICAgIGNhc2UgJ1BhcnRpYWxTdGF0ZW1lbnQnOlxuICAgICAgICByZXR1cm4gdGhpcy5QYXJ0aWFsU3RhdGVtZW50KHN0YXRlbWVudCk7XG4gICAgICBjYXNlICdNdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQnOlxuICAgICAgICByZXR1cm4gdGhpcy5NdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQoc3RhdGVtZW50KTtcbiAgICAgIGNhc2UgJ0NvbW1lbnRTdGF0ZW1lbnQnOlxuICAgICAgICByZXR1cm4gdGhpcy5Db21tZW50U3RhdGVtZW50KHN0YXRlbWVudCk7XG4gICAgICBjYXNlICdUZXh0Tm9kZSc6XG4gICAgICAgIHJldHVybiB0aGlzLlRleHROb2RlKHN0YXRlbWVudCk7XG4gICAgICBjYXNlICdFbGVtZW50Tm9kZSc6XG4gICAgICAgIHJldHVybiB0aGlzLkVsZW1lbnROb2RlKHN0YXRlbWVudCk7XG4gICAgICBjYXNlICdCbG9jayc6XG4gICAgICBjYXNlICdUZW1wbGF0ZSc6XG4gICAgICAgIHJldHVybiB0aGlzLkJsb2NrKHN0YXRlbWVudCk7XG4gICAgICBjYXNlICdBdHRyTm9kZSc6XG4gICAgICAgIC8vIHNob3VsZCBoYXZlIGVsZW1lbnRcbiAgICAgICAgcmV0dXJuIHRoaXMuQXR0ck5vZGUoc3RhdGVtZW50KTtcbiAgICB9XG4gICAgdW5yZWFjaGFibGUoc3RhdGVtZW50KTtcbiAgfVxuXG4gIEJsb2NrKGJsb2NrOiBCbG9jayB8IFByb2dyYW0gfCBUZW1wbGF0ZSk6IHZvaWQge1xuICAgIC8qXG4gICAgICBXaGVuIHByb2Nlc3NpbmcgYSB0ZW1wbGF0ZSBsaWtlOlxuXG4gICAgICBgYGBoYnNcbiAgICAgIHt7I2lmIHdoYXRldmVyfX1cbiAgICAgICAgd2hhdGV2ZXJcbiAgICAgIHt7ZWxzZSBpZiBzb21ldGhpbmdFbHNlfX1cbiAgICAgICAgc29tZXRoaW5nIGVsc2VcbiAgICAgIHt7ZWxzZX19XG4gICAgICAgIGZhbGxiYWNrXG4gICAgICB7ey9pZn19XG4gICAgICBgYGBcblxuICAgICAgVGhlIEFTVCBzdGlsbCBfZWZmZWN0aXZlbHlfIGxvb2tzIGxpa2U6XG5cbiAgICAgIGBgYGhic1xuICAgICAge3sjaWYgd2hhdGV2ZXJ9fVxuICAgICAgICB3aGF0ZXZlclxuICAgICAge3tlbHNlfX17eyNpZiBzb21ldGhpbmdFbHNlfX1cbiAgICAgICAgc29tZXRoaW5nIGVsc2VcbiAgICAgIHt7ZWxzZX19XG4gICAgICAgIGZhbGxiYWNrXG4gICAgICB7ey9pZn19e3svaWZ9fVxuICAgICAgYGBgXG5cbiAgICAgIFRoZSBvbmx5IHdheSB3ZSBjYW4gdGVsbCBpZiB0aGF0IGlzIHRoZSBjYXNlIGlzIGJ5IGNoZWNraW5nIGZvclxuICAgICAgYGJsb2NrLmNoYWluZWRgLCBidXQgdW5mb3J0dW5hdGVseSB3aGVuIHRoZSBhY3R1YWwgc3RhdGVtZW50cyBhcmVcbiAgICAgIHByb2Nlc3NlZCB0aGUgYGJsb2NrLmJvZHlbMF1gIG5vZGUgKHdoaWNoIHdpbGwgYWx3YXlzIGJlIGFcbiAgICAgIGBCbG9ja1N0YXRlbWVudGApIGhhcyBubyBjbHVlIHRoYXQgaXRzIGFuc2Nlc3RvciBgQmxvY2tgIG5vZGUgd2FzXG4gICAgICBjaGFpbmVkLlxuXG4gICAgICBUaGlzIFwiZm9yd2FyZHNcIiB0aGUgYGNoYWluZWRgIHNldHRpbmcgc28gdGhhdCB3ZSBjYW4gY2hlY2tcbiAgICAgIGl0IGxhdGVyIHdoZW4gcHJvY2Vzc2luZyB0aGUgYEJsb2NrU3RhdGVtZW50YC5cbiAgICAqL1xuICAgIGlmIChibG9jay5jaGFpbmVkKSB7XG4gICAgICBsZXQgZmlyc3RDaGlsZCA9IGJsb2NrLmJvZHlbMF0gYXMgQmxvY2tTdGF0ZW1lbnQ7XG4gICAgICBmaXJzdENoaWxkLmNoYWluZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKGJsb2NrKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuVG9wTGV2ZWxTdGF0ZW1lbnRzKGJsb2NrLmJvZHkpO1xuICB9XG5cbiAgVG9wTGV2ZWxTdGF0ZW1lbnRzKHN0YXRlbWVudHM6IFRvcExldmVsU3RhdGVtZW50W10pIHtcbiAgICBzdGF0ZW1lbnRzLmZvckVhY2goc3RhdGVtZW50ID0+IHRoaXMuVG9wTGV2ZWxTdGF0ZW1lbnQoc3RhdGVtZW50KSk7XG4gIH1cblxuICBFbGVtZW50Tm9kZShlbDogRWxlbWVudE5vZGUpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShlbCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLk9wZW5FbGVtZW50Tm9kZShlbCk7XG4gICAgdGhpcy5Ub3BMZXZlbFN0YXRlbWVudHMoZWwuY2hpbGRyZW4pO1xuICAgIHRoaXMuQ2xvc2VFbGVtZW50Tm9kZShlbCk7XG4gIH1cblxuICBPcGVuRWxlbWVudE5vZGUoZWw6IEVsZW1lbnROb2RlKTogdm9pZCB7XG4gICAgdGhpcy5idWZmZXIgKz0gYDwke2VsLnRhZ31gO1xuICAgIGlmIChlbC5hdHRyaWJ1dGVzLmxlbmd0aCkge1xuICAgICAgZWwuYXR0cmlidXRlcy5mb3JFYWNoKGF0dHIgPT4ge1xuICAgICAgICB0aGlzLmJ1ZmZlciArPSAnICc7XG4gICAgICAgIHRoaXMuQXR0ck5vZGUoYXR0cik7XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGVsLm1vZGlmaWVycy5sZW5ndGgpIHtcbiAgICAgIGVsLm1vZGlmaWVycy5mb3JFYWNoKG1vZCA9PiB7XG4gICAgICAgIHRoaXMuYnVmZmVyICs9ICcgJztcbiAgICAgICAgdGhpcy5FbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnQobW9kKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoZWwuY29tbWVudHMubGVuZ3RoKSB7XG4gICAgICBlbC5jb21tZW50cy5mb3JFYWNoKGNvbW1lbnQgPT4ge1xuICAgICAgICB0aGlzLmJ1ZmZlciArPSAnICc7XG4gICAgICAgIHRoaXMuTXVzdGFjaGVDb21tZW50U3RhdGVtZW50KGNvbW1lbnQpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChlbC5ibG9ja1BhcmFtcy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuQmxvY2tQYXJhbXMoZWwuYmxvY2tQYXJhbXMpO1xuICAgIH1cbiAgICBpZiAoZWwuc2VsZkNsb3NpbmcpIHtcbiAgICAgIHRoaXMuYnVmZmVyICs9ICcgLyc7XG4gICAgfVxuICAgIHRoaXMuYnVmZmVyICs9ICc+JztcbiAgfVxuXG4gIENsb3NlRWxlbWVudE5vZGUoZWw6IEVsZW1lbnROb2RlKTogdm9pZCB7XG4gICAgaWYgKGVsLnNlbGZDbG9zaW5nIHx8IHZvaWRNYXBbZWwudGFnLnRvTG93ZXJDYXNlKCldKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuYnVmZmVyICs9IGA8LyR7ZWwudGFnfT5gO1xuICB9XG5cbiAgQXR0ck5vZGUoYXR0cjogQXR0ck5vZGUpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShhdHRyKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCB7IG5hbWUsIHZhbHVlIH0gPSBhdHRyO1xuXG4gICAgdGhpcy5idWZmZXIgKz0gbmFtZTtcbiAgICBpZiAodmFsdWUudHlwZSAhPT0gJ1RleHROb2RlJyB8fCB2YWx1ZS5jaGFycy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSAnPSc7XG4gICAgICB0aGlzLkF0dHJOb2RlVmFsdWUodmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIEF0dHJOb2RlVmFsdWUodmFsdWU6IEF0dHJOb2RlWyd2YWx1ZSddKSB7XG4gICAgaWYgKHZhbHVlLnR5cGUgPT09ICdUZXh0Tm9kZScpIHtcbiAgICAgIHRoaXMuYnVmZmVyICs9ICdcIic7XG4gICAgICB0aGlzLlRleHROb2RlKHZhbHVlLCB0cnVlKTtcbiAgICAgIHRoaXMuYnVmZmVyICs9ICdcIic7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuTm9kZSh2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgVGV4dE5vZGUodGV4dDogVGV4dE5vZGUsIGlzQXR0cj86IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZSh0ZXh0KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm9wdGlvbnMuZW50aXR5RW5jb2RpbmcgPT09ICdyYXcnKSB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSB0ZXh0LmNoYXJzO1xuICAgIH0gZWxzZSBpZiAoaXNBdHRyKSB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSBlc2NhcGVBdHRyVmFsdWUodGV4dC5jaGFycyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYnVmZmVyICs9IGVzY2FwZVRleHQodGV4dC5jaGFycyk7XG4gICAgfVxuICB9XG5cbiAgTXVzdGFjaGVTdGF0ZW1lbnQobXVzdGFjaGU6IE11c3RhY2hlU3RhdGVtZW50KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUobXVzdGFjaGUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gbXVzdGFjaGUuZXNjYXBlZCA/ICd7eycgOiAne3t7JztcblxuICAgIGlmIChtdXN0YWNoZS5zdHJpcC5vcGVuKSB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSAnfic7XG4gICAgfVxuXG4gICAgdGhpcy5FeHByZXNzaW9uKG11c3RhY2hlLnBhdGgpO1xuICAgIHRoaXMuUGFyYW1zKG11c3RhY2hlLnBhcmFtcyk7XG4gICAgdGhpcy5IYXNoKG11c3RhY2hlLmhhc2gpO1xuXG4gICAgaWYgKG11c3RhY2hlLnN0cmlwLmNsb3NlKSB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSAnfic7XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gbXVzdGFjaGUuZXNjYXBlZCA/ICd9fScgOiAnfX19JztcbiAgfVxuXG4gIEJsb2NrU3RhdGVtZW50KGJsb2NrOiBCbG9ja1N0YXRlbWVudCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKGJsb2NrKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChibG9jay5jaGFpbmVkKSB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSBibG9jay5pbnZlcnNlU3RyaXAub3BlbiA/ICd7e34nIDogJ3t7JztcbiAgICAgIHRoaXMuYnVmZmVyICs9ICdlbHNlICc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYnVmZmVyICs9IGJsb2NrLm9wZW5TdHJpcC5vcGVuID8gJ3t7fiMnIDogJ3t7Iyc7XG4gICAgfVxuXG4gICAgdGhpcy5FeHByZXNzaW9uKGJsb2NrLnBhdGgpO1xuICAgIHRoaXMuUGFyYW1zKGJsb2NrLnBhcmFtcyk7XG4gICAgdGhpcy5IYXNoKGJsb2NrLmhhc2gpO1xuICAgIGlmIChibG9jay5wcm9ncmFtLmJsb2NrUGFyYW1zLmxlbmd0aCkge1xuICAgICAgdGhpcy5CbG9ja1BhcmFtcyhibG9jay5wcm9ncmFtLmJsb2NrUGFyYW1zKTtcbiAgICB9XG5cbiAgICBpZiAoYmxvY2suY2hhaW5lZCkge1xuICAgICAgdGhpcy5idWZmZXIgKz0gYmxvY2suaW52ZXJzZVN0cmlwLmNsb3NlID8gJ359fScgOiAnfX0nO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSBibG9jay5vcGVuU3RyaXAuY2xvc2UgPyAnfn19JyA6ICd9fSc7XG4gICAgfVxuXG4gICAgdGhpcy5CbG9jayhibG9jay5wcm9ncmFtKTtcblxuICAgIGlmIChibG9jay5pbnZlcnNlKSB7XG4gICAgICBpZiAoIWJsb2NrLmludmVyc2UuY2hhaW5lZCkge1xuICAgICAgICB0aGlzLmJ1ZmZlciArPSBibG9jay5pbnZlcnNlU3RyaXAub3BlbiA/ICd7e34nIDogJ3t7JztcbiAgICAgICAgdGhpcy5idWZmZXIgKz0gJ2Vsc2UnO1xuICAgICAgICB0aGlzLmJ1ZmZlciArPSBibG9jay5pbnZlcnNlU3RyaXAuY2xvc2UgPyAnfn19JyA6ICd9fSc7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuQmxvY2soYmxvY2suaW52ZXJzZSk7XG4gICAgfVxuXG4gICAgaWYgKCFibG9jay5jaGFpbmVkKSB7XG4gICAgICB0aGlzLmJ1ZmZlciArPSBibG9jay5jbG9zZVN0cmlwLm9wZW4gPyAne3t+LycgOiAne3svJztcbiAgICAgIHRoaXMuRXhwcmVzc2lvbihibG9jay5wYXRoKTtcbiAgICAgIHRoaXMuYnVmZmVyICs9IGJsb2NrLmNsb3NlU3RyaXAuY2xvc2UgPyAnfn19JyA6ICd9fSc7XG4gICAgfVxuICB9XG5cbiAgQmxvY2tQYXJhbXMoYmxvY2tQYXJhbXM6IHN0cmluZ1tdKSB7XG4gICAgdGhpcy5idWZmZXIgKz0gYCBhcyB8JHtibG9ja1BhcmFtcy5qb2luKCcgJyl9fGA7XG4gIH1cblxuICBQYXJ0aWFsU3RhdGVtZW50KHBhcnRpYWw6IFBhcnRpYWxTdGF0ZW1lbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShwYXJ0aWFsKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9ICd7ez4nO1xuICAgIHRoaXMuRXhwcmVzc2lvbihwYXJ0aWFsLm5hbWUpO1xuICAgIHRoaXMuUGFyYW1zKHBhcnRpYWwucGFyYW1zKTtcbiAgICB0aGlzLkhhc2gocGFydGlhbC5oYXNoKTtcbiAgICB0aGlzLmJ1ZmZlciArPSAnfX0nO1xuICB9XG5cbiAgQ29uY2F0U3RhdGVtZW50KGNvbmNhdDogQ29uY2F0U3RhdGVtZW50KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUoY29uY2F0KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9ICdcIic7XG4gICAgY29uY2F0LnBhcnRzLmZvckVhY2gocGFydCA9PiB7XG4gICAgICBpZiAocGFydC50eXBlID09PSAnVGV4dE5vZGUnKSB7XG4gICAgICAgIHRoaXMuVGV4dE5vZGUocGFydCwgdHJ1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLk5vZGUocGFydCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5idWZmZXIgKz0gJ1wiJztcbiAgfVxuXG4gIE11c3RhY2hlQ29tbWVudFN0YXRlbWVudChjb21tZW50OiBNdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShjb21tZW50KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9IGB7eyEtLSR7Y29tbWVudC52YWx1ZX0tLX19YDtcbiAgfVxuXG4gIEVsZW1lbnRNb2RpZmllclN0YXRlbWVudChtb2Q6IEVsZW1lbnRNb2RpZmllclN0YXRlbWVudCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKG1vZCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSAne3snO1xuICAgIHRoaXMuRXhwcmVzc2lvbihtb2QucGF0aCk7XG4gICAgdGhpcy5QYXJhbXMobW9kLnBhcmFtcyk7XG4gICAgdGhpcy5IYXNoKG1vZC5oYXNoKTtcbiAgICB0aGlzLmJ1ZmZlciArPSAnfX0nO1xuICB9XG5cbiAgQ29tbWVudFN0YXRlbWVudChjb21tZW50OiBDb21tZW50U3RhdGVtZW50KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUoY29tbWVudCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSBgPCEtLSR7Y29tbWVudC52YWx1ZX0tLT5gO1xuICB9XG5cbiAgUGF0aEV4cHJlc3Npb24ocGF0aDogUGF0aEV4cHJlc3Npb24pOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShwYXRoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9IHBhdGgub3JpZ2luYWw7XG4gIH1cblxuICBTdWJFeHByZXNzaW9uKHNleHA6IFN1YkV4cHJlc3Npb24pOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShzZXhwKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYnVmZmVyICs9ICcoJztcbiAgICB0aGlzLkV4cHJlc3Npb24oc2V4cC5wYXRoKTtcbiAgICB0aGlzLlBhcmFtcyhzZXhwLnBhcmFtcyk7XG4gICAgdGhpcy5IYXNoKHNleHAuaGFzaCk7XG4gICAgdGhpcy5idWZmZXIgKz0gJyknO1xuICB9XG5cbiAgUGFyYW1zKHBhcmFtczogRXhwcmVzc2lvbltdKSB7XG4gICAgLy8gVE9ETzogaW1wbGVtZW50IGEgdG9wIGxldmVsIFBhcmFtcyBBU1Qgbm9kZSAoanVzdCBsaWtlIHRoZSBIYXNoIG9iamVjdClcbiAgICAvLyBzbyB0aGF0IHRoaXMgY2FuIGFsc28gYmUgb3ZlcnJpZGRlblxuICAgIGlmIChwYXJhbXMubGVuZ3RoKSB7XG4gICAgICBwYXJhbXMuZm9yRWFjaChwYXJhbSA9PiB7XG4gICAgICAgIHRoaXMuYnVmZmVyICs9ICcgJztcbiAgICAgICAgdGhpcy5FeHByZXNzaW9uKHBhcmFtKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIEhhc2goaGFzaDogSGFzaCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhbmRsZWRCeU92ZXJyaWRlKGhhc2gsIHRydWUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaGFzaC5wYWlycy5mb3JFYWNoKHBhaXIgPT4ge1xuICAgICAgdGhpcy5idWZmZXIgKz0gJyAnO1xuICAgICAgdGhpcy5IYXNoUGFpcihwYWlyKTtcbiAgICB9KTtcbiAgfVxuXG4gIEhhc2hQYWlyKHBhaXI6IEhhc2hQYWlyKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUocGFpcikpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSBwYWlyLmtleTtcbiAgICB0aGlzLmJ1ZmZlciArPSAnPSc7XG4gICAgdGhpcy5Ob2RlKHBhaXIudmFsdWUpO1xuICB9XG5cbiAgU3RyaW5nTGl0ZXJhbChzdHI6IFN0cmluZ0xpdGVyYWwpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShzdHIpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gSlNPTi5zdHJpbmdpZnkoc3RyLnZhbHVlKTtcbiAgfVxuXG4gIEJvb2xlYW5MaXRlcmFsKGJvb2w6IEJvb2xlYW5MaXRlcmFsKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUoYm9vbCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSBib29sLnZhbHVlO1xuICB9XG5cbiAgTnVtYmVyTGl0ZXJhbChudW1iZXI6IE51bWJlckxpdGVyYWwpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5oYW5kbGVkQnlPdmVycmlkZShudW1iZXIpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgKz0gbnVtYmVyLnZhbHVlO1xuICB9XG5cbiAgVW5kZWZpbmVkTGl0ZXJhbChub2RlOiBVbmRlZmluZWRMaXRlcmFsKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUobm9kZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSAndW5kZWZpbmVkJztcbiAgfVxuXG4gIE51bGxMaXRlcmFsKG5vZGU6IE51bGxMaXRlcmFsKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaGFuZGxlZEJ5T3ZlcnJpZGUobm9kZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmJ1ZmZlciArPSAnbnVsbCc7XG4gIH1cblxuICBwcmludChub2RlOiBOb2RlKSB7XG4gICAgbGV0IHsgb3B0aW9ucyB9ID0gdGhpcztcblxuICAgIGlmIChvcHRpb25zLm92ZXJyaWRlKSB7XG4gICAgICBsZXQgcmVzdWx0ID0gb3B0aW9ucy5vdmVycmlkZShub2RlLCBvcHRpb25zKTtcblxuICAgICAgaWYgKHJlc3VsdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5idWZmZXIgPSAnJztcbiAgICB0aGlzLk5vZGUobm9kZSk7XG4gICAgcmV0dXJuIHRoaXMuYnVmZmVyO1xuICB9XG59XG5cbmZ1bmN0aW9uIHVucmVhY2hhYmxlKG5vZGU6IG5ldmVyKTogbmV2ZXIge1xuICB0aHJvdyBuZXcgRXJyb3IoYE5vbi1leGhhdXN0aXZlIG5vZGUgbmFycm93aW5nICR7KChub2RlIGFzIGFueSkgYXMgTm9kZSkudHlwZX1gKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=