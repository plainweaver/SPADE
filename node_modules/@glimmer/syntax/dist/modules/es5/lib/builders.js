import { deprecate, assign } from '@glimmer/util';

function buildMustache(path, params, hash, raw, loc, strip) {
    if (typeof path === 'string') {
        path = buildHead(path);
    }
    return {
        type: 'MustacheStatement',
        path: path,
        params: params || [],
        hash: hash || buildHash([]),
        escaped: !raw,
        loc: buildLoc(loc || null),
        strip: strip || { open: false, close: false }
    };
}
function buildBlock(path, params, hash, _defaultBlock, _elseBlock, loc, openStrip, inverseStrip, closeStrip) {
    var defaultBlock = void 0;
    var elseBlock = void 0;
    if (_defaultBlock.type === 'Template') {
        if (false) {
            false && !false && deprecate('b.program is deprecated. Use b.blockItself instead.');
        }
        defaultBlock = assign({}, _defaultBlock, { type: 'Block' });
    } else {
        defaultBlock = _defaultBlock;
    }
    if (_elseBlock !== undefined && _elseBlock !== null && _elseBlock.type === 'Template') {
        if (false) {
            false && !false && deprecate('b.program is deprecated. Use b.blockItself instead.');
        }
        elseBlock = assign({}, _elseBlock, { type: 'Block' });
    } else {
        elseBlock = _elseBlock;
    }
    return {
        type: 'BlockStatement',
        path: buildHead(path),
        params: params || [],
        hash: hash || buildHash([]),
        program: defaultBlock || null,
        inverse: elseBlock || null,
        loc: buildLoc(loc || null),
        openStrip: openStrip || { open: false, close: false },
        inverseStrip: inverseStrip || { open: false, close: false },
        closeStrip: closeStrip || { open: false, close: false }
    };
}
function buildElementModifier(path, params, hash, loc) {
    return {
        type: 'ElementModifierStatement',
        path: buildHead(path),
        params: params || [],
        hash: hash || buildHash([]),
        loc: buildLoc(loc || null)
    };
}
function buildPartial(name, params, hash, indent, loc) {
    return {
        type: 'PartialStatement',
        name: name,
        params: params || [],
        hash: hash || buildHash([]),
        indent: indent || '',
        strip: { open: false, close: false },
        loc: buildLoc(loc || null)
    };
}
function buildComment(value, loc) {
    return {
        type: 'CommentStatement',
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildMustacheComment(value, loc) {
    return {
        type: 'MustacheCommentStatement',
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildConcat(parts, loc) {
    return {
        type: 'ConcatStatement',
        parts: parts || [],
        loc: buildLoc(loc || null)
    };
}
export function isLocSexp(value) {
    return Array.isArray(value) && value.length === 2 && value[0] === 'loc';
}
export function isParamsSexp(value) {
    return Array.isArray(value) && !isLocSexp(value);
}
export function isHashSexp(value) {
    if (typeof value === 'object' && value && !Array.isArray(value)) {
        expectType(value);
        return true;
    } else {
        return false;
    }
}
function expectType(_input) {
    return;
}
export function normalizeModifier(sexp) {
    if (typeof sexp === 'string') {
        return buildElementModifier(sexp);
    }
    var path = normalizeHead(sexp[0]);
    var params = void 0;
    var hash = void 0;
    var loc = null;
    var parts = sexp.slice(1);
    var next = parts.shift();
    _process: {
        if (isParamsSexp(next)) {
            params = next;
        } else {
            break _process;
        }
        next = parts.shift();
        if (isHashSexp(next)) {
            hash = normalizeHash(next);
        } else {
            break _process;
        }
    }
    if (isLocSexp(next)) {
        loc = next[1];
    }
    return {
        type: 'ElementModifierStatement',
        path: path,
        params: params || [],
        hash: hash || buildHash([]),
        loc: buildLoc(loc || null)
    };
}
export function normalizeAttr(sexp) {
    var name = sexp[0];
    var value = void 0;
    if (typeof sexp[1] === 'string') {
        value = buildText(sexp[1]);
    } else {
        value = sexp[1];
    }
    var loc = sexp[2] ? sexp[2][1] : undefined;
    return buildAttr(name, value, loc);
}
export function normalizeHash(hash, loc) {
    var pairs = [];
    Object.keys(hash).forEach(function (key) {
        pairs.push(buildPair(key, hash[key]));
    });
    return buildHash(pairs, loc);
}
export function normalizeHead(path) {
    if (typeof path === 'string') {
        return buildHead(path);
    } else {
        return buildHead(path[1], path[2] && path[2][1]);
    }
}
export function normalizeElementOptions() {
    var out = {};

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
    }

    for (var _iterator = args, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
        var _ref;

        if (_isArray) {
            if (_i >= _iterator.length) break;
            _ref = _iterator[_i++];
        } else {
            _i = _iterator.next();
            if (_i.done) break;
            _ref = _i.value;
        }

        var arg = _ref;

        switch (arg[0]) {
            case 'attrs':
                {
                    var rest = arg.slice(1);

                    out.attrs = rest.map(normalizeAttr);
                    break;
                }
            case 'modifiers':
                {
                    var _rest = arg.slice(1);

                    out.modifiers = _rest.map(normalizeModifier);
                    break;
                }
            case 'body':
                {
                    var _rest2 = arg.slice(1);

                    out.children = _rest2;
                    break;
                }
            case 'comments':
                {
                    var _rest3 = arg.slice(1);

                    out.comments = _rest3;
                    break;
                }
            case 'as':
                {
                    var _rest4 = arg.slice(1);

                    out.blockParams = _rest4;
                    break;
                }
            case 'loc':
                {
                    var _rest5 = arg[1];

                    out.loc = _rest5;
                    break;
                }
        }
    }
    return out;
}
function buildElement(tag, options) {
    var normalized = void 0;
    if (Array.isArray(options)) {
        for (var _len2 = arguments.length, rest = Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {
            rest[_key2 - 2] = arguments[_key2];
        }

        normalized = normalizeElementOptions.apply(undefined, [options].concat(rest));
    } else {
        normalized = options || {};
    }
    var _normalized = normalized,
        attrs = _normalized.attrs,
        blockParams = _normalized.blockParams,
        modifiers = _normalized.modifiers,
        comments = _normalized.comments,
        children = _normalized.children,
        loc = _normalized.loc;
    // this is used for backwards compat, prior to `selfClosing` being part of the ElementNode AST

    var selfClosing = false;
    if (typeof tag === 'object') {
        selfClosing = tag.selfClosing;
        tag = tag.name;
    } else {
        if (tag.slice(-1) === '/') {
            tag = tag.slice(0, -1);
            selfClosing = true;
        }
    }
    return {
        type: 'ElementNode',
        tag: tag || '',
        selfClosing: selfClosing,
        attributes: attrs || [],
        blockParams: blockParams || [],
        modifiers: modifiers || [],
        comments: comments || [],
        children: children || [],
        loc: buildLoc(loc || null)
    };
}
function buildAttr(name, value, loc) {
    return {
        type: 'AttrNode',
        name: name,
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildText(chars, loc) {
    return {
        type: 'TextNode',
        chars: chars || '',
        loc: buildLoc(loc || null)
    };
}
// Expressions
function buildSexpr(path, params, hash, loc) {
    return {
        type: 'SubExpression',
        path: buildHead(path),
        params: params || [],
        hash: hash || buildHash([]),
        loc: buildLoc(loc || null)
    };
}
function buildHead(original, loc) {
    if (typeof original !== 'string') return original;
    var parts = original.split('.');
    var thisHead = false;
    if (parts[0] === 'this') {
        thisHead = true;
        parts = parts.slice(1);
    }
    return {
        type: 'PathExpression',
        original: original,
        this: thisHead,
        parts: parts,
        data: false,
        loc: buildLoc(loc || null)
    };
}
function buildLiteral(type, value, loc) {
    return {
        type: type,
        value: value,
        original: value,
        loc: buildLoc(loc || null)
    };
}
// Miscellaneous
function buildHash(pairs, loc) {
    return {
        type: 'Hash',
        pairs: pairs || [],
        loc: buildLoc(loc || null)
    };
}
function buildPair(key, value, loc) {
    return {
        type: 'HashPair',
        key: key,
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildProgram(body, blockParams, loc) {
    return {
        type: 'Template',
        body: body || [],
        blockParams: blockParams || [],
        loc: buildLoc(loc || null)
    };
}
function buildBlockItself(body, blockParams) {
    var chained = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    var loc = arguments[3];

    return {
        type: 'Block',
        body: body || [],
        blockParams: blockParams || [],
        chained: chained,
        loc: buildLoc(loc || null)
    };
}
function buildTemplate(body, blockParams, loc) {
    return {
        type: 'Template',
        body: body || [],
        blockParams: blockParams || [],
        loc: buildLoc(loc || null)
    };
}
function buildSource(source) {
    return source || null;
}
function buildPosition(line, column) {
    return {
        line: line,
        column: column
    };
}
export var SYNTHETIC = {
    source: '(synthetic)',
    start: { line: 1, column: 0 },
    end: { line: 1, column: 0 }
};
function buildLoc() {
    for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
        args[_key3] = arguments[_key3];
    }

    if (args.length === 1) {
        var loc = args[0];
        if (loc && typeof loc === 'object') {
            return {
                source: buildSource(loc.source),
                start: buildPosition(loc.start.line, loc.start.column),
                end: buildPosition(loc.end.line, loc.end.column)
            };
        } else {
            return SYNTHETIC;
        }
    } else {
        var startLine = args[0],
            startColumn = args[1],
            endLine = args[2],
            endColumn = args[3],
            source = args[4];

        return {
            source: buildSource(source),
            start: buildPosition(startLine, startColumn),
            end: buildPosition(endLine, endColumn)
        };
    }
}
export default {
    mustache: buildMustache,
    block: buildBlock,
    partial: buildPartial,
    comment: buildComment,
    mustacheComment: buildMustacheComment,
    element: buildElement,
    elementModifier: buildElementModifier,
    attr: buildAttr,
    text: buildText,
    sexpr: buildSexpr,
    path: buildHead,
    concat: buildConcat,
    hash: buildHash,
    pair: buildPair,
    literal: buildLiteral,
    program: buildProgram,
    blockItself: buildBlockItself,
    template: buildTemplate,
    loc: buildLoc,
    pos: buildPosition,
    string: literal('StringLiteral'),
    boolean: literal('BooleanLiteral'),
    number: literal('NumberLiteral'),
    undefined: function (_undefined) {
        function undefined() {
            return _undefined.apply(this, arguments);
        }

        undefined.toString = function () {
            return _undefined.toString();
        };

        return undefined;
    }(function () {
        return buildLiteral('UndefinedLiteral', undefined);
    }),
    null: function _null() {
        return buildLiteral('NullLiteral', null);
    }
};
function literal(type) {
    return function (value) {
        return buildLiteral(type, value);
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC9saWIvYnVpbGRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsU0FBQSxTQUFBLEVBQUEsTUFBQSxRQUFBLGVBQUE7O0FBU0EsU0FBQSxhQUFBLENBQUEsSUFBQSxFQUFBLE1BQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEVBTXdCO0FBRXRCLFFBQUksT0FBQSxJQUFBLEtBQUosUUFBQSxFQUE4QjtBQUM1QixlQUFPLFVBQVAsSUFBTyxDQUFQO0FBQ0Q7QUFFRCxXQUFPO0FBQ0wsY0FESyxtQkFBQTtBQUFBLGtCQUFBO0FBR0wsZ0JBQVEsVUFISCxFQUFBO0FBSUwsY0FBTSxRQUFRLFVBSlQsRUFJUyxDQUpUO0FBS0wsaUJBQVMsQ0FMSixHQUFBO0FBTUwsYUFBSyxTQUFTLE9BTlQsSUFNQSxDQU5BO0FBT0wsZUFBTyxTQUFTLEVBQUUsTUFBRixLQUFBLEVBQWUsT0FBZixLQUFBO0FBUFgsS0FBUDtBQVNEO0FBRUQsU0FBQSxVQUFBLENBQUEsSUFBQSxFQUFBLE1BQUEsRUFBQSxJQUFBLEVBQUEsYUFBQSxFQUFBLFVBQUEsRUFBQSxHQUFBLEVBQUEsU0FBQSxFQUFBLFlBQUEsRUFBQSxVQUFBLEVBUzZCO0FBRTNCLFFBQUEscUJBQUE7QUFDQSxRQUFBLGtCQUFBO0FBRUEsUUFBSSxjQUFBLElBQUEsS0FBSixVQUFBLEVBQXVDO0FBQ3JDLFlBQUEsS0FBQSxFQUFhO0FBQUEscUJBQUEsQ0FBQSxLQUFBLElBQUEsZ0VBQUE7QUFFWjtBQUVELHVCQUFnQixPQUFBLEVBQUEsRUFBQSxhQUFBLEVBQTBCLEVBQUUsTUFBNUMsT0FBMEMsRUFBMUIsQ0FBaEI7QUFMRixLQUFBLE1BTU87QUFDTCx1QkFBQSxhQUFBO0FBQ0Q7QUFFRCxRQUFJLGVBQUEsU0FBQSxJQUE0QixlQUE1QixJQUFBLElBQW1ELFdBQUEsSUFBQSxLQUF2RCxVQUFBLEVBQXVGO0FB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QU8sYUFBQSxrQkFBQSxFQUFQLFNBQU8sQ0FBUDtBQTFCVyxLQUFBO0FBNEJiLFFBNUJhLG1CQTRCVDtBQUNGLGVBQU8sYUFBQSxhQUFBLEVBQVAsSUFBTyxDQUFQO0FBQ0Q7QUE5QlksQ0FBZjtBQW1DQSxTQUFBLE9BQUEsQ0FBQSxJQUFBLEVBQXVEO0FBQ3JELFdBQU8sVUFBQSxLQUFBLEVBQTBCO0FBQy9CLGVBQU8sYUFBQSxJQUFBLEVBQVAsS0FBTyxDQUFQO0FBREYsS0FBQTtBQUdEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgQVNUIGZyb20gJy4vdHlwZXMvbm9kZXMnO1xuaW1wb3J0IHsgT3B0aW9uLCBEaWN0IH0gZnJvbSAnQGdsaW1tZXIvaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBkZXByZWNhdGUsIGFzc2lnbiB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuaW1wb3J0IHsgREVWTU9ERSB9IGZyb20gJ0BnbGltbWVyL2xvY2FsLWRlYnVnLWZsYWdzJztcbmltcG9ydCB7IFN0cmluZ0xpdGVyYWwsIEJvb2xlYW5MaXRlcmFsLCBOdW1iZXJMaXRlcmFsIH0gZnJvbSAnLi90eXBlcy9oYW5kbGViYXJzLWFzdCc7XG5cbi8vIFN0YXRlbWVudHNcblxuZXhwb3J0IHR5cGUgQnVpbGRlckhlYWQgPSBzdHJpbmcgfCBBU1QuRXhwcmVzc2lvbjtcbmV4cG9ydCB0eXBlIFRhZ0Rlc2NyaXB0b3IgPSBzdHJpbmcgfCB7IG5hbWU6IHN0cmluZzsgc2VsZkNsb3Npbmc6IGJvb2xlYW4gfTtcblxuZnVuY3Rpb24gYnVpbGRNdXN0YWNoZShcbiAgcGF0aDogQnVpbGRlckhlYWQgfCBBU1QuTGl0ZXJhbCxcbiAgcGFyYW1zPzogQVNULkV4cHJlc3Npb25bXSxcbiAgaGFzaD86IEFTVC5IYXNoLFxuICByYXc/OiBib29sZWFuLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24sXG4gIHN0cmlwPzogQVNULlN0cmlwRmxhZ3Ncbik6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCB7XG4gIGlmICh0eXBlb2YgcGF0aCA9PT0gJ3N0cmluZycpIHtcbiAgICBwYXRoID0gYnVpbGRIZWFkKHBhdGgpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnTXVzdGFjaGVTdGF0ZW1lbnQnLFxuICAgIHBhdGgsXG4gICAgcGFyYW1zOiBwYXJhbXMgfHwgW10sXG4gICAgaGFzaDogaGFzaCB8fCBidWlsZEhhc2goW10pLFxuICAgIGVzY2FwZWQ6ICFyYXcsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gICAgc3RyaXA6IHN0cmlwIHx8IHsgb3BlbjogZmFsc2UsIGNsb3NlOiBmYWxzZSB9LFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZEJsb2NrKFxuICBwYXRoOiBCdWlsZGVySGVhZCxcbiAgcGFyYW1zOiBPcHRpb248QVNULkV4cHJlc3Npb25bXT4sXG4gIGhhc2g6IE9wdGlvbjxBU1QuSGFzaD4sXG4gIF9kZWZhdWx0QmxvY2s6IEFTVC5Qb3NzaWJseURlcHJlY2F0ZWRCbG9jayxcbiAgX2Vsc2VCbG9jaz86IE9wdGlvbjxBU1QuUG9zc2libHlEZXByZWNhdGVkQmxvY2s+LFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24sXG4gIG9wZW5TdHJpcD86IEFTVC5TdHJpcEZsYWdzLFxuICBpbnZlcnNlU3RyaXA/OiBBU1QuU3RyaXBGbGFncyxcbiAgY2xvc2VTdHJpcD86IEFTVC5TdHJpcEZsYWdzXG4pOiBBU1QuQmxvY2tTdGF0ZW1lbnQge1xuICBsZXQgZGVmYXVsdEJsb2NrOiBBU1QuQmxvY2s7XG4gIGxldCBlbHNlQmxvY2s6IE9wdGlvbjxBU1QuQmxvY2s+IHwgdW5kZWZpbmVkO1xuXG4gIGlmIChfZGVmYXVsdEJsb2NrLnR5cGUgPT09ICdUZW1wbGF0ZScpIHtcbiAgICBpZiAoREVWTU9ERSkge1xuICAgICAgZGVwcmVjYXRlKGBiLnByb2dyYW0gaXMgZGVwcmVjYXRlZC4gVXNlIGIuYmxvY2tJdHNlbGYgaW5zdGVhZC5gKTtcbiAgICB9XG5cbiAgICBkZWZhdWx0QmxvY2sgPSAoYXNzaWduKHt9LCBfZGVmYXVsdEJsb2NrLCB7IHR5cGU6ICdCbG9jaycgfSkgYXMgdW5rbm93bikgYXMgQVNULkJsb2NrO1xuICB9IGVsc2Uge1xuICAgIGRlZmF1bHRCbG9jayA9IF9kZWZhdWx0QmxvY2s7XG4gIH1cblxuICBpZiAoX2Vsc2VCbG9jayAhPT0gdW5kZWZpbmVkICYmIF9lbHNlQmxvY2sgIT09IG51bGwgJiYgX2Vsc2VCbG9jay50eXBlID09PSAnVGVtcGxhdGUnKSB7XG4gICAgaWYgKERFVk1PREUpIHtcbiAgICAgIGRlcHJlY2F0ZShgYi5wcm9ncmFtIGlzIGRlcHJlY2F0ZWQuIFVzZSBiLmJsb2NrSXRzZWxmIGluc3RlYWQuYCk7XG4gICAgfVxuXG4gICAgZWxzZUJsb2NrID0gKGFzc2lnbih7fSwgX2Vsc2VCbG9jaywgeyB0eXBlOiAnQmxvY2snIH0pIGFzIHVua25vd24pIGFzIEFTVC5CbG9jaztcbiAgfSBlbHNlIHtcbiAgICBlbHNlQmxvY2sgPSBfZWxzZUJsb2NrO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnQmxvY2tTdGF0ZW1lbnQnLFxuICAgIHBhdGg6IGJ1aWxkSGVhZChwYXRoKSxcbiAgICBwYXJhbXM6IHBhcmFtcyB8fCBbXSxcbiAgICBoYXNoOiBoYXNoIHx8IGJ1aWxkSGFzaChbXSksXG4gICAgcHJvZ3JhbTogZGVmYXVsdEJsb2NrIHx8IG51bGwsXG4gICAgaW52ZXJzZTogZWxzZUJsb2NrIHx8IG51bGwsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gICAgb3BlblN0cmlwOiBvcGVuU3RyaXAgfHwgeyBvcGVuOiBmYWxzZSwgY2xvc2U6IGZhbHNlIH0sXG4gICAgaW52ZXJzZVN0cmlwOiBpbnZlcnNlU3RyaXAgfHwgeyBvcGVuOiBmYWxzZSwgY2xvc2U6IGZhbHNlIH0sXG4gICAgY2xvc2VTdHJpcDogY2xvc2VTdHJpcCB8fCB7IG9wZW46IGZhbHNlLCBjbG9zZTogZmFsc2UgfSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRFbGVtZW50TW9kaWZpZXIoXG4gIHBhdGg6IEJ1aWxkZXJIZWFkLFxuICBwYXJhbXM/OiBBU1QuRXhwcmVzc2lvbltdLFxuICBoYXNoPzogQVNULkhhc2gsXG4gIGxvYz86IE9wdGlvbjxBU1QuU291cmNlTG9jYXRpb24+XG4pOiBBU1QuRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50IHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50JyxcbiAgICBwYXRoOiBidWlsZEhlYWQocGF0aCksXG4gICAgcGFyYW1zOiBwYXJhbXMgfHwgW10sXG4gICAgaGFzaDogaGFzaCB8fCBidWlsZEhhc2goW10pLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFBhcnRpYWwoXG4gIG5hbWU6IEFTVC5QYXRoRXhwcmVzc2lvbixcbiAgcGFyYW1zPzogQVNULkV4cHJlc3Npb25bXSxcbiAgaGFzaD86IEFTVC5IYXNoLFxuICBpbmRlbnQ/OiBzdHJpbmcsXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULlBhcnRpYWxTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdQYXJ0aWFsU3RhdGVtZW50JyxcbiAgICBuYW1lOiBuYW1lLFxuICAgIHBhcmFtczogcGFyYW1zIHx8IFtdLFxuICAgIGhhc2g6IGhhc2ggfHwgYnVpbGRIYXNoKFtdKSxcbiAgICBpbmRlbnQ6IGluZGVudCB8fCAnJyxcbiAgICBzdHJpcDogeyBvcGVuOiBmYWxzZSwgY2xvc2U6IGZhbHNlIH0sXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQ29tbWVudCh2YWx1ZTogc3RyaW5nLCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuQ29tbWVudFN0YXRlbWVudCB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0NvbW1lbnRTdGF0ZW1lbnQnLFxuICAgIHZhbHVlOiB2YWx1ZSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRNdXN0YWNoZUNvbW1lbnQoXG4gIHZhbHVlOiBzdHJpbmcsXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULk11c3RhY2hlQ29tbWVudFN0YXRlbWVudCB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ011c3RhY2hlQ29tbWVudFN0YXRlbWVudCcsXG4gICAgdmFsdWU6IHZhbHVlLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZENvbmNhdChcbiAgcGFydHM6IChBU1QuVGV4dE5vZGUgfCBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpW10sXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULkNvbmNhdFN0YXRlbWVudCB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0NvbmNhdFN0YXRlbWVudCcsXG4gICAgcGFydHM6IHBhcnRzIHx8IFtdLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG4vLyBOb2Rlc1xuXG5leHBvcnQgdHlwZSBFbGVtZW50QXJncyA9XG4gIHwgWydhdHRycycsIC4uLkF0dHJTZXhwW11dXG4gIHwgWydtb2RpZmllcnMnLCAuLi5Nb2RpZmllclNleHBbXV1cbiAgfCBbJ2JvZHknLCAuLi5BU1QuU3RhdGVtZW50W11dXG4gIHwgWydjb21tZW50cycsIC4uLkVsZW1lbnRDb21tZW50W11dXG4gIHwgWydhcycsIC4uLnN0cmluZ1tdXVxuICB8IFsnbG9jJywgQVNULlNvdXJjZUxvY2F0aW9uXTtcblxuZXhwb3J0IHR5cGUgUGF0aFNleHAgPSBzdHJpbmcgfCBbJ3BhdGgnLCBzdHJpbmcsIExvY1NleHA/XTtcblxuZXhwb3J0IHR5cGUgTW9kaWZpZXJTZXhwID1cbiAgfCBzdHJpbmdcbiAgfCBbUGF0aFNleHAsIExvY1NleHA/XVxuICB8IFtQYXRoU2V4cCwgQVNULkV4cHJlc3Npb25bXSwgTG9jU2V4cD9dXG4gIHwgW1BhdGhTZXhwLCBBU1QuRXhwcmVzc2lvbltdLCBEaWN0PEFTVC5FeHByZXNzaW9uPiwgTG9jU2V4cD9dO1xuXG5leHBvcnQgdHlwZSBBdHRyU2V4cCA9IFtzdHJpbmcsIEFTVC5BdHRyTm9kZVsndmFsdWUnXSB8IHN0cmluZywgTG9jU2V4cD9dO1xuXG5leHBvcnQgdHlwZSBMb2NTZXhwID0gWydsb2MnLCBBU1QuU291cmNlTG9jYXRpb25dO1xuXG5leHBvcnQgdHlwZSBFbGVtZW50Q29tbWVudCA9IEFTVC5NdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQgfCBBU1QuU291cmNlTG9jYXRpb24gfCBzdHJpbmc7XG5cbmV4cG9ydCB0eXBlIFNleHBWYWx1ZSA9XG4gIHwgc3RyaW5nXG4gIHwgQVNULkV4cHJlc3Npb25bXVxuICB8IERpY3Q8QVNULkV4cHJlc3Npb24+XG4gIHwgTG9jU2V4cFxuICB8IFBhdGhTZXhwXG4gIHwgdW5kZWZpbmVkO1xuXG5leHBvcnQgZnVuY3Rpb24gaXNMb2NTZXhwKHZhbHVlOiBTZXhwVmFsdWUpOiB2YWx1ZSBpcyBMb2NTZXhwIHtcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmxlbmd0aCA9PT0gMiAmJiB2YWx1ZVswXSA9PT0gJ2xvYyc7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1BhcmFtc1NleHAodmFsdWU6IFNleHBWYWx1ZSk6IHZhbHVlIGlzIEFTVC5FeHByZXNzaW9uW10ge1xuICByZXR1cm4gQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgIWlzTG9jU2V4cCh2YWx1ZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0hhc2hTZXhwKHZhbHVlOiBTZXhwVmFsdWUpOiB2YWx1ZSBpcyBEaWN0PEFTVC5FeHByZXNzaW9uPiB7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmICFBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgIGV4cGVjdFR5cGU8RGljdDxBU1QuRXhwcmVzc2lvbj4+KHZhbHVlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuZnVuY3Rpb24gZXhwZWN0VHlwZTxUPihfaW5wdXQ6IFQpOiB2b2lkIHtcbiAgcmV0dXJuO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplTW9kaWZpZXIoc2V4cDogTW9kaWZpZXJTZXhwKTogQVNULkVsZW1lbnRNb2RpZmllclN0YXRlbWVudCB7XG4gIGlmICh0eXBlb2Ygc2V4cCA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gYnVpbGRFbGVtZW50TW9kaWZpZXIoc2V4cCk7XG4gIH1cblxuICBsZXQgcGF0aDogQVNULkV4cHJlc3Npb24gPSBub3JtYWxpemVIZWFkKHNleHBbMF0pO1xuICBsZXQgcGFyYW1zOiBBU1QuRXhwcmVzc2lvbltdIHwgdW5kZWZpbmVkO1xuICBsZXQgaGFzaDogQVNULkhhc2ggfCB1bmRlZmluZWQ7XG4gIGxldCBsb2M6IEFTVC5Tb3VyY2VMb2NhdGlvbiB8IG51bGwgPSBudWxsO1xuXG4gIGxldCBwYXJ0cyA9IHNleHAuc2xpY2UoMSk7XG4gIGxldCBuZXh0ID0gcGFydHMuc2hpZnQoKTtcblxuICBfcHJvY2Vzczoge1xuICAgIGlmIChpc1BhcmFtc1NleHAobmV4dCkpIHtcbiAgICAgIHBhcmFtcyA9IG5leHQgYXMgQVNULkV4cHJlc3Npb25bXTtcbiAgICB9IGVsc2Uge1xuICAgICAgYnJlYWsgX3Byb2Nlc3M7XG4gICAgfVxuXG4gICAgbmV4dCA9IHBhcnRzLnNoaWZ0KCk7XG5cbiAgICBpZiAoaXNIYXNoU2V4cChuZXh0KSkge1xuICAgICAgaGFzaCA9IG5vcm1hbGl6ZUhhc2gobmV4dCBhcyBEaWN0PEFTVC5FeHByZXNzaW9uPik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGJyZWFrIF9wcm9jZXNzO1xuICAgIH1cbiAgfVxuXG4gIGlmIChpc0xvY1NleHAobmV4dCkpIHtcbiAgICBsb2MgPSBuZXh0WzFdO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50JyxcbiAgICBwYXRoLFxuICAgIHBhcmFtczogcGFyYW1zIHx8IFtdLFxuICAgIGhhc2g6IGhhc2ggfHwgYnVpbGRIYXNoKFtdKSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUF0dHIoc2V4cDogQXR0clNleHApOiBBU1QuQXR0ck5vZGUge1xuICBsZXQgbmFtZSA9IHNleHBbMF07XG4gIGxldCB2YWx1ZTtcblxuICBpZiAodHlwZW9mIHNleHBbMV0gPT09ICdzdHJpbmcnKSB7XG4gICAgdmFsdWUgPSBidWlsZFRleHQoc2V4cFsxXSk7XG4gIH0gZWxzZSB7XG4gICAgdmFsdWUgPSBzZXhwWzFdO1xuICB9XG5cbiAgbGV0IGxvYyA9IHNleHBbMl0gPyBzZXhwWzJdWzFdIDogdW5kZWZpbmVkO1xuXG4gIHJldHVybiBidWlsZEF0dHIobmFtZSwgdmFsdWUsIGxvYyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVIYXNoKGhhc2g6IERpY3Q8QVNULkV4cHJlc3Npb24+LCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuSGFzaCB7XG4gIGxldCBwYWlyczogQVNULkhhc2hQYWlyW10gPSBbXTtcblxuICBPYmplY3Qua2V5cyhoYXNoKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgcGFpcnMucHVzaChidWlsZFBhaXIoa2V5LCBoYXNoW2tleV0pKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGJ1aWxkSGFzaChwYWlycywgbG9jKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUhlYWQocGF0aDogUGF0aFNleHApOiBBU1QuRXhwcmVzc2lvbiB7XG4gIGlmICh0eXBlb2YgcGF0aCA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gYnVpbGRIZWFkKHBhdGgpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBidWlsZEhlYWQocGF0aFsxXSwgcGF0aFsyXSAmJiBwYXRoWzJdWzFdKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplRWxlbWVudE9wdGlvbnMoLi4uYXJnczogRWxlbWVudEFyZ3NbXSk6IEJ1aWxkRWxlbWVudE9wdGlvbnMge1xuICBsZXQgb3V0OiBCdWlsZEVsZW1lbnRPcHRpb25zID0ge307XG5cbiAgZm9yIChsZXQgYXJnIG9mIGFyZ3MpIHtcbiAgICBzd2l0Y2ggKGFyZ1swXSkge1xuICAgICAgY2FzZSAnYXR0cnMnOiB7XG4gICAgICAgIGxldCBbLCAuLi5yZXN0XSA9IGFyZztcbiAgICAgICAgb3V0LmF0dHJzID0gcmVzdC5tYXAobm9ybWFsaXplQXR0cik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSAnbW9kaWZpZXJzJzoge1xuICAgICAgICBsZXQgWywgLi4ucmVzdF0gPSBhcmc7XG4gICAgICAgIG91dC5tb2RpZmllcnMgPSByZXN0Lm1hcChub3JtYWxpemVNb2RpZmllcik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSAnYm9keSc6IHtcbiAgICAgICAgbGV0IFssIC4uLnJlc3RdID0gYXJnO1xuICAgICAgICBvdXQuY2hpbGRyZW4gPSByZXN0O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgJ2NvbW1lbnRzJzoge1xuICAgICAgICBsZXQgWywgLi4ucmVzdF0gPSBhcmc7XG5cbiAgICAgICAgb3V0LmNvbW1lbnRzID0gcmVzdDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlICdhcyc6IHtcbiAgICAgICAgbGV0IFssIC4uLnJlc3RdID0gYXJnO1xuICAgICAgICBvdXQuYmxvY2tQYXJhbXMgPSByZXN0O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgJ2xvYyc6IHtcbiAgICAgICAgbGV0IFssIHJlc3RdID0gYXJnO1xuICAgICAgICBvdXQubG9jID0gcmVzdDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG91dDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCdWlsZEVsZW1lbnRPcHRpb25zIHtcbiAgYXR0cnM/OiBBU1QuQXR0ck5vZGVbXTtcbiAgbW9kaWZpZXJzPzogQVNULkVsZW1lbnRNb2RpZmllclN0YXRlbWVudFtdO1xuICBjaGlsZHJlbj86IEFTVC5TdGF0ZW1lbnRbXTtcbiAgY29tbWVudHM/OiBFbGVtZW50Q29tbWVudFtdO1xuICBibG9ja1BhcmFtcz86IHN0cmluZ1tdO1xuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb247XG59XG5cbmZ1bmN0aW9uIGJ1aWxkRWxlbWVudCh0YWc6IFRhZ0Rlc2NyaXB0b3IsIG9wdGlvbnM/OiBCdWlsZEVsZW1lbnRPcHRpb25zKTogQVNULkVsZW1lbnROb2RlO1xuZnVuY3Rpb24gYnVpbGRFbGVtZW50KHRhZzogVGFnRGVzY3JpcHRvciwgLi4ub3B0aW9uczogRWxlbWVudEFyZ3NbXSk6IEFTVC5FbGVtZW50Tm9kZTtcbmZ1bmN0aW9uIGJ1aWxkRWxlbWVudChcbiAgdGFnOiBUYWdEZXNjcmlwdG9yLFxuICBvcHRpb25zPzogQnVpbGRFbGVtZW50T3B0aW9ucyB8IEVsZW1lbnRBcmdzLFxuICAuLi5yZXN0OiBFbGVtZW50QXJnc1tdXG4pOiBBU1QuRWxlbWVudE5vZGUge1xuICBsZXQgbm9ybWFsaXplZDogQnVpbGRFbGVtZW50T3B0aW9ucztcbiAgaWYgKEFycmF5LmlzQXJyYXkob3B0aW9ucykpIHtcbiAgICBub3JtYWxpemVkID0gbm9ybWFsaXplRWxlbWVudE9wdGlvbnMob3B0aW9ucywgLi4ucmVzdCk7XG4gIH0gZWxzZSB7XG4gICAgbm9ybWFsaXplZCA9IG9wdGlvbnMgfHwge307XG4gIH1cblxuICBsZXQgeyBhdHRycywgYmxvY2tQYXJhbXMsIG1vZGlmaWVycywgY29tbWVudHMsIGNoaWxkcmVuLCBsb2MgfSA9IG5vcm1hbGl6ZWQ7XG5cbiAgLy8gdGhpcyBpcyB1c2VkIGZvciBiYWNrd2FyZHMgY29tcGF0LCBwcmlvciB0byBgc2VsZkNsb3NpbmdgIGJlaW5nIHBhcnQgb2YgdGhlIEVsZW1lbnROb2RlIEFTVFxuICBsZXQgc2VsZkNsb3NpbmcgPSBmYWxzZTtcbiAgaWYgKHR5cGVvZiB0YWcgPT09ICdvYmplY3QnKSB7XG4gICAgc2VsZkNsb3NpbmcgPSB0YWcuc2VsZkNsb3Npbmc7XG4gICAgdGFnID0gdGFnLm5hbWU7XG4gIH0gZWxzZSB7XG4gICAgaWYgKHRhZy5zbGljZSgtMSkgPT09ICcvJykge1xuICAgICAgdGFnID0gdGFnLnNsaWNlKDAsIC0xKTtcbiAgICAgIHNlbGZDbG9zaW5nID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHR5cGU6ICdFbGVtZW50Tm9kZScsXG4gICAgdGFnOiB0YWcgfHwgJycsXG4gICAgc2VsZkNsb3Npbmc6IHNlbGZDbG9zaW5nLFxuICAgIGF0dHJpYnV0ZXM6IGF0dHJzIHx8IFtdLFxuICAgIGJsb2NrUGFyYW1zOiBibG9ja1BhcmFtcyB8fCBbXSxcbiAgICBtb2RpZmllcnM6IG1vZGlmaWVycyB8fCBbXSxcbiAgICBjb21tZW50czogKGNvbW1lbnRzIGFzIEFTVC5NdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnRbXSkgfHwgW10sXG4gICAgY2hpbGRyZW46IGNoaWxkcmVuIHx8IFtdLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZEF0dHIoXG4gIG5hbWU6IHN0cmluZyxcbiAgdmFsdWU6IEFTVC5BdHRyTm9kZVsndmFsdWUnXSxcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uXG4pOiBBU1QuQXR0ck5vZGUge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdBdHRyTm9kZScsXG4gICAgbmFtZTogbmFtZSxcbiAgICB2YWx1ZTogdmFsdWUsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkVGV4dChjaGFycz86IHN0cmluZywgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULlRleHROb2RlIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnVGV4dE5vZGUnLFxuICAgIGNoYXJzOiBjaGFycyB8fCAnJyxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuLy8gRXhwcmVzc2lvbnNcblxuZnVuY3Rpb24gYnVpbGRTZXhwcihcbiAgcGF0aDogQnVpbGRlckhlYWQsXG4gIHBhcmFtcz86IEFTVC5FeHByZXNzaW9uW10sXG4gIGhhc2g/OiBBU1QuSGFzaCxcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uXG4pOiBBU1QuU3ViRXhwcmVzc2lvbiB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ1N1YkV4cHJlc3Npb24nLFxuICAgIHBhdGg6IGJ1aWxkSGVhZChwYXRoKSxcbiAgICBwYXJhbXM6IHBhcmFtcyB8fCBbXSxcbiAgICBoYXNoOiBoYXNoIHx8IGJ1aWxkSGFzaChbXSksXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkSGVhZChvcmlnaW5hbDogQnVpbGRlckhlYWQsIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5FeHByZXNzaW9uIHtcbiAgaWYgKHR5cGVvZiBvcmlnaW5hbCAhPT0gJ3N0cmluZycpIHJldHVybiBvcmlnaW5hbDtcblxuICBsZXQgcGFydHMgPSBvcmlnaW5hbC5zcGxpdCgnLicpO1xuICBsZXQgdGhpc0hlYWQgPSBmYWxzZTtcblxuICBpZiAocGFydHNbMF0gPT09ICd0aGlzJykge1xuICAgIHRoaXNIZWFkID0gdHJ1ZTtcbiAgICBwYXJ0cyA9IHBhcnRzLnNsaWNlKDEpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnUGF0aEV4cHJlc3Npb24nLFxuICAgIG9yaWdpbmFsLFxuICAgIHRoaXM6IHRoaXNIZWFkLFxuICAgIHBhcnRzLFxuICAgIGRhdGE6IGZhbHNlLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZExpdGVyYWw8VCBleHRlbmRzIEFTVC5MaXRlcmFsPihcbiAgdHlwZTogVFsndHlwZSddLFxuICB2YWx1ZTogVFsndmFsdWUnXSxcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uXG4pOiBUIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlLFxuICAgIHZhbHVlLFxuICAgIG9yaWdpbmFsOiB2YWx1ZSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfSBhcyBUO1xufVxuXG4vLyBNaXNjZWxsYW5lb3VzXG5cbmZ1bmN0aW9uIGJ1aWxkSGFzaChwYWlycz86IEFTVC5IYXNoUGFpcltdLCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuSGFzaCB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0hhc2gnLFxuICAgIHBhaXJzOiBwYWlycyB8fCBbXSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRQYWlyKGtleTogc3RyaW5nLCB2YWx1ZTogQVNULkV4cHJlc3Npb24sIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5IYXNoUGFpciB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0hhc2hQYWlyJyxcbiAgICBrZXk6IGtleSxcbiAgICB2YWx1ZSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRQcm9ncmFtKFxuICBib2R5PzogQVNULlN0YXRlbWVudFtdLFxuICBibG9ja1BhcmFtcz86IHN0cmluZ1tdLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5UZW1wbGF0ZSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ1RlbXBsYXRlJyxcbiAgICBib2R5OiBib2R5IHx8IFtdLFxuICAgIGJsb2NrUGFyYW1zOiBibG9ja1BhcmFtcyB8fCBbXSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRCbG9ja0l0c2VsZihcbiAgYm9keT86IEFTVC5TdGF0ZW1lbnRbXSxcbiAgYmxvY2tQYXJhbXM/OiBzdHJpbmdbXSxcbiAgY2hhaW5lZCA9IGZhbHNlLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5CbG9jayB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0Jsb2NrJyxcbiAgICBib2R5OiBib2R5IHx8IFtdLFxuICAgIGJsb2NrUGFyYW1zOiBibG9ja1BhcmFtcyB8fCBbXSxcbiAgICBjaGFpbmVkLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFRlbXBsYXRlKFxuICBib2R5PzogQVNULlN0YXRlbWVudFtdLFxuICBibG9ja1BhcmFtcz86IHN0cmluZ1tdLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5UZW1wbGF0ZSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ1RlbXBsYXRlJyxcbiAgICBib2R5OiBib2R5IHx8IFtdLFxuICAgIGJsb2NrUGFyYW1zOiBibG9ja1BhcmFtcyB8fCBbXSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRTb3VyY2Uoc291cmNlPzogc3RyaW5nKSB7XG4gIHJldHVybiBzb3VyY2UgfHwgbnVsbDtcbn1cblxuZnVuY3Rpb24gYnVpbGRQb3NpdGlvbihsaW5lOiBudW1iZXIsIGNvbHVtbjogbnVtYmVyKSB7XG4gIHJldHVybiB7XG4gICAgbGluZSxcbiAgICBjb2x1bW4sXG4gIH07XG59XG5cbmV4cG9ydCBjb25zdCBTWU5USEVUSUM6IEFTVC5Tb3VyY2VMb2NhdGlvbiA9IHtcbiAgc291cmNlOiAnKHN5bnRoZXRpYyknLFxuICBzdGFydDogeyBsaW5lOiAxLCBjb2x1bW46IDAgfSxcbiAgZW5kOiB7IGxpbmU6IDEsIGNvbHVtbjogMCB9LFxufTtcblxuZnVuY3Rpb24gYnVpbGRMb2MobG9jOiBPcHRpb248QVNULlNvdXJjZUxvY2F0aW9uPik6IEFTVC5Tb3VyY2VMb2NhdGlvbjtcbmZ1bmN0aW9uIGJ1aWxkTG9jKFxuICBzdGFydExpbmU6IG51bWJlcixcbiAgc3RhcnRDb2x1bW46IG51bWJlcixcbiAgZW5kTGluZT86IG51bWJlcixcbiAgZW5kQ29sdW1uPzogbnVtYmVyLFxuICBzb3VyY2U/OiBzdHJpbmdcbik6IEFTVC5Tb3VyY2VMb2NhdGlvbjtcblxuZnVuY3Rpb24gYnVpbGRMb2MoLi4uYXJnczogYW55W10pOiBBU1QuU291cmNlTG9jYXRpb24ge1xuICBpZiAoYXJncy5sZW5ndGggPT09IDEpIHtcbiAgICBsZXQgbG9jID0gYXJnc1swXTtcblxuICAgIGlmIChsb2MgJiYgdHlwZW9mIGxvYyA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNvdXJjZTogYnVpbGRTb3VyY2UobG9jLnNvdXJjZSksXG4gICAgICAgIHN0YXJ0OiBidWlsZFBvc2l0aW9uKGxvYy5zdGFydC5saW5lLCBsb2Muc3RhcnQuY29sdW1uKSxcbiAgICAgICAgZW5kOiBidWlsZFBvc2l0aW9uKGxvYy5lbmQubGluZSwgbG9jLmVuZC5jb2x1bW4pLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFNZTlRIRVRJQztcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbGV0IFtzdGFydExpbmUsIHN0YXJ0Q29sdW1uLCBlbmRMaW5lLCBlbmRDb2x1bW4sIHNvdXJjZV0gPSBhcmdzO1xuICAgIHJldHVybiB7XG4gICAgICBzb3VyY2U6IGJ1aWxkU291cmNlKHNvdXJjZSksXG4gICAgICBzdGFydDogYnVpbGRQb3NpdGlvbihzdGFydExpbmUsIHN0YXJ0Q29sdW1uKSxcbiAgICAgIGVuZDogYnVpbGRQb3NpdGlvbihlbmRMaW5lLCBlbmRDb2x1bW4pLFxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBtdXN0YWNoZTogYnVpbGRNdXN0YWNoZSxcbiAgYmxvY2s6IGJ1aWxkQmxvY2ssXG4gIHBhcnRpYWw6IGJ1aWxkUGFydGlhbCxcbiAgY29tbWVudDogYnVpbGRDb21tZW50LFxuICBtdXN0YWNoZUNvbW1lbnQ6IGJ1aWxkTXVzdGFjaGVDb21tZW50LFxuICBlbGVtZW50OiBidWlsZEVsZW1lbnQsXG4gIGVsZW1lbnRNb2RpZmllcjogYnVpbGRFbGVtZW50TW9kaWZpZXIsXG4gIGF0dHI6IGJ1aWxkQXR0cixcbiAgdGV4dDogYnVpbGRUZXh0LFxuICBzZXhwcjogYnVpbGRTZXhwcixcbiAgcGF0aDogYnVpbGRIZWFkLFxuICBjb25jYXQ6IGJ1aWxkQ29uY2F0LFxuICBoYXNoOiBidWlsZEhhc2gsXG4gIHBhaXI6IGJ1aWxkUGFpcixcbiAgbGl0ZXJhbDogYnVpbGRMaXRlcmFsLFxuICBwcm9ncmFtOiBidWlsZFByb2dyYW0sXG4gIGJsb2NrSXRzZWxmOiBidWlsZEJsb2NrSXRzZWxmLFxuICB0ZW1wbGF0ZTogYnVpbGRUZW1wbGF0ZSxcbiAgbG9jOiBidWlsZExvYyxcbiAgcG9zOiBidWlsZFBvc2l0aW9uLFxuXG4gIHN0cmluZzogbGl0ZXJhbCgnU3RyaW5nTGl0ZXJhbCcpIGFzICh2YWx1ZTogc3RyaW5nKSA9PiBTdHJpbmdMaXRlcmFsLFxuICBib29sZWFuOiBsaXRlcmFsKCdCb29sZWFuTGl0ZXJhbCcpIGFzICh2YWx1ZTogYm9vbGVhbikgPT4gQm9vbGVhbkxpdGVyYWwsXG4gIG51bWJlcjogbGl0ZXJhbCgnTnVtYmVyTGl0ZXJhbCcpIGFzICh2YWx1ZTogbnVtYmVyKSA9PiBOdW1iZXJMaXRlcmFsLFxuICB1bmRlZmluZWQoKSB7XG4gICAgcmV0dXJuIGJ1aWxkTGl0ZXJhbCgnVW5kZWZpbmVkTGl0ZXJhbCcsIHVuZGVmaW5lZCk7XG4gIH0sXG4gIG51bGwoKSB7XG4gICAgcmV0dXJuIGJ1aWxkTGl0ZXJhbCgnTnVsbExpdGVyYWwnLCBudWxsKTtcbiAgfSxcbn07XG5cbnR5cGUgQnVpbGRMaXRlcmFsPFQgZXh0ZW5kcyBBU1QuTGl0ZXJhbD4gPSAodmFsdWU6IFRbJ3ZhbHVlJ10pID0+IFQ7XG5cbmZ1bmN0aW9uIGxpdGVyYWw8VCBleHRlbmRzIEFTVC5MaXRlcmFsPih0eXBlOiBUWyd0eXBlJ10pOiBCdWlsZExpdGVyYWw8VD4ge1xuICByZXR1cm4gZnVuY3Rpb24odmFsdWU6IFRbJ3ZhbHVlJ10pOiBUIHtcbiAgICByZXR1cm4gYnVpbGRMaXRlcmFsKHR5cGUsIHZhbHVlKTtcbiAgfTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=