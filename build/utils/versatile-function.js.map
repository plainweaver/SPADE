{"version":3,"sources":["../../src/utils/versatile-function.js"],"names":["promise","Symbol","createCallback","customCallback","resolve","reject","callback","err","results","Promise","res","rej","result","length","error","defaultCallbackFinder","args","pop","returnPromise","optionalArgumentsHandler","callbackStyleFunction","undefined","bind","isVersatile","catch","e","appendCallback","promiseReturningFunction","mainFunc","then"],"mappings":"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","sourcesContent":["/**\n * Makes function support both styles, callback and promise.\n */\n\nconst promise = Symbol('promise attached to callback');\n\nexport function createCallback (customCallback) {\n  let resolve;\n  let reject;\n\n  const callback = function callback (err, ...results) {\n    if (err) reject(err);\n    else resolve(...results)\n  };\n\n  if (customCallback) {\n    callback[promise] = new Promise((res, rej) => {\n      resolve = (...result) => {\n        res();\n        if (result.length > 0) customCallback(null, ...result);\n        else customCallback();\n      };\n      reject = (error) => {\n        rej();\n        customCallback(error);\n      }\n    })\n  } else {\n    callback[promise] = new Promise(function (res, rej) {\n      resolve = res;\n      reject = rej;\n    });\n  }\n\n  return callback;\n}\n\nfunction defaultCallbackFinder(...args) {\n  const callback = args.pop();\n  return typeof callback === 'function' ? callback : createCallback();\n}\n\nexport function returnPromise(optionalArgumentsHandler, callbackStyleFunction) {\n  return function (...args) {\n    let callback;\n\n    if (callbackStyleFunction) {\n      switch (typeof optionalArgumentsHandler) {\n        case 'function':\n          callback = createCallback(optionalArgumentsHandler(...args));\n          break;\n        case 'number':\n          if (args.length > optionalArgumentsHandler) callback = createCallback(args.pop());\n          else callback = createCallback();\n      }\n    } else {\n      callback = defaultCallbackFinder(...args);\n      callbackStyleFunction = optionalArgumentsHandler;\n    }\n\n    if (this !== undefined) callbackStyleFunction = callbackStyleFunction.bind(this);\n\n    // promise will be returned when callbackStyleFunction is already a versatile function.\n    // in this case, rejection from promise should be ignored, to not print warning messages in console.\n    // callback taking error would do the work.\n    const isVersatile = callbackStyleFunction(...args, callback);\n    if (isVersatile) isVersatile.catch(e => {});\n\n    return callback[promise];\n  }\n}\n\nexport function appendCallback(optionalArgumentsHandler, promiseReturningFunction) {\n  return function (...args) {\n    let callback;\n    let mainFunc;\n\n    if (promiseReturningFunction) {\n      if (typeof optionalArgumentsHandler === 'function') callback = optionalArgumentsHandler(...args);\n      if (!callback[promise]) callback = createCallback(callback);\n      mainFunc = promiseReturningFunction;\n    } else {\n      callback = defaultCallbackFinder(...args);\n      mainFunc = optionalArgumentsHandler;\n    }\n\n    if (this !== undefined) mainFunc = mainFunc.bind(this);\n\n    mainFunc(...args)\n      .then((...result) => callback(null, ...result))\n      .catch(error => callback(error));\n\n    return callback[promise];\n  };\n}\n"],"file":"versatile-function.js"}