{"version":3,"sources":["../../src/subsystems/ActionSystem.js"],"names":["ActionSystem","EventEmitter","constructor","self","process","nextTick","shard","particle","domain","event","on","getVerbs","queryObject","queryCategories","getFunctions","abstract","getItemsByCategory","id","parse","buffer","toString","e","evaluate","code","context","vm","createContext","module","source","SourceTextModule","link","emit","exports","analyze","analysis","require","argument","global","binding","action"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEe,MAAMA,YAAN,SAA2B,6BAAS,6BAAS,QAAT,CAAT,EAA6BC,oBAA7B,CAA3B,CAAsE;AACnFC,EAAAA,WAAW,CAACC,IAAD,EAAO;AAChB,UAAMA,IAAN;AAEAC,IAAAA,OAAO,CAACC,QAAR,CAAiB,MAAM;AACrB,WAAKC,KAAL,GAAaH,IAAI,CAACG,KAAlB;AACA,WAAKC,QAAL,GAAgBJ,IAAI,CAACI,QAArB;AACA,WAAKC,MAAL,GAAcL,IAAI,CAACK,MAAnB;AACA,WAAKC,KAAL,GAAaN,IAAI,CAACM,KAAlB;AACD,KALD;AAMD;AAED;;;AAAeC,EAAAA,EAAE,GAAG,CAEnB;;AAED,QAAMC,QAAN,CAAeC,WAAf,EAA4B;AAC1B,WAAO,MAAM,KAAKC,eAAL,CAAqBD,WAArB,CAAb;AACD;;AAED,QAAME,YAAN,CAAmBC,QAAnB,EAA6B;AAC3B,WAAO,MAAM,KAAKC,kBAAL,CAAwBD,QAAQ,CAACE,EAAjC,CAAb;AACD;;AAEDC,EAAAA,KAAK,CAACC,MAAD,EAAS;AACZ,QAAI;AACF,aAAOA,MAAM,CAACC,QAAP,EAAP;AACD,KAFD,CAEE,OAAOC,CAAP,EAAU,CAAE;AACf;;AAED,QAAMC,QAAN,CAAeC,IAAf,EAAqB;AACnB,UAAMC,OAAO,GAAGC,YAAGC,aAAH,CAAiB;AAAEC,MAAAA,MAAM,EAAE;AAAV,KAAjB,CAAhB;;AACA,UAAMC,MAAM,GAAG,IAAIH,YAAGI,gBAAP,CAAwBN,IAAxB,EAA8B;AAAEC,MAAAA;AAAF,KAA9B,CAAf;AACA,UAAMI,MAAM,CAACE,IAAP,EAAN;AACA,UAAMF,MAAM,CAACN,QAAP,EAAN;AACA,SAAKS,IAAL,CAAU,UAAV,EAAsBP,OAAO,CAACG,MAAR,CAAeK,OAArC;AACD;;AAEDC,EAAAA,OAAO,CAACV,IAAD,EAAO;AACZ,UAAMW,QAAQ,GAAG;AACfC,MAAAA,OAAO,EAAE,EADM;AAEfC,MAAAA,QAAQ,EAAE,EAFK;AAGfC,MAAAA,MAAM,EAAE,EAHO;AAIfC,MAAAA,OAAO,EAAE;AAJM,KAAjB;AAOA,SAAKP,IAAL,CAAU,SAAV,EAAqBG,QAArB;AACD;;AAED,QAAM9B,OAAN,CAAcG,QAAd,EAAwB;AACtB,UAAMgC,MAAM,GAAG,MAAM,KAAKjB,QAAL,CAAcf,QAAd,CAArB;AACA,SAAKE,KAAL,CAAW8B,MAAX;AAEA,UAAM,KAAKN,OAAL,CAAa1B,QAAb,CAAN;AACD;;AAtDkF","sourcesContent":["import vm from 'vm';\nimport { EventEmitter } from 'events';\nimport classes from 'extends-classes';\nimport Category from './principle/CategorySystem';\n\nexport default class ActionSystem extends classes (Category('action'), EventEmitter) {\n  constructor(self) {\n    super(self);\n\n    process.nextTick(() => {\n      this.shard = self.shard;\n      this.particle = self.particle;\n      this.domain = self.domain;\n      this.event = self.event;\n    });\n  }\n\n  /* override */ on() {\n\n  }\n\n  async getVerbs(queryObject) {\n    return await this.queryCategories(queryObject);\n  }\n\n  async getFunctions(abstract) {\n    return await this.getItemsByCategory(abstract.id);\n  }\n\n  parse(buffer) {\n    try {\n      return buffer.toString();\n    } catch (e) {}\n  }\n\n  async evaluate(code) {\n    const context = vm.createContext({ module: {} });\n    const source = new vm.SourceTextModule(code, { context });\n    await source.link();\n    await source.evaluate();\n    this.emit('evaluate', context.module.exports);\n  }\n\n  analyze(code) {\n    const analysis = {\n      require: [],\n      argument: [],\n      global: [],\n      binding: [],\n    };\n\n    this.emit('analyze', analysis);\n  }\n\n  async process(particle) {\n    const action = await this.evaluate(particle);\n    this.event(action);\n\n    await this.analyze(particle);\n  }\n}\n"],"file":"ActionSystem.js"}