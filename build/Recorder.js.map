{"version":3,"sources":["../src/Recorder.js"],"names":["elements","toStorable","value","toString","Recorder","constructor","system","history","receiver","createProxy","recorder","Proxy","set","target","property","push","Reflect","arguments","setPrototypeOf","prototype","defineProperty","key","descriptor","deleteProperty","get","includes","getOwnPropertyDescriptor"],"mappings":";;;;;;;AAAA;;AAEA;AACA,MAAMA,QAAQ,GAAG,CAAC,OAAD,EAAU,UAAV,EAAsB,QAAtB,EAAgC,QAAhC,EAA0C,OAA1C,CAAjB;;AAEA,SAASC,UAAT,CAAoBC,KAApB,EAA2B;AACzB,MAAI,OAAOA,KAAP,KAAiB,UAArB,EAAiC,OAAOA,KAAK,CAACC,QAAN,EAAP;AACjC,SAAO,wBAAUD,KAAV,CAAP;AACD;;AAEc,MAAME,QAAN,CAAe;AAC5BC,EAAAA,WAAW,CAACC,MAAD,EAAS;AAClB,SAAKA,MAAL,GAAc,EAAE,GAAGA;AAAL,KAAd;AACA,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,QAAL,GAAgB,KAAKC,WAAL,CAAiB,IAAjB,CAAhB;AACD;;AAEDA,EAAAA,WAAW,CAACC,QAAD,EAAW;AACpB,WAAO,IAAIC,KAAJ,CAAUD,QAAQ,CAACJ,MAAnB,EAA2B;AAChCM,MAAAA,GAAG,CAACC,MAAD,EAASC,QAAT,EAAmBZ,KAAnB,EAA0BM,QAA1B,EAAoC;AACrC,YAAIN,KAAJ,EACAQ,QAAQ,CAACH,OAAT,CAAiBQ,IAAjB,CAAsB,CAAC,KAAD,EAAQD,QAAR,EAAkBb,UAAU,CAACC,KAAD,CAA5B,CAAtB;AACA,eAAOc,OAAO,CAACJ,GAAR,CAAY,GAAGK,SAAf,CAAP;AACD,OAL+B;;AAMhCC,MAAAA,cAAc,CAACL,MAAD,EAASM,SAAT,EAAoB;AAChCT,QAAAA,QAAQ,CAACH,OAAT,CAAiBQ,IAAjB,CAAsB,CAAC,gBAAD,EAAmBd,UAAU,CAACkB,SAAD,CAA7B,CAAtB;AACA,eAAOH,OAAO,CAACE,cAAR,CAAuB,GAAGD,SAA1B,CAAP;AACD,OAT+B;;AAUhCG,MAAAA,cAAc,CAACP,MAAD,EAASQ,GAAT,EAAcC,UAAd,EAA0B;AACtCZ,QAAAA,QAAQ,CAACH,OAAT,CAAiBQ,IAAjB,CAAsB,CAAC,gBAAD,EAAmBM,GAAnB,EAAwBpB,UAAU,CAACqB,UAAD,CAAlC,CAAtB;AACA,eAAON,OAAO,CAACI,cAAR,CAAuB,GAAGH,SAA1B,CAAP;AACD,OAb+B;;AAchCM,MAAAA,cAAc,CAACV,MAAD,EAASC,QAAT,EAAmB;AAC/BJ,QAAAA,QAAQ,CAACH,OAAT,CAAiBQ,IAAjB,CAAsB,CAAC,gBAAD,EAAmBD,QAAnB,CAAtB;AACA,eAAOE,OAAO,CAACO,cAAR,CAAuB,GAAGN,SAA1B,CAAP;AACD,OAjB+B;;AAkBhCO,MAAAA,GAAG,CAACX,MAAD,EAASC,QAAT,EAAmBN,QAAnB,EAA6B;AAC9B,YAAIR,QAAQ,CAACyB,QAAT,CAAkBX,QAAlB,CAAJ,EAAiC;AAC/B,iBAAOE,OAAO,CAACQ,GAAR,CAAY,GAAGP,SAAf,CAAP;AACD;AACF,OAtB+B;;AAuBhCS,MAAAA,wBAAwB,CAACb,MAAD,EAASC,QAAT,EAAmB;AACzC,YAAId,QAAQ,CAACyB,QAAT,CAAkBX,QAAlB,CAAJ,EAAgC;AAC9B,iBAAOE,OAAO,CAACU,wBAAR,CAAiC,GAAGT,SAApC,CAAP;AACD;AACF;;AA3B+B,KAA3B,CAAP;AA6BD;;AArC2B","sourcesContent":["import { stringify } from 'flatted';\n\n// not listed on below will be filtered out from the system.\nconst elements = ['shard', 'particle', 'action', 'domain', 'event'];\n\nfunction toStorable(value) {\n  if (typeof value === 'function') return value.toString();\n  return stringify(value)\n}\n\nexport default class Recorder {\n  constructor(system) {\n    this.system = { ...system };\n    this.history = [];\n    this.receiver = this.createProxy(this);\n  }\n\n  createProxy(recorder) {\n    return new Proxy(recorder.system, {\n      set(target, property, value, receiver) {\n        if (value)\n        recorder.history.push(['set', property, toStorable(value)]);\n        return Reflect.set(...arguments);\n      },\n      setPrototypeOf(target, prototype) {\n        recorder.history.push(['setPrototypeOf', toStorable(prototype)]);\n        return Reflect.setPrototypeOf(...arguments);\n      },\n      defineProperty(target, key, descriptor) {\n        recorder.history.push(['defineProperty', key, toStorable(descriptor)]);\n        return Reflect.defineProperty(...arguments);\n      },\n      deleteProperty(target, property) {\n        recorder.history.push(['deleteProperty', property]);\n        return Reflect.deleteProperty(...arguments);\n      },\n      get(target, property, receiver) {\n        if (elements.includes(property)) {\n          return Reflect.get(...arguments);\n        }\n      },\n      getOwnPropertyDescriptor(target, property) {\n        if (elements.includes(property)){\n          return Reflect.getOwnPropertyDescriptor(...arguments);\n        }\n      }\n    });\n  }\n}\n"],"file":"Recorder.js"}